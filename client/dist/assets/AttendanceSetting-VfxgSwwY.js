import{a as V}from"./api-C2nzzaKe.js";import{_ as D,r as b,j as J,c as H,b as O,d as l,w as a,e as i,o as M,g as v}from"./index-C25OXyZh.js";const q={class:"attendance-setting"},z={slot:"footer",class:"dialog-footer"},g="HH:mm",K={__name:"AttendanceSetting",setup(Q){async function h(){const o=await V("/api/attendance-settings");if(o.ok){const e=await o.json();e.abnormalRules&&(d.value={...d.value,...e.abnormalRules}),e.breakOutRules&&(s.value={...s.value,...e.breakOutRules}),e.overtimeRules&&(r.value={...r.value,...e.overtimeRules})}}async function j(){const o=await V("/api/shifts");o.ok&&(p.value=await o.json())}async function c(){const o={abnormalRules:d.value,breakOutRules:s.value,overtimeRules:r.value};await V("/api/attendance-settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})}const U=b("shift"),p=b([]),y=b(!1),u=b({name:"",startTime:"",endTime:"",breakTime:""});let _=null;const R=(o=null)=>{o!==null?(_=o,u.value={...p.value[o]}):(_=null,u.value={name:"",startTime:"",endTime:"",breakTime:""}),y.value=!0},B=async()=>{if(_===null){const o=await V("/api/shifts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.value)});if(o.ok){const e=await o.json();p.value.push(e)}}else{const o=p.value[_]._id,e=await V(`/api/shifts/${o}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(u.value)});if(e.ok){const m=await e.json();p.value[_]=m}}y.value=!1},P=async o=>{const e=p.value[o]._id;(await V(`/api/shifts/${e}`,{method:"DELETE"})).ok&&p.value.splice(o,1)},d=b({lateGrace:5,earlyLeaveGrace:5,missingThreshold:30,autoNotify:!0}),A=async()=>{await c(),alert("已儲存「異常判定規則」設定")},s=b({enableBreakPunch:!0,breakInterval:60,outingNeedApprove:!1}),F=async()=>{await c(),alert("已儲存「分段打卡/外出」設定")},r=b({weekdayThreshold:30,holidayRate:2,toCompRate:1.5}),G=async()=>{await c(),alert("已儲存「加班規則」設定")};return J(()=>{h(),j()}),(o,e)=>{const m=i("el-button"),k=i("el-table-column"),I=i("el-table"),x=i("el-input"),n=i("el-form-item"),S=i("el-time-picker"),w=i("el-form"),L=i("el-dialog"),T=i("el-tab-pane"),f=i("el-input-number"),C=i("el-switch"),$=i("el-tabs");return M(),H("div",q,[e[26]||(e[26]=O("h2",null,"出勤設定",-1)),l($,{modelValue:U.value,"onUpdate:modelValue":e[17]||(e[17]=t=>U.value=t),type:"card"},{default:a(()=>[l(T,{label:"班別設定",name:"shift"},{default:a(()=>[l(m,{type:"primary",onClick:e[0]||(e[0]=t=>R())},{default:a(()=>e[18]||(e[18]=[v("新增班別")])),_:1}),l(I,{data:p.value,style:{"margin-top":"20px",width:"100%"}},{default:a(()=>[l(k,{prop:"name",label:"班別名稱",width:"180"}),l(k,{prop:"startTime",label:"上班時間",width:"120"}),l(k,{prop:"endTime",label:"下班時間",width:"120"}),l(k,{prop:"breakTime",label:"休息時段"}),l(k,{label:"操作",width:"180"},{default:a(({row:t,$index:N})=>[l(m,{type:"primary",onClick:E=>R(N)},{default:a(()=>e[19]||(e[19]=[v("編輯")])),_:2},1032,["onClick"]),l(m,{type:"danger",onClick:E=>P(N)},{default:a(()=>e[20]||(e[20]=[v("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),l(L,{title:"班別資料",modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=t=>y.value=t),width:"500px"},{default:a(()=>[l(w,{model:u.value,"label-width":"100px"},{default:a(()=>[l(n,{label:"名稱"},{default:a(()=>[l(x,{modelValue:u.value.name,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value.name=t),placeholder:"例如：早班 / 晚班"},null,8,["modelValue"])]),_:1}),l(n,{label:"上班時間"},{default:a(()=>[l(S,{modelValue:u.value.startTime,"onUpdate:modelValue":e[2]||(e[2]=t=>u.value.startTime=t),placeholder:"選擇上班時間",format:g,"value-format":g},null,8,["modelValue"])]),_:1}),l(n,{label:"下班時間"},{default:a(()=>[l(S,{modelValue:u.value.endTime,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value.endTime=t),placeholder:"選擇下班時間",format:g,"value-format":g},null,8,["modelValue"])]),_:1}),l(n,{label:"休息時段"},{default:a(()=>[l(x,{modelValue:u.value.breakTime,"onUpdate:modelValue":e[4]||(e[4]=t=>u.value.breakTime=t),placeholder:"例如：12:00~13:00"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),O("span",z,[l(m,{onClick:e[5]||(e[5]=t=>y.value=!1)},{default:a(()=>e[21]||(e[21]=[v("取消")])),_:1}),l(m,{type:"primary",onClick:B},{default:a(()=>e[22]||(e[22]=[v("儲存")])),_:1})])]),_:1},8,["modelValue"])]),_:1}),l(T,{label:"異常判定規則",name:"abnormal"},{default:a(()=>[l(w,{model:d.value,"label-width":"140px",class:"rule-form"},{default:a(()=>[l(n,{label:"遲到容許誤差(分鐘)"},{default:a(()=>[l(f,{modelValue:d.value.lateGrace,"onUpdate:modelValue":e[7]||(e[7]=t=>d.value.lateGrace=t),min:0},null,8,["modelValue"])]),_:1}),l(n,{label:"早退容許誤差(分鐘)"},{default:a(()=>[l(f,{modelValue:d.value.earlyLeaveGrace,"onUpdate:modelValue":e[8]||(e[8]=t=>d.value.earlyLeaveGrace=t),min:0},null,8,["modelValue"])]),_:1}),l(n,{label:"缺卡判斷時間(分鐘)"},{default:a(()=>[l(f,{modelValue:d.value.missingThreshold,"onUpdate:modelValue":e[9]||(e[9]=t=>d.value.missingThreshold=t),min:0},null,8,["modelValue"])]),_:1}),l(n,{label:"未打卡自動通知"},{default:a(()=>[l(C,{modelValue:d.value.autoNotify,"onUpdate:modelValue":e[10]||(e[10]=t=>d.value.autoNotify=t),"active-text":"啟用","inactive-text":"停用"},null,8,["modelValue"])]),_:1}),l(n,null,{default:a(()=>[l(m,{type:"primary",onClick:A},{default:a(()=>e[23]||(e[23]=[v("儲存規則")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(T,{label:"分段打卡/外出",name:"break-outing"},{default:a(()=>[l(w,{model:s.value,"label-width":"140px",class:"rule-form"},{default:a(()=>[l(n,{label:"是否允許分段打卡"},{default:a(()=>[l(C,{modelValue:s.value.enableBreakPunch,"onUpdate:modelValue":e[11]||(e[11]=t=>s.value.enableBreakPunch=t),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),l(n,{label:"分段打卡最少間隔(分鐘)"},{default:a(()=>[l(f,{modelValue:s.value.breakInterval,"onUpdate:modelValue":e[12]||(e[12]=t=>s.value.breakInterval=t),min:0,disabled:!s.value.enableBreakPunch},null,8,["modelValue","disabled"])]),_:1}),l(n,{label:"外出登記需審核"},{default:a(()=>[l(C,{modelValue:s.value.outingNeedApprove,"onUpdate:modelValue":e[13]||(e[13]=t=>s.value.outingNeedApprove=t),"active-text":"需要","inactive-text":"不需要"},null,8,["modelValue"])]),_:1}),l(n,null,{default:a(()=>[l(m,{type:"primary",onClick:F},{default:a(()=>e[24]||(e[24]=[v("儲存設定")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(T,{label:"加班規則",name:"overtime"},{default:a(()=>[l(w,{model:r.value,"label-width":"120px",class:"rule-form"},{default:a(()=>[l(n,{label:"平日加班起算(分)"},{default:a(()=>[l(f,{modelValue:r.value.weekdayThreshold,"onUpdate:modelValue":e[14]||(e[14]=t=>r.value.weekdayThreshold=t),min:0},null,8,["modelValue"])]),_:1}),l(n,{label:"假日加班倍數"},{default:a(()=>[l(f,{modelValue:r.value.holidayRate,"onUpdate:modelValue":e[15]||(e[15]=t=>r.value.holidayRate=t),min:1,step:.1},null,8,["modelValue"])]),_:1}),l(n,{label:"轉補休折算比率"},{default:a(()=>[l(f,{modelValue:r.value.toCompRate,"onUpdate:modelValue":e[16]||(e[16]=t=>r.value.toCompRate=t),min:1,step:.1},null,8,["modelValue"])]),_:1}),l(n,null,{default:a(()=>[l(m,{type:"primary",onClick:G},{default:a(()=>e[25]||(e[25]=[v("儲存加班規則")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])])}}},Y=D(K,[["__scopeId","data-v-71e2030e"]]);export{Y as default};
