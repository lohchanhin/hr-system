import{a as S}from"./api-ZZnZ46lj.js";import{_ as D,r as b,g as H,c as E,d as A,a as l,w as a,b as d,o as J,e as p}from"./index-M7-4-VVN.js";const M={class:"attendance-setting"},q={slot:"footer",class:"dialog-footer"},w="HH:mm",K={__name:"AttendanceSetting",setup(Q){const U=localStorage.getItem("token")||"";async function O(){const i=await S("/api/attendance-settings",{headers:{Authorization:`Bearer ${U}`}});if(i.ok){const e=await i.json();e.shifts&&(v.value=e.shifts),e.abnormalRules&&(u.value={...u.value,...e.abnormalRules}),e.breakOutRules&&(m.value={...m.value,...e.breakOutRules}),e.overtimeRules&&(s.value={...s.value,...e.overtimeRules})}}async function V(){const i={shifts:v.value,abnormalRules:u.value,breakOutRules:m.value,overtimeRules:s.value};await S("/api/attendance-settings",{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${U}`},body:JSON.stringify(i)})}const C=b("shift"),v=b([{name:"早班",startTime:"08:00",endTime:"17:00",breakTime:"12:00~13:00"},{name:"晚班",startTime:"16:00",endTime:"00:00",breakTime:"20:00~20:30"}]),_=b(!1),n=b({name:"",startTime:"",endTime:"",breakTime:""});let y=null;const x=(i=null)=>{i!==null?(y=i,n.value={...v.value[i]}):(y=null,n.value={name:"",startTime:"",endTime:"",breakTime:""}),_.value=!0},F=()=>{y===null?v.value.push({...n.value}):v.value[y]={...n.value},_.value=!1,V()},G=i=>{v.value.splice(i,1),V()},u=b({lateGrace:5,earlyLeaveGrace:5,missingThreshold:30,autoNotify:!0}),I=async()=>{await V(),alert("已儲存「異常判定規則」設定")},m=b({enableBreakPunch:!0,breakInterval:60,outingNeedApprove:!1}),P=async()=>{await V(),alert("已儲存「分段打卡/外出」設定")},s=b({weekdayThreshold:30,holidayRate:2,toCompRate:1.5}),$=async()=>{await V(),alert("已儲存「加班規則」設定")};return H(O),(i,e)=>{const r=d("el-button"),k=d("el-table-column"),h=d("el-table"),c=d("el-input"),o=d("el-form-item"),B=d("el-time-picker"),T=d("el-form"),L=d("el-dialog"),g=d("el-tab-pane"),f=d("el-input-number"),R=d("el-switch"),j=d("el-tabs");return J(),E("div",M,[e[26]||(e[26]=A("h2",null,"出勤設定",-1)),l(j,{modelValue:C.value,"onUpdate:modelValue":e[17]||(e[17]=t=>C.value=t),type:"card"},{default:a(()=>[l(g,{label:"班別設定",name:"shift"},{default:a(()=>[l(r,{type:"primary",onClick:e[0]||(e[0]=t=>x())},{default:a(()=>e[18]||(e[18]=[p("新增班別")])),_:1}),l(h,{data:v.value,style:{"margin-top":"20px",width:"100%"}},{default:a(()=>[l(k,{prop:"name",label:"班別名稱",width:"180"}),l(k,{prop:"startTime",label:"上班時間",width:"120"}),l(k,{prop:"endTime",label:"下班時間",width:"120"}),l(k,{prop:"breakTime",label:"休息時段"}),l(k,{label:"操作",width:"180"},{default:a(({row:t,$index:N})=>[l(r,{type:"primary",onClick:z=>x(N)},{default:a(()=>e[19]||(e[19]=[p("編輯")])),_:2},1032,["onClick"]),l(r,{type:"danger",onClick:z=>G(N)},{default:a(()=>e[20]||(e[20]=[p("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),l(L,{title:"班別資料",modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=t=>_.value=t),width:"500px"},{default:a(()=>[l(T,{model:n.value,"label-width":"100px"},{default:a(()=>[l(o,{label:"名稱"},{default:a(()=>[l(c,{modelValue:n.value.name,"onUpdate:modelValue":e[1]||(e[1]=t=>n.value.name=t),placeholder:"例如：早班 / 晚班"},null,8,["modelValue"])]),_:1}),l(o,{label:"上班時間"},{default:a(()=>[l(B,{modelValue:n.value.startTime,"onUpdate:modelValue":e[2]||(e[2]=t=>n.value.startTime=t),placeholder:"選擇上班時間",format:w,"value-format":w},null,8,["modelValue"])]),_:1}),l(o,{label:"下班時間"},{default:a(()=>[l(B,{modelValue:n.value.endTime,"onUpdate:modelValue":e[3]||(e[3]=t=>n.value.endTime=t),placeholder:"選擇下班時間",format:w,"value-format":w},null,8,["modelValue"])]),_:1}),l(o,{label:"休息時段"},{default:a(()=>[l(c,{modelValue:n.value.breakTime,"onUpdate:modelValue":e[4]||(e[4]=t=>n.value.breakTime=t),placeholder:"例如：12:00~13:00"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),A("span",q,[l(r,{onClick:e[5]||(e[5]=t=>_.value=!1)},{default:a(()=>e[21]||(e[21]=[p("取消")])),_:1}),l(r,{type:"primary",onClick:F},{default:a(()=>e[22]||(e[22]=[p("儲存")])),_:1})])]),_:1},8,["modelValue"])]),_:1}),l(g,{label:"異常判定規則",name:"abnormal"},{default:a(()=>[l(T,{model:u.value,"label-width":"140px",class:"rule-form"},{default:a(()=>[l(o,{label:"遲到容許誤差(分鐘)"},{default:a(()=>[l(f,{modelValue:u.value.lateGrace,"onUpdate:modelValue":e[7]||(e[7]=t=>u.value.lateGrace=t),min:0},null,8,["modelValue"])]),_:1}),l(o,{label:"早退容許誤差(分鐘)"},{default:a(()=>[l(f,{modelValue:u.value.earlyLeaveGrace,"onUpdate:modelValue":e[8]||(e[8]=t=>u.value.earlyLeaveGrace=t),min:0},null,8,["modelValue"])]),_:1}),l(o,{label:"缺卡判斷時間(分鐘)"},{default:a(()=>[l(f,{modelValue:u.value.missingThreshold,"onUpdate:modelValue":e[9]||(e[9]=t=>u.value.missingThreshold=t),min:0},null,8,["modelValue"])]),_:1}),l(o,{label:"未打卡自動通知"},{default:a(()=>[l(R,{modelValue:u.value.autoNotify,"onUpdate:modelValue":e[10]||(e[10]=t=>u.value.autoNotify=t),"active-text":"啟用","inactive-text":"停用"},null,8,["modelValue"])]),_:1}),l(o,null,{default:a(()=>[l(r,{type:"primary",onClick:I},{default:a(()=>e[23]||(e[23]=[p("儲存規則")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(g,{label:"分段打卡/外出",name:"break-outing"},{default:a(()=>[l(T,{model:m.value,"label-width":"140px",class:"rule-form"},{default:a(()=>[l(o,{label:"是否允許分段打卡"},{default:a(()=>[l(R,{modelValue:m.value.enableBreakPunch,"onUpdate:modelValue":e[11]||(e[11]=t=>m.value.enableBreakPunch=t),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),l(o,{label:"分段打卡最少間隔(分鐘)"},{default:a(()=>[l(f,{modelValue:m.value.breakInterval,"onUpdate:modelValue":e[12]||(e[12]=t=>m.value.breakInterval=t),min:0,disabled:!m.value.enableBreakPunch},null,8,["modelValue","disabled"])]),_:1}),l(o,{label:"外出登記需審核"},{default:a(()=>[l(R,{modelValue:m.value.outingNeedApprove,"onUpdate:modelValue":e[13]||(e[13]=t=>m.value.outingNeedApprove=t),"active-text":"需要","inactive-text":"不需要"},null,8,["modelValue"])]),_:1}),l(o,null,{default:a(()=>[l(r,{type:"primary",onClick:P},{default:a(()=>e[24]||(e[24]=[p("儲存設定")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(g,{label:"加班規則",name:"overtime"},{default:a(()=>[l(T,{model:s.value,"label-width":"120px",class:"rule-form"},{default:a(()=>[l(o,{label:"平日加班起算(分)"},{default:a(()=>[l(f,{modelValue:s.value.weekdayThreshold,"onUpdate:modelValue":e[14]||(e[14]=t=>s.value.weekdayThreshold=t),min:0},null,8,["modelValue"])]),_:1}),l(o,{label:"假日加班倍數"},{default:a(()=>[l(f,{modelValue:s.value.holidayRate,"onUpdate:modelValue":e[15]||(e[15]=t=>s.value.holidayRate=t),min:1,step:.1},null,8,["modelValue"])]),_:1}),l(o,{label:"轉補休折算比率"},{default:a(()=>[l(f,{modelValue:s.value.toCompRate,"onUpdate:modelValue":e[16]||(e[16]=t=>s.value.toCompRate=t),min:1,step:.1},null,8,["modelValue"])]),_:1}),l(o,null,{default:a(()=>[l(r,{type:"primary",onClick:$},{default:a(()=>e[25]||(e[25]=[p("儲存加班規則")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])])}}},Y=D(K,[["__scopeId","data-v-71f7132a"]]);export{Y as default};
