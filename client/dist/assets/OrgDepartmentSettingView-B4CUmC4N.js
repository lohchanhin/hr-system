import{a as T}from"./api-C7rdPyNE.js";import{_ as Z,r as c,x as F,j as ee,q as J,c as C,o as f,b as t,d as a,t as p,w as o,e as v,g as m,F as z,l as D,k as I}from"./index-CDuqm2t1.js";const le={class:"org-dept-setting"},ae={class:"page-header"},te={class:"header-stats"},oe={class:"stat-item"},ne={class:"stat-number"},se={class:"stat-item"},de={class:"stat-number"},ue={class:"stat-item"},ie={class:"stat-number"},re={class:"tab-content"},me={class:"content-header"},pe={class:"table-container"},ve={class:"org-info"},fe={class:"org-details"},be={class:"org-name"},ce={class:"org-unit"},Ve={class:"action-buttons"},ge={class:"tab-content"},_e={class:"content-header"},ye={class:"header-actions"},ke={class:"table-container"},Ce={class:"dept-info"},he={class:"dept-details"},Ue={class:"dept-name"},we={class:"dept-unit"},Ne={class:"action-buttons"},$e={class:"tab-content"},xe={class:"content-header"},ze={class:"header-actions"},Ie={class:"table-container"},Se={class:"sub-info"},Le={class:"sub-details"},Te={class:"sub-name"},De={class:"sub-unit"},Oe={class:"headcount-info"},qe={class:"action-buttons"},je={class:"form-section"},Be={class:"form-section"},Ee={class:"form-section"},Fe={key:1,class:"form-section"},Pe={key:2,class:"form-section"},We={class:"dialog-footer"},Je={__name:"OrgDepartmentSetting",setup(A){const O=c("org"),V=c([]),g=c([]),h=c([]),_=c(""),y=c(""),N=c(!1),n=c(W("org")),k=c("org"),$=c(null),M=F(()=>_.value?g.value.filter(s=>s.organization===_.value):g.value),G=F(()=>y.value?h.value.filter(s=>s.department===y.value):h.value),H=F(()=>{const s=k.value==="org"?"機構":k.value==="dept"?"部門":"小單位";return`${$.value===null?"新增":"編輯"}${s}`});function q(s){return s==="org"?"/api/organizations":s==="dept"?"/api/departments":"/api/sub-departments"}async function U(s,e){let u=q(s);e&&(u+=`?${s==="dept"?"organization":"department"}=${e}`);const r=await T(u);if(r.ok){const b=await r.json();s==="org"?V.value=b:s==="dept"?g.value=b:h.value=b}}async function P(){await Promise.all([U("org"),U("dept",_.value),U("sub",y.value)])}function W(s){return s==="org"?{name:"",systemCode:"",unitName:"",orgCode:"",taxIdNumber:"",laborInsuranceNo:"",healthInsuranceNo:"",taxCode:"",address:"",phone:"",principal:""}:s==="dept"?{name:"",code:"",unitName:"",location:"",phone:"",manager:"",organization:""}:{name:"",code:"",unitName:"",location:"",phone:"",manager:"",headcount:0,scheduleSetting:"",department:""}}function w(s,e=null){if(k.value=s,e!==null){$.value=e;const u=s==="org"?V.value[e]:s==="dept"?g.value[e]:h.value[e];n.value={...u}}else $.value=null,n.value=W(s),s==="dept"&&(n.value.organization=_.value),s==="sub"&&(n.value.department=y.value);N.value=!0}async function K(){const s=q(k.value),e=k.value==="org"?V:k.value==="dept"?g:h;let u;if($.value===null)u=await T(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n.value)});else{const r=e.value[$.value]._id;u=await T(`${s}/${r}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n.value)})}u&&u.ok&&(await P(),N.value=!1)}function j(s,e){const u=s==="org"?V:s==="dept"?g:h,r=u.value[e]._id;T(`${q(s)}/${r}`,{method:"DELETE"}).then(b=>{b.ok&&u.value.splice(e,1)})}return ee(P),J(_,s=>{U("dept",s)}),J(y,s=>{U("sub",s)}),(s,e)=>{const u=v("el-button"),r=v("el-table-column"),b=v("el-tag"),B=v("el-table"),E=v("el-tab-pane"),S=v("el-option"),L=v("el-select"),Q=v("el-tabs"),i=v("el-input"),d=v("el-form-item"),R=v("el-input-number"),X=v("el-form"),Y=v("el-dialog");return f(),C("div",le,[t("div",ae,[e[40]||(e[40]=t("div",{class:"header-content"},[t("h1",{class:"page-title"},"機構與部門設定"),t("p",{class:"page-description"},"管理組織架構、部門層級和小單位配置")],-1)),t("div",te,[t("div",oe,[t("div",ne,p(V.value.length),1),e[37]||(e[37]=t("div",{class:"stat-label"},"機構",-1))]),t("div",se,[t("div",de,p(g.value.length),1),e[38]||(e[38]=t("div",{class:"stat-label"},"部門",-1))]),t("div",ue,[t("div",ie,p(h.value.length),1),e[39]||(e[39]=t("div",{class:"stat-label"},"小單位",-1))])])]),a(Q,{modelValue:O.value,"onUpdate:modelValue":e[7]||(e[7]=l=>O.value=l),type:"card",class:"org-tabs"},{default:o(()=>[a(E,{name:"org"},{label:o(()=>e[41]||(e[41]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-office-building"}),t("span",null,"機構管理")],-1)])),default:o(()=>[t("div",re,[t("div",me,[e[43]||(e[43]=t("h2",{class:"section-title"},"機構列表",-1)),a(u,{type:"primary",onClick:e[0]||(e[0]=l=>w("org")),class:"add-btn"},{default:o(()=>e[42]||(e[42]=[t("i",{class:"el-icon-plus"},null,-1),m(" 新增機構 ")])),_:1})]),t("div",pe,[a(B,{data:V.value,class:"data-table","header-cell-style":{background:"#f8fafc",color:"#475569",fontWeight:"600"},"row-style":{height:"56px"}},{default:o(()=>[a(r,{prop:"name",label:"機構名稱","min-width":"200"},{default:o(({row:l})=>[t("div",ve,[e[44]||(e[44]=t("div",{class:"org-icon"},[t("i",{class:"el-icon-office-building"})],-1)),t("div",fe,[t("div",be,p(l.name),1),t("div",ce,p(l.unitName||"未設定"),1)])])]),_:1}),a(r,{prop:"systemCode",label:"系統代碼",width:"140"},{default:o(({row:l})=>[a(b,{class:"code-tag"},{default:o(()=>[m(p(l.systemCode||"-"),1)]),_:2},1024)]),_:1}),a(r,{prop:"phone",label:"聯絡電話",width:"150"}),a(r,{prop:"principal",label:"負責人",width:"120"}),a(r,{label:"操作",width:"200",fixed:"right"},{default:o(({$index:l})=>[t("div",Ve,[a(u,{type:"primary",size:"small",onClick:x=>w("org",l),class:"edit-btn"},{default:o(()=>e[45]||(e[45]=[t("i",{class:"el-icon-edit"},null,-1),m(" 編輯 ")])),_:2},1032,["onClick"]),a(u,{type:"danger",size:"small",onClick:x=>j("org",l),class:"delete-btn"},{default:o(()=>e[46]||(e[46]=[t("i",{class:"el-icon-delete"},null,-1),m(" 刪除 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])])])]),_:1}),a(E,{name:"dept"},{label:o(()=>e[47]||(e[47]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-s-grid"}),t("span",null,"部門管理")],-1)])),default:o(()=>[t("div",ge,[t("div",_e,[e[49]||(e[49]=t("h2",{class:"section-title"},"部門列表",-1)),t("div",ye,[a(L,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=l=>_.value=l),placeholder:"篩選機構",class:"filter-select",onChange:e[2]||(e[2]=l=>U("dept",_.value)),clearable:""},{default:o(()=>[(f(!0),C(z,null,D(V.value,l=>(f(),I(S,{key:l._id,label:l.name,value:l._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(u,{type:"primary",onClick:e[3]||(e[3]=l=>w("dept")),class:"add-btn"},{default:o(()=>e[48]||(e[48]=[t("i",{class:"el-icon-plus"},null,-1),m(" 新增部門 ")])),_:1})])]),t("div",ke,[a(B,{data:M.value,class:"data-table","header-cell-style":{background:"#f8fafc",color:"#475569",fontWeight:"600"},"row-style":{height:"56px"}},{default:o(()=>[a(r,{prop:"name",label:"部門名稱","min-width":"200"},{default:o(({row:l})=>[t("div",Ce,[e[50]||(e[50]=t("div",{class:"dept-icon"},[t("i",{class:"el-icon-s-grid"})],-1)),t("div",he,[t("div",Ue,p(l.name),1),t("div",we,p(l.unitName||"未設定"),1)])])]),_:1}),a(r,{prop:"code",label:"部門代碼",width:"140"},{default:o(({row:l})=>[a(b,{type:"success",class:"code-tag"},{default:o(()=>[m(p(l.code||"-"),1)]),_:2},1024)]),_:1}),a(r,{prop:"location",label:"位置",width:"150"}),a(r,{prop:"manager",label:"部門主管",width:"120"}),a(r,{label:"操作",width:"200",fixed:"right"},{default:o(({$index:l})=>[t("div",Ne,[a(u,{type:"primary",size:"small",onClick:x=>w("dept",l),class:"edit-btn"},{default:o(()=>e[51]||(e[51]=[t("i",{class:"el-icon-edit"},null,-1),m(" 編輯 ")])),_:2},1032,["onClick"]),a(u,{type:"danger",size:"small",onClick:x=>j("dept",l),class:"delete-btn"},{default:o(()=>e[52]||(e[52]=[t("i",{class:"el-icon-delete"},null,-1),m(" 刪除 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])])])]),_:1}),a(E,{name:"sub"},{label:o(()=>e[53]||(e[53]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-menu"}),t("span",null,"小單位管理")],-1)])),default:o(()=>[t("div",$e,[t("div",xe,[e[55]||(e[55]=t("h2",{class:"section-title"},"小單位列表",-1)),t("div",ze,[a(L,{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=l=>y.value=l),placeholder:"篩選部門",class:"filter-select",onChange:e[5]||(e[5]=l=>U("sub",y.value)),clearable:""},{default:o(()=>[(f(!0),C(z,null,D(g.value,l=>(f(),I(S,{key:l._id,label:l.name,value:l._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(u,{type:"primary",onClick:e[6]||(e[6]=l=>w("sub")),class:"add-btn"},{default:o(()=>e[54]||(e[54]=[t("i",{class:"el-icon-plus"},null,-1),m(" 新增小單位 ")])),_:1})])]),t("div",Ie,[a(B,{data:G.value,class:"data-table","header-cell-style":{background:"#f8fafc",color:"#475569",fontWeight:"600"},"row-style":{height:"56px"}},{default:o(()=>[a(r,{prop:"name",label:"小單位名稱","min-width":"200"},{default:o(({row:l})=>[t("div",Se,[e[56]||(e[56]=t("div",{class:"sub-icon"},[t("i",{class:"el-icon-menu"})],-1)),t("div",Le,[t("div",Te,p(l.name),1),t("div",De,p(l.unitName||"未設定"),1)])])]),_:1}),a(r,{prop:"code",label:"代碼",width:"120"},{default:o(({row:l})=>[a(b,{type:"info",class:"code-tag"},{default:o(()=>[m(p(l.code||"-"),1)]),_:2},1024)]),_:1}),a(r,{prop:"headcount",label:"人力需求",width:"100"},{default:o(({row:l})=>[t("div",Oe,[e[57]||(e[57]=t("i",{class:"el-icon-user"},null,-1)),m(" "+p(l.headcount||0),1)])]),_:1}),a(r,{prop:"manager",label:"主管",width:"120"}),a(r,{label:"操作",width:"200",fixed:"right"},{default:o(({$index:l})=>[t("div",qe,[a(u,{type:"primary",size:"small",onClick:x=>w("sub",l),class:"edit-btn"},{default:o(()=>e[58]||(e[58]=[t("i",{class:"el-icon-edit"},null,-1),m(" 編輯 ")])),_:2},1032,["onClick"]),a(u,{type:"danger",size:"small",onClick:x=>j("sub",l),class:"delete-btn"},{default:o(()=>e[59]||(e[59]=[t("i",{class:"el-icon-delete"},null,-1),m(" 刪除 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])])])]),_:1})]),_:1},8,["modelValue"]),a(Y,{modelValue:N.value,"onUpdate:modelValue":e[36]||(e[36]=l=>N.value=l),title:H.value,width:"600px",class:"form-dialog"},{footer:o(()=>[t("div",We,[a(u,{onClick:e[35]||(e[35]=l=>N.value=!1),class:"cancel-btn"},{default:o(()=>e[65]||(e[65]=[m("取消")])),_:1}),a(u,{type:"primary",onClick:K,class:"save-btn"},{default:o(()=>e[66]||(e[66]=[t("i",{class:"el-icon-check"},null,-1),m(" 儲存 ")])),_:1})])]),default:o(()=>[a(X,{model:n.value,"label-width":"120px",class:"dialog-form"},{default:o(()=>[k.value==="org"?(f(),C(z,{key:0},[t("div",je,[e[60]||(e[60]=t("h3",{class:"form-section-title"},"基本資訊",-1)),a(d,{label:"機構名稱",required:""},{default:o(()=>[a(i,{modelValue:n.value.name,"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.name=l),placeholder:"請輸入機構名稱"},null,8,["modelValue"])]),_:1}),a(d,{label:"系統代碼"},{default:o(()=>[a(i,{modelValue:n.value.systemCode,"onUpdate:modelValue":e[9]||(e[9]=l=>n.value.systemCode=l),placeholder:"請輸入系統代碼"},null,8,["modelValue"])]),_:1}),a(d,{label:"單位名稱"},{default:o(()=>[a(i,{modelValue:n.value.unitName,"onUpdate:modelValue":e[10]||(e[10]=l=>n.value.unitName=l),placeholder:"請輸入單位名稱"},null,8,["modelValue"])]),_:1}),a(d,{label:"機構代碼"},{default:o(()=>[a(i,{modelValue:n.value.orgCode,"onUpdate:modelValue":e[11]||(e[11]=l=>n.value.orgCode=l),placeholder:"請輸入機構代碼"},null,8,["modelValue"])]),_:1})]),t("div",Be,[e[61]||(e[61]=t("h3",{class:"form-section-title"},"證照資訊",-1)),a(d,{label:"統一編號"},{default:o(()=>[a(i,{modelValue:n.value.taxIdNumber,"onUpdate:modelValue":e[12]||(e[12]=l=>n.value.taxIdNumber=l),placeholder:"請輸入統一編號"},null,8,["modelValue"])]),_:1}),a(d,{label:"勞保編號"},{default:o(()=>[a(i,{modelValue:n.value.laborInsuranceNo,"onUpdate:modelValue":e[13]||(e[13]=l=>n.value.laborInsuranceNo=l),placeholder:"請輸入勞保編號"},null,8,["modelValue"])]),_:1}),a(d,{label:"健保編號"},{default:o(()=>[a(i,{modelValue:n.value.healthInsuranceNo,"onUpdate:modelValue":e[14]||(e[14]=l=>n.value.healthInsuranceNo=l),placeholder:"請輸入健保編號"},null,8,["modelValue"])]),_:1}),a(d,{label:"稅籍編號"},{default:o(()=>[a(i,{modelValue:n.value.taxCode,"onUpdate:modelValue":e[15]||(e[15]=l=>n.value.taxCode=l),placeholder:"請輸入稅籍編號"},null,8,["modelValue"])]),_:1})]),t("div",Ee,[e[62]||(e[62]=t("h3",{class:"form-section-title"},"聯絡資訊",-1)),a(d,{label:"位置"},{default:o(()=>[a(i,{modelValue:n.value.address,"onUpdate:modelValue":e[16]||(e[16]=l=>n.value.address=l),placeholder:"請輸入地址"},null,8,["modelValue"])]),_:1}),a(d,{label:"連絡電話"},{default:o(()=>[a(i,{modelValue:n.value.phone,"onUpdate:modelValue":e[17]||(e[17]=l=>n.value.phone=l),placeholder:"請輸入連絡電話"},null,8,["modelValue"])]),_:1}),a(d,{label:"負責人"},{default:o(()=>[a(i,{modelValue:n.value.principal,"onUpdate:modelValue":e[18]||(e[18]=l=>n.value.principal=l),placeholder:"請輸入負責人姓名"},null,8,["modelValue"])]),_:1})])],64)):k.value==="dept"?(f(),C("div",Fe,[e[63]||(e[63]=t("h3",{class:"form-section-title"},"部門資訊",-1)),a(d,{label:"所屬機構",required:""},{default:o(()=>[a(L,{modelValue:n.value.organization,"onUpdate:modelValue":e[19]||(e[19]=l=>n.value.organization=l),placeholder:"選擇機構",style:{width:"100%"}},{default:o(()=>[(f(!0),C(z,null,D(V.value,l=>(f(),I(S,{key:l._id,label:l.name,value:l._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"部門名稱",required:""},{default:o(()=>[a(i,{modelValue:n.value.name,"onUpdate:modelValue":e[20]||(e[20]=l=>n.value.name=l),placeholder:"請輸入部門名稱"},null,8,["modelValue"])]),_:1}),a(d,{label:"部門代碼"},{default:o(()=>[a(i,{modelValue:n.value.code,"onUpdate:modelValue":e[21]||(e[21]=l=>n.value.code=l),placeholder:"請輸入部門代碼"},null,8,["modelValue"])]),_:1}),a(d,{label:"單位名稱"},{default:o(()=>[a(i,{modelValue:n.value.unitName,"onUpdate:modelValue":e[22]||(e[22]=l=>n.value.unitName=l),placeholder:"請輸入單位名稱"},null,8,["modelValue"])]),_:1}),a(d,{label:"位置"},{default:o(()=>[a(i,{modelValue:n.value.location,"onUpdate:modelValue":e[23]||(e[23]=l=>n.value.location=l),placeholder:"請輸入部門位置"},null,8,["modelValue"])]),_:1}),a(d,{label:"連絡電話"},{default:o(()=>[a(i,{modelValue:n.value.phone,"onUpdate:modelValue":e[24]||(e[24]=l=>n.value.phone=l),placeholder:"請輸入連絡電話"},null,8,["modelValue"])]),_:1}),a(d,{label:"部門主管"},{default:o(()=>[a(i,{modelValue:n.value.manager,"onUpdate:modelValue":e[25]||(e[25]=l=>n.value.manager=l),placeholder:"請輸入部門主管姓名"},null,8,["modelValue"])]),_:1})])):(f(),C("div",Pe,[e[64]||(e[64]=t("h3",{class:"form-section-title"},"小單位資訊",-1)),a(d,{label:"所屬部門",required:""},{default:o(()=>[a(L,{modelValue:n.value.department,"onUpdate:modelValue":e[26]||(e[26]=l=>n.value.department=l),placeholder:"選擇部門",style:{width:"100%"}},{default:o(()=>[(f(!0),C(z,null,D(g.value,l=>(f(),I(S,{key:l._id,label:l.name,value:l._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"小單位名稱",required:""},{default:o(()=>[a(i,{modelValue:n.value.name,"onUpdate:modelValue":e[27]||(e[27]=l=>n.value.name=l),placeholder:"請輸入小單位名稱"},null,8,["modelValue"])]),_:1}),a(d,{label:"代碼"},{default:o(()=>[a(i,{modelValue:n.value.code,"onUpdate:modelValue":e[28]||(e[28]=l=>n.value.code=l),placeholder:"請輸入代碼"},null,8,["modelValue"])]),_:1}),a(d,{label:"單位名稱"},{default:o(()=>[a(i,{modelValue:n.value.unitName,"onUpdate:modelValue":e[29]||(e[29]=l=>n.value.unitName=l),placeholder:"請輸入單位名稱"},null,8,["modelValue"])]),_:1}),a(d,{label:"位置"},{default:o(()=>[a(i,{modelValue:n.value.location,"onUpdate:modelValue":e[30]||(e[30]=l=>n.value.location=l),placeholder:"請輸入位置"},null,8,["modelValue"])]),_:1}),a(d,{label:"連絡電話"},{default:o(()=>[a(i,{modelValue:n.value.phone,"onUpdate:modelValue":e[31]||(e[31]=l=>n.value.phone=l),placeholder:"請輸入連絡電話"},null,8,["modelValue"])]),_:1}),a(d,{label:"部門主管"},{default:o(()=>[a(i,{modelValue:n.value.manager,"onUpdate:modelValue":e[32]||(e[32]=l=>n.value.manager=l),placeholder:"請輸入主管姓名"},null,8,["modelValue"])]),_:1}),a(d,{label:"人力需求數"},{default:o(()=>[a(R,{modelValue:n.value.headcount,"onUpdate:modelValue":e[33]||(e[33]=l=>n.value.headcount=l),min:0,placeholder:"請輸入人力需求數"},null,8,["modelValue"])]),_:1}),a(d,{label:"班表拉選"},{default:o(()=>[a(i,{modelValue:n.value.scheduleSetting,"onUpdate:modelValue":e[34]||(e[34]=l=>n.value.scheduleSetting=l),placeholder:"請輸入班表設定"},null,8,["modelValue"])]),_:1})]))]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ae=Z(Je,[["__scopeId","data-v-7ad42728"]]),He={__name:"OrgDepartmentSettingView",setup(A){return(O,V)=>(f(),I(Ae))}};export{He as default};
