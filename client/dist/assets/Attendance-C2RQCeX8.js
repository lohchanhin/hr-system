import{_ as S,r,j as B,L as J,c as U,b as t,d as l,t as m,w as i,e as p,J as b,o as q,g as k,E as F,q as L}from"./index-Bzhab6Am.js";import{a as V}from"./api-2KlvJGqf.js";const P={class:"attendance-page"},W={class:"page-header"},$={class:"current-time"},z={class:"time-display"},G={class:"date-display"},K={class:"records-section"},Q={class:"table-container"},X={class:"time-cell"},Z={class:"remark-text"},tt={class:"dialog-footer"},et={__name:"Attendance",setup(nt){const w={上班簽到:"clockIn",下班簽退:"clockOut",外出登記:"outing",中午休息:"breakIn"},I=Object.fromEntries(Object.entries(w).map(([n,e])=>[e,n])),g=r([]),M=r(""),Y=r("");let y=null;const u=r(!1),f=r(""),C=r("");async function x(){const n=await V("/api/attendance");if(n.ok){const e=await n.json();g.value=e.map(a=>{const o=a.timestamp;return{action:I[a.action]||a.action,time:o?b(o).format("YYYY/MM/DD HH:mm:ss"):"",remark:a.remark||"",timestamp:o}})}}function T(){v("上班簽到")}function O(){v("下班簽退")}function j(){v("外出登記")}function H(){v("中午休息")}function v(n){C.value=n,f.value="",u.value=!0}async function A(){u.value=!1,await N(C.value,f.value)}function E(){let n=localStorage.getItem("employeeId");if(!n){const e=L();if(e)try{const a=JSON.parse(atob(e.split(".")[1]));n=a.employeeId||a.id}catch{n=null}}return n}async function N(n,e=""){const a=E();if(!a){F.warning("請重新登入");return}const o={action:w[n]||n,timestamp:new Date,remark:e,employee:a},_=await V("/api/attendance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(_.ok){const c=await _.json(),d=c.timestamp||o.timestamp,h={action:I[c.action]||c.action,time:d?b(d).format("YYYY/MM/DD HH:mm:ss"):"",remark:c.remark||"",timestamp:d};g.value.unshift(h)}}function D(){const n=b();M.value=n.format("HH:mm:ss"),Y.value=n.format("YYYY/MM/DD")}function R(n){return{上班簽到:"success",下班簽退:"warning",外出登記:"info",中午休息:"primary"}[n]||"default"}return B(()=>{x(),D(),y=setInterval(D,1e3)}),J(()=>{y&&clearInterval(y)}),(n,e)=>{const a=p("el-tag"),o=p("el-table-column"),_=p("el-table"),c=p("el-input"),d=p("el-button"),h=p("el-dialog");return q(),U("div",P,[t("div",W,[e[3]||(e[3]=t("div",{class:"header-content"},[t("h1",{class:"page-title"},"出勤打卡"),t("p",{class:"page-description"},"快速進行上下班打卡、外出登記和補卡操作")],-1)),t("div",$,[t("div",z,m(M.value),1),t("div",G,m(Y.value),1)])]),t("div",{class:"punch-section"},[e[8]||(e[8]=t("h2",{class:"section-title"},"快速打卡",-1)),t("div",{class:"punch-grid"},[t("div",{class:"punch-card",onClick:T},e[4]||(e[4]=[t("div",{class:"punch-icon clock-in"},[t("i",{class:"el-icon-sunrise"})],-1),t("h3",{class:"punch-title"},"上班簽到",-1),t("p",{class:"punch-desc"},"開始新的一天",-1)])),t("div",{class:"punch-card",onClick:O},e[5]||(e[5]=[t("div",{class:"punch-icon clock-out"},[t("i",{class:"el-icon-sunset"})],-1),t("h3",{class:"punch-title"},"下班簽退",-1),t("p",{class:"punch-desc"},"結束工作時間",-1)])),t("div",{class:"punch-card",onClick:j},e[6]||(e[6]=[t("div",{class:"punch-icon outing"},[t("i",{class:"el-icon-position"})],-1),t("h3",{class:"punch-title"},"外出登記",-1),t("p",{class:"punch-desc"},"臨時外出記錄",-1)])),t("div",{class:"punch-card",onClick:H},e[7]||(e[7]=[t("div",{class:"punch-icon break-time"},[t("i",{class:"el-icon-coffee-cup"})],-1),t("h3",{class:"punch-title"},"休息時間",-1),t("p",{class:"punch-desc"},"中午休息登記",-1)]))])]),t("div",K,[e[10]||(e[10]=t("h2",{class:"section-title"},"今日打卡記錄",-1)),t("div",Q,[l(_,{data:g.value,class:"records-table","header-cell-style":{background:"#f8fafc",color:"#475569",fontWeight:"600"},"row-style":{height:"56px"}},{default:i(()=>[l(o,{prop:"action",label:"打卡類型",width:"140"},{default:i(({row:s})=>[l(a,{type:R(s.action),class:"action-tag"},{default:i(()=>[k(m(s.action),1)]),_:2},1032,["type"])]),_:1}),l(o,{prop:"time",label:"打卡時間",width:"200"},{default:i(({row:s})=>[t("div",X,[e[9]||(e[9]=t("i",{class:"el-icon-time time-icon"},null,-1)),k(" "+m(s.time),1)])]),_:1}),l(o,{prop:"remark",label:"備註說明"},{default:i(({row:s})=>[t("span",Z,m(s.remark||"無備註"),1)]),_:1})]),_:1},8,["data"])])]),l(h,{modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=s=>u.value=s),title:"新增備註",width:"400px"},{footer:i(()=>[t("span",tt,[l(d,{onClick:e[1]||(e[1]=s=>u.value=!1)},{default:i(()=>e[11]||(e[11]=[k("取消")])),_:1}),l(d,{type:"primary",onClick:A},{default:i(()=>e[12]||(e[12]=[k("確認")])),_:1})])]),default:i(()=>[l(c,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),placeholder:"請輸入備註（可留空）"},null,8,["modelValue"])]),_:1},8,["modelValue"])])}}},ot=S(et,[["__scopeId","data-v-7b709166"]]);export{ot as default};
