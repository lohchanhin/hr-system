import{_ as C,r as w,y as I,c as x,o as E,b as f,d as r,v as g,w as a,e as m,g as P,E as _,u as T,x as k}from"./index-D4KTiw27.js";import{a as N}from"./api-BCEPQkJB.js";const R={class:"change-password-card"},U={class:"title"},q={class:"description"},B={__name:"ChangePasswordForm",props:{title:{type:String,default:"變更密碼"},description:{type:String,default:"請驗證舊密碼並設定新密碼"},redirectTo:{type:String,default:"/login"}},setup(u){const y=u,h=T(),n=w(null),c=w(!1),o=I({oldPassword:"",newPassword:"",confirmPassword:""}),v={oldPassword:[{required:!0,message:"請輸入舊密碼",trigger:"blur"}],newPassword:[{required:!0,message:"請輸入新密碼",trigger:"blur"},{min:8,message:"新密碼需至少 8 碼",trigger:"blur"},{validator:(t,e,s)=>{const l=/[A-Z]/.test(e||""),i=/[a-z]/.test(e||""),p=/\d/.test(e||"");l&&i&&p?s():s(new Error("需包含大小寫字母與數字"))},trigger:"blur"}],confirmPassword:[{required:!0,message:"請再次輸入新密碼",trigger:"blur"},{validator:(t,e,s)=>{e!==o.newPassword?s(new Error("兩次輸入的密碼不一致")):s()},trigger:"blur"}]};function b(){k(),sessionStorage.removeItem("role"),sessionStorage.removeItem("employeeId"),localStorage.removeItem("role"),localStorage.removeItem("employeeId"),localStorage.removeItem("username")}async function V(){if(!(!n.value||!await n.value.validate().catch(()=>!1))){c.value=!0;try{const e=await N("/api/change-password",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({oldPassword:o.oldPassword,newPassword:o.newPassword})},{autoRedirect:!1}),s=await e.json().catch(()=>({}));if(!e.ok)throw new Error(s.error||"變更密碼失敗");b(),_.success(s.message||"密碼已更新，請重新登入"),h.push(y.redirectTo)}catch(e){_.error((e==null?void 0:e.message)||"變更密碼失敗")}finally{c.value=!1}}}function S(){var t,e;o.oldPassword="",o.newPassword="",o.confirmPassword="",(e=(t=n.value)==null?void 0:t.clearValidate)==null||e.call(t)}return(t,e)=>{const s=m("el-input"),l=m("el-form-item"),i=m("el-button"),p=m("el-form");return E(),x("div",R,[f("h2",U,g(u.title),1),f("p",q,g(u.description),1),r(p,{ref_key:"formRef",ref:n,model:o,rules:v,"label-width":"120px",class:"form-body"},{default:a(()=>[r(l,{label:"舊密碼",prop:"oldPassword"},{default:a(()=>[r(s,{modelValue:o.oldPassword,"onUpdate:modelValue":e[0]||(e[0]=d=>o.oldPassword=d),type:"password",placeholder:"請輸入目前使用的密碼","show-password":"","data-test":"old-password"},null,8,["modelValue"])]),_:1}),r(l,{label:"新密碼",prop:"newPassword"},{default:a(()=>[r(s,{modelValue:o.newPassword,"onUpdate:modelValue":e[1]||(e[1]=d=>o.newPassword=d),type:"password",placeholder:"至少 8 碼，需包含大小寫與數字","show-password":"","data-test":"new-password"},null,8,["modelValue"])]),_:1}),r(l,{label:"確認新密碼",prop:"confirmPassword"},{default:a(()=>[r(s,{modelValue:o.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=d=>o.confirmPassword=d),type:"password",placeholder:"請再次輸入新密碼","show-password":"","data-test":"confirm-password"},null,8,["modelValue"])]),_:1}),r(l,null,{default:a(()=>[r(i,{type:"primary",loading:c.value,onClick:V,"data-test":"submit-btn"},{default:a(()=>e[3]||(e[3]=[P("確認變更")])),_:1},8,["loading"]),r(i,{onClick:S},{default:a(()=>e[4]||(e[4]=[P("重設")])),_:1})]),_:1})]),_:1},8,["model"])])}}},A=C(B,[["__scopeId","data-v-6e9cd634"]]);export{A as C};
