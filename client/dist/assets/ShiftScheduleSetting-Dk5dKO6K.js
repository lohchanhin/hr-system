import{a as b}from"./api-2KlvJGqf.js";import{_ as R,r as v,j as X,c as Z,b as t,d as l,t as f,w as a,e as d,q as y,o as ee,g as u}from"./index-Bzhab6Am.js";const le={class:"shift-schedule-setting"},te={class:"page-header"},ae={class:"header-stats"},oe={class:"stat-item"},se={class:"stat-number"},ie={class:"stat-item"},ne={class:"stat-number"},de={class:"tab-content"},ue={class:"content-header"},re={class:"table-container"},pe={class:"date-info"},me={class:"action-buttons"},ce={class:"dialog-footer"},fe={class:"tab-content"},ve={class:"content-header"},be={class:"table-container"},ye={class:"shift-info"},_e={class:"shift-name"},ge={class:"time-range"},Ve={class:"start-time"},he={class:"end-time"},we={class:"action-buttons"},ke={class:"dialog-footer"},Te={class:"tab-content"},Ce={class:"settings-card"},Ue={class:"form-group"},N="YYYY/MM/DD",S="HH:mm",xe={__name:"ShiftScheduleSetting",setup(Se){const B=v("calendar"),_=v([]),V=v(!1);let k=null;const m=v({date:"",type:"",desc:""});async function $(){const s=await b("/api/holidays",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${y()}`}});s.ok&&(_.value=await s.json())}function j(s=null){s!==null?(k=s,m.value={..._.value[s]}):(k=null,m.value={date:"",type:"",desc:""}),V.value=!0}async function O(){const s=k===null?"POST":"PUT";let e="/api/holidays";if(s==="PUT"){const n=_.value[k]._id;e+=`/${n}`}await b(e,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${y()}`},body:JSON.stringify(m.value)}),await $(),V.value=!1}async function L(s){const e=_.value[s]._id;await b(`/api/holidays/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y()}`}}),await $()}const g=v([]),h=v(!1);let T=null;const i=v({name:"",code:"",startTime:"",endTime:"",crossDay:!1,remark:""});async function D(){const s=await b("/api/shifts",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${y()}`}});if(s.ok){const e=await s.json();g.value=Array.isArray(e==null?void 0:e.shifts)?e.shifts:Array.isArray(e)?e:[]}}function E(s=null){s!==null?(T=s,i.value={...g.value[s]}):(T=null,i.value={name:"",code:"",startTime:"",endTime:"",crossDay:!1,remark:""}),h.value=!0}async function Y(){const s=T===null?"POST":"PUT";let e="/api/shifts";if(s==="PUT"){const n=g.value[T]._id;e+=`/${n}`}await b(e,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${y()}`},body:JSON.stringify(i.value)}),await D(),h.value=!1}async function I(s){const e=g.value[s]._id;await b(`/api/shifts/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y()}`}}),await D()}const p=v({enableHolidayMove:!1,needSignature:!1,needMakeup:!1});async function J(){const s=p.value._id?"PUT":"POST";let e="/api/holiday-move-settings";s==="PUT"&&(e+=`/${p.value._id}`),(await b(e,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${y()}`},body:JSON.stringify(p.value)})).ok&&alert("已儲存「國定假日挪移」設定")}X(()=>{$(),D()});function W(s){return{國定假日:"danger",例假日:"success",公司休息日:"warning",補班日:"info"}[s]||"default"}return(s,e)=>{const n=d("el-button"),c=d("el-table-column"),M=d("el-tag"),P=d("el-table"),G=d("el-date-picker"),r=d("el-form-item"),C=d("el-option"),K=d("el-select"),U=d("el-input"),z=d("el-form"),q=d("el-dialog"),A=d("el-tab-pane"),F=d("el-time-picker"),x=d("el-switch"),Q=d("el-tabs");return ee(),Z("div",le,[t("div",te,[e[21]||(e[21]=t("div",{class:"header-content"},[t("h1",{class:"page-title"},"排班與班別管理設定"),t("p",{class:"page-description"},"管理班別時間、假日設定與國定假日挪移配置")],-1)),t("div",ae,[t("div",oe,[t("div",se,f(_.value.length),1),e[19]||(e[19]=t("div",{class:"stat-label"},"假日",-1))]),t("div",ie,[t("div",ne,f(g.value.length),1),e[20]||(e[20]=t("div",{class:"stat-label"},"班別",-1))])])]),l(Q,{modelValue:B.value,"onUpdate:modelValue":e[18]||(e[18]=o=>B.value=o),type:"card",class:"schedule-tabs"},{default:a(()=>[l(A,{name:"calendar"},{label:a(()=>e[22]||(e[22]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-calendar"}),t("span",null,"行事曆設定")],-1)])),default:a(()=>[t("div",de,[t("div",ue,[e[24]||(e[24]=t("h2",{class:"section-title"},"假日管理",-1)),l(n,{type:"primary",onClick:e[0]||(e[0]=o=>j()),class:"add-btn"},{default:a(()=>e[23]||(e[23]=[t("i",{class:"el-icon-plus"},null,-1),u(" 新增假日 ")])),_:1})]),t("div",re,[l(P,{data:_.value,class:"data-table","header-cell-style":{background:"#f8fafc",color:"#475569",fontWeight:"600"},"row-style":{height:"56px"}},{default:a(()=>[l(c,{prop:"date",label:"日期",width:"160"},{default:a(({row:o})=>[t("div",pe,[e[25]||(e[25]=t("i",{class:"el-icon-date"},null,-1)),u(" "+f(o.date),1)])]),_:1}),l(c,{prop:"type",label:"假日類型",width:"140"},{default:a(({row:o})=>[l(M,{type:W(o.type),class:"holiday-tag"},{default:a(()=>[u(f(o.type),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"desc",label:"描述","min-width":"200"}),l(c,{label:"操作",width:"200",fixed:"right"},{default:a(({row:o,$index:w})=>[t("div",me,[l(n,{type:"primary",size:"small",onClick:H=>j(w),class:"edit-btn"},{default:a(()=>e[26]||(e[26]=[t("i",{class:"el-icon-edit"},null,-1),u(" 編輯 ")])),_:2},1032,["onClick"]),l(n,{type:"danger",size:"small",onClick:H=>L(w),class:"delete-btn"},{default:a(()=>e[27]||(e[27]=[t("i",{class:"el-icon-delete"},null,-1),u(" 刪除 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])]),l(q,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=o=>V.value=o),title:"假日資料",width:"500px",class:"form-dialog"},{footer:a(()=>[t("div",ce,[l(n,{onClick:e[4]||(e[4]=o=>V.value=!1),class:"cancel-btn"},{default:a(()=>e[28]||(e[28]=[u("取消")])),_:1}),l(n,{type:"primary",onClick:O,class:"save-btn"},{default:a(()=>e[29]||(e[29]=[t("i",{class:"el-icon-check"},null,-1),u(" 儲存 ")])),_:1})])]),default:a(()=>[l(z,{model:m.value,"label-width":"120px",class:"dialog-form"},{default:a(()=>[l(r,{label:"日期",required:""},{default:a(()=>[l(G,{modelValue:m.value.date,"onUpdate:modelValue":e[1]||(e[1]=o=>m.value.date=o),type:"date",placeholder:"選擇日期",format:N,"value-format":N,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(r,{label:"假日類型",required:""},{default:a(()=>[l(K,{modelValue:m.value.type,"onUpdate:modelValue":e[2]||(e[2]=o=>m.value.type=o),placeholder:"選擇類型",style:{width:"100%"}},{default:a(()=>[l(C,{label:"國定假日",value:"國定假日"}),l(C,{label:"例假日",value:"例假日"}),l(C,{label:"公司休息日",value:"公司休息日"}),l(C,{label:"補班日",value:"補班日"})]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"描述"},{default:a(()=>[l(U,{modelValue:m.value.desc,"onUpdate:modelValue":e[3]||(e[3]=o=>m.value.desc=o),placeholder:"例如：中秋節 / 週休 等",type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])]),_:1}),l(A,{name:"shift"},{label:a(()=>e[30]||(e[30]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-time"}),t("span",null,"班別設定")],-1)])),default:a(()=>[t("div",fe,[t("div",ve,[e[32]||(e[32]=t("h2",{class:"section-title"},"班別管理",-1)),l(n,{type:"primary",onClick:e[6]||(e[6]=o=>E()),class:"add-btn"},{default:a(()=>e[31]||(e[31]=[t("i",{class:"el-icon-plus"},null,-1),u(" 新增班別 ")])),_:1})]),t("div",be,[l(P,{data:g.value,class:"data-table","header-cell-style":{background:"#f8fafc",color:"#475569",fontWeight:"600"},"row-style":{height:"56px"}},{default:a(()=>[l(c,{prop:"code",label:"代碼",width:"100"},{default:a(({row:o})=>[l(M,{class:"code-tag"},{default:a(()=>[u(f(o.code),1)]),_:2},1024)]),_:1}),l(c,{prop:"name",label:"班別名稱",width:"180"},{default:a(({row:o})=>[t("div",ye,[e[33]||(e[33]=t("div",{class:"shift-icon"},[t("i",{class:"el-icon-time"})],-1)),t("div",_e,f(o.name),1)])]),_:1}),l(c,{label:"工作時間",width:"200"},{default:a(({row:o})=>[t("div",ge,[t("span",Ve,f(o.startTime),1),e[34]||(e[34]=t("i",{class:"el-icon-right time-separator"},null,-1)),t("span",he,f(o.endTime),1)])]),_:1}),l(c,{prop:"crossDay",label:"跨日班",width:"100"},{default:a(({row:o})=>[l(M,{type:o.crossDay?"warning":"success",size:"small"},{default:a(()=>[u(f(o.crossDay?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(c,{prop:"remark",label:"備註","min-width":"150"}),l(c,{label:"操作",width:"200",fixed:"right"},{default:a(({row:o,$index:w})=>[t("div",we,[l(n,{type:"primary",size:"small",onClick:H=>E(w),class:"edit-btn"},{default:a(()=>e[35]||(e[35]=[t("i",{class:"el-icon-edit"},null,-1),u(" 編輯 ")])),_:2},1032,["onClick"]),l(n,{type:"danger",size:"small",onClick:H=>I(w),class:"delete-btn"},{default:a(()=>e[36]||(e[36]=[t("i",{class:"el-icon-delete"},null,-1),u(" 刪除 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])]),l(q,{modelValue:h.value,"onUpdate:modelValue":e[14]||(e[14]=o=>h.value=o),title:"班別資料",width:"500px",class:"form-dialog"},{footer:a(()=>[t("div",ke,[l(n,{onClick:e[13]||(e[13]=o=>h.value=!1),class:"cancel-btn"},{default:a(()=>e[37]||(e[37]=[u("取消")])),_:1}),l(n,{type:"primary",onClick:Y,class:"save-btn"},{default:a(()=>e[38]||(e[38]=[t("i",{class:"el-icon-check"},null,-1),u(" 儲存 ")])),_:1})])]),default:a(()=>[l(z,{model:i.value,"label-width":"120px",class:"dialog-form"},{default:a(()=>[l(r,{label:"班別代碼",required:""},{default:a(()=>[l(U,{modelValue:i.value.code,"onUpdate:modelValue":e[7]||(e[7]=o=>i.value.code=o),placeholder:"如：A1, B2, C3"},null,8,["modelValue"])]),_:1}),l(r,{label:"班別名稱",required:""},{default:a(()=>[l(U,{modelValue:i.value.name,"onUpdate:modelValue":e[8]||(e[8]=o=>i.value.name=o),placeholder:"如：早班 / 夜班 / 彈性班"},null,8,["modelValue"])]),_:1}),l(r,{label:"上班時間",required:""},{default:a(()=>[l(F,{modelValue:i.value.startTime,"onUpdate:modelValue":e[9]||(e[9]=o=>i.value.startTime=o),format:S,"value-format":S,placeholder:"選擇上班時間",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(r,{label:"下班時間",required:""},{default:a(()=>[l(F,{modelValue:i.value.endTime,"onUpdate:modelValue":e[10]||(e[10]=o=>i.value.endTime=o),format:S,"value-format":S,placeholder:"選擇下班時間",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(r,{label:"跨日班"},{default:a(()=>[l(x,{modelValue:i.value.crossDay,"onUpdate:modelValue":e[11]||(e[11]=o=>i.value.crossDay=o),"active-text":"是","inactive-text":"否","active-color":"#10b981"},null,8,["modelValue"])]),_:1}),l(r,{label:"備註"},{default:a(()=>[l(U,{modelValue:i.value.remark,"onUpdate:modelValue":e[12]||(e[12]=o=>i.value.remark=o),type:"textarea",rows:3,placeholder:"班別說明或特殊注意事項"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])]),_:1}),l(A,{name:"holidayMove"},{label:a(()=>e[39]||(e[39]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-s-promotion"}),t("span",null,"國定假日挪移")],-1)])),default:a(()=>[t("div",Te,[t("div",Ce,[e[44]||(e[44]=t("h2",{class:"section-title"},"假日挪移規則",-1)),l(z,{model:p.value,"label-width":"220px",class:"settings-form"},{default:a(()=>[t("div",Ue,[l(r,{label:"是否允許挪移國定假日"},{default:a(()=>[l(x,{modelValue:p.value.enableHolidayMove,"onUpdate:modelValue":e[15]||(e[15]=o=>p.value.enableHolidayMove=o),"active-text":"允許","inactive-text":"禁止","active-color":"#10b981"},null,8,["modelValue"]),e[40]||(e[40]=t("div",{class:"form-help"},"允許員工申請將國定假日挪移到其他日期",-1))]),_:1}),l(r,{label:"挪移申請是否需簽名(電子簽核)"},{default:a(()=>[l(x,{modelValue:p.value.needSignature,"onUpdate:modelValue":e[16]||(e[16]=o=>p.value.needSignature=o),disabled:!p.value.enableHolidayMove,"active-text":"需要","inactive-text":"不需要","active-color":"#10b981"},null,8,["modelValue","disabled"]),e[41]||(e[41]=t("div",{class:"form-help"},"挪移申請是否需要經過電子簽核流程",-1))]),_:1}),l(r,{label:"挪移後是否補班"},{default:a(()=>[l(x,{modelValue:p.value.needMakeup,"onUpdate:modelValue":e[17]||(e[17]=o=>p.value.needMakeup=o),disabled:!p.value.enableHolidayMove,"active-text":"需要","inactive-text":"不需要","active-color":"#10b981"},null,8,["modelValue","disabled"]),e[42]||(e[42]=t("div",{class:"form-help"},"挪移假日後是否需要在其他日期補班",-1))]),_:1})]),l(r,null,{default:a(()=>[l(n,{type:"primary",onClick:J,class:"save-settings-btn"},{default:a(()=>e[43]||(e[43]=[t("i",{class:"el-icon-check"},null,-1),u(" 儲存挪移規則 ")])),_:1})]),_:1})]),_:1},8,["model"])])])]),_:1})]),_:1},8,["modelValue"])])}}},Me=R(xe,[["__scopeId","data-v-0ad8ebd0"]]);export{Me as default};
