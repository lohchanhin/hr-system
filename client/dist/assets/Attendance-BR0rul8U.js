import{_ as S,r as c,j as R,D as U,c as J,b as e,d as o,t as u,w as l,e as d,B as y,o as F,g as _,E as P,p as W}from"./index-CDuqm2t1.js";import{a as C}from"./api-C7rdPyNE.js";const $={class:"attendance-page"},q={class:"page-header"},z={class:"current-time"},G={class:"time-display"},K={class:"date-display"},L={class:"records-section"},Q={class:"table-container"},X={class:"time-cell"},Z={class:"remark-text"},ee={class:"dialog-footer"},te={__name:"Attendance",setup(ne){const h={上班簽到:"clockIn",下班簽退:"clockOut",外出登記:"outing",中午休息:"breakIn"},b=Object.fromEntries(Object.entries(h).map(([n,t])=>[t,n])),k=c([]),w=c(""),I=c("");let g=null;const r=c(!1),m=c(""),D=c("");async function V(){const n=await C("/api/attendance");if(n.ok){const t=await n.json();k.value=t.map(a=>({action:b[a.action]||a.action,time:y(a.timestamp).format("YYYY/MM/DD HH:mm:ss"),remark:a.remark||""}))}}function x(){f("上班簽到")}function T(){f("下班簽退")}function O(){f("外出登記")}function j(){f("中午休息")}function f(n){D.value=n,m.value="",r.value=!0}async function H(){r.value=!1,await B(D.value,m.value)}function A(){let n=localStorage.getItem("employeeId");if(!n){const t=W();if(t)try{const a=JSON.parse(atob(t.split(".")[1]));n=a.employeeId||a.id}catch{n=null}}return n}async function B(n,t=""){const a=A();if(!a){P.warning("請重新登入");return}const p={action:h[n]||n,timestamp:new Date,remark:t,employee:a},v=await C("/api/attendance",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)});if(v.ok){const i=await v.json();k.value.push({action:b[i.action]||i.action,time:y(i.timestamp).format("YYYY/MM/DD HH:mm:ss"),remark:i.remark||""})}}function M(){const n=y();w.value=n.format("HH:mm:ss"),I.value=n.format("YYYY/MM/DD")}function E(n){return{上班簽到:"success",下班簽退:"warning",外出登記:"info",中午休息:"primary"}[n]||"default"}return R(()=>{V(),M(),g=setInterval(M,1e3)}),U(()=>{g&&clearInterval(g)}),(n,t)=>{const a=d("el-tag"),p=d("el-table-column"),v=d("el-table"),i=d("el-input"),Y=d("el-button"),N=d("el-dialog");return F(),J("div",$,[e("div",q,[t[3]||(t[3]=e("div",{class:"header-content"},[e("h1",{class:"page-title"},"出勤打卡"),e("p",{class:"page-description"},"快速進行上下班打卡、外出登記和補卡操作")],-1)),e("div",z,[e("div",G,u(w.value),1),e("div",K,u(I.value),1)])]),e("div",{class:"punch-section"},[t[8]||(t[8]=e("h2",{class:"section-title"},"快速打卡",-1)),e("div",{class:"punch-grid"},[e("div",{class:"punch-card",onClick:x},t[4]||(t[4]=[e("div",{class:"punch-icon clock-in"},[e("i",{class:"el-icon-sunrise"})],-1),e("h3",{class:"punch-title"},"上班簽到",-1),e("p",{class:"punch-desc"},"開始新的一天",-1)])),e("div",{class:"punch-card",onClick:T},t[5]||(t[5]=[e("div",{class:"punch-icon clock-out"},[e("i",{class:"el-icon-sunset"})],-1),e("h3",{class:"punch-title"},"下班簽退",-1),e("p",{class:"punch-desc"},"結束工作時間",-1)])),e("div",{class:"punch-card",onClick:O},t[6]||(t[6]=[e("div",{class:"punch-icon outing"},[e("i",{class:"el-icon-position"})],-1),e("h3",{class:"punch-title"},"外出登記",-1),e("p",{class:"punch-desc"},"臨時外出記錄",-1)])),e("div",{class:"punch-card",onClick:j},t[7]||(t[7]=[e("div",{class:"punch-icon break-time"},[e("i",{class:"el-icon-coffee-cup"})],-1),e("h3",{class:"punch-title"},"休息時間",-1),e("p",{class:"punch-desc"},"中午休息登記",-1)]))])]),e("div",L,[t[10]||(t[10]=e("h2",{class:"section-title"},"今日打卡記錄",-1)),e("div",Q,[o(v,{data:k.value,class:"records-table","header-cell-style":{background:"#f8fafc",color:"#475569",fontWeight:"600"},"row-style":{height:"56px"}},{default:l(()=>[o(p,{prop:"action",label:"打卡類型",width:"140"},{default:l(({row:s})=>[o(a,{type:E(s.action),class:"action-tag"},{default:l(()=>[_(u(s.action),1)]),_:2},1032,["type"])]),_:1}),o(p,{prop:"time",label:"打卡時間",width:"200"},{default:l(({row:s})=>[e("div",X,[t[9]||(t[9]=e("i",{class:"el-icon-time time-icon"},null,-1)),_(" "+u(s.time),1)])]),_:1}),o(p,{prop:"remark",label:"備註說明"},{default:l(({row:s})=>[e("span",Z,u(s.remark||"無備註"),1)]),_:1})]),_:1},8,["data"])])]),o(N,{modelValue:r.value,"onUpdate:modelValue":t[2]||(t[2]=s=>r.value=s),title:"新增備註",width:"400px"},{footer:l(()=>[e("span",ee,[o(Y,{onClick:t[1]||(t[1]=s=>r.value=!1)},{default:l(()=>t[11]||(t[11]=[_("取消")])),_:1}),o(Y,{type:"primary",onClick:H},{default:l(()=>t[12]||(t[12]=[_("確認")])),_:1})])]),default:l(()=>[o(i,{modelValue:m.value,"onUpdate:modelValue":t[0]||(t[0]=s=>m.value=s),placeholder:"請輸入備註（可留空）"},null,8,["modelValue"])]),_:1},8,["modelValue"])])}}},oe=S(te,[["__scopeId","data-v-635d2196"]]);export{oe as default};
