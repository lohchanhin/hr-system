import{_ as Y,r as d,K as h,j as M,k as w,c as _,d as i,l as S,e as u,w as j,y as N,o as m}from"./index-Bc12ixp6.js";import{a as y}from"./api-BuNyVVPZ.js";const x={class:"my-schedule"},I={key:1},V={__name:"MySchedule",setup(g){const r=d([]),p=d({}),s=d(h().format("YYYY-MM"));function b(t){if(!t)return"";const e=(t.name||"").trim(),a=(t.code||"").trim();return e&&a?`${e} (${a})`:e||a}async function k(){try{const t=await y("/api/shifts"),e=await t.json().catch(()=>null);if(!t.ok)return;const a=Array.isArray(e)?e:[];p.value=Object.fromEntries(a.map(o=>[o._id,{name:o.name||"",code:o.code||""}]))}catch(t){console.error(t)}}async function f(){const t=N();if(t)try{await k();const e=JSON.parse(atob(t.split(".")[1])),a=e.employeeId||e.id||e._id||e.sub;if(!a)return;const o=new URLSearchParams({month:s.value});o.set("employee",a);const n=await y(`/api/schedules/monthly?${o.toString()}`);if(n.ok){const l=await n.json();r.value=l.map(c=>{const v=p.value[c.shiftId];return{...c,date:h(c.date).format("YYYY/MM/DD"),shiftName:b(v)||c.shiftName||""}})}}catch(e){console.error(e)}}return M(f),w(s,f),(t,e)=>{const a=u("el-date-picker"),o=u("el-table-column"),n=u("el-table");return m(),_("div",x,[i(a,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value=l),type:"month","value-format":"YYYY-MM"},null,8,["modelValue"]),r.value.length?(m(),S(n,{key:0,data:r.value,class:"schedule-table"},{default:j(()=>[i(o,{prop:"date",label:"日期",width:"120"}),i(o,{prop:"shiftName",label:"班別"})]),_:1},8,["data"])):(m(),_("p",I,"目前無排班資料"))])}}},A=Y(V,[["__scopeId","data-v-903e10fb"]]);export{A as default};
