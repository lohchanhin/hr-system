import{B as V,r as I,_ as $,i as z,v as g,C as j,j as U,c as B,b as t,d as o,w as n,e as r,t as d,u as O,o as S,F as q,m as A,h as G,l as H,n as J,g as K,p as Q}from"./index-B6oJpjLF.js";import{u as W}from"./menu-VqsHPQtl.js";import{a as X}from"./api-C-QqRWhG.js";function Y(){var s,l;return typeof window>"u"?null:((s=window.sessionStorage)==null?void 0:s.getItem("employeeId"))||((l=window.localStorage)==null?void 0:l.getItem("employeeId"))||null}const Z=V("profile",()=>{const s=I(null),l=I(!1),c=I(null);async function f({force:i=!1}={}){if(s.value&&!i)return s.value;const _=Y();if(!_)throw s.value=null,c.value=new Error("缺少員工識別碼"),c.value;l.value=!0,c.value=null;try{const u=await X(`/api/profile?employeeId=${encodeURIComponent(_)}`);if(!u.ok)throw new Error("讀取個人資料失敗");const m=await u.json();return s.value=m,m}catch(u){throw c.value=u,s.value=null,u}finally{l.value=!1}}function h(i){s.value=i}function p(){s.value=null,c.value=null}return{profile:s,loading:l,error:c,fetchProfile:f,setProfile:h,clearProfile:p}}),ee={class:"front-layout"},te={class:"sidebar"},oe={class:"sidebar-header"},ne={class:"user-info"},ae={class:"user-name"},se={class:"info-text"},le={class:"info-text"},re={class:"info-text"},ce={class:"info-text"},ie={class:"menu-label"},ue={class:"logout-section"},me={class:"main-view"},de={class:"content-wrapper"},fe="未提供",pe={__name:"FrontLayout",setup(s){const l=O(),c=j(),f=W(),{items:h}=z(f),p=Z(),{profile:i}=z(p),_=I(""),u=g(()=>c.name||"");function m(e,a=fe){if(typeof e=="string"){const y=e.trim();return y.length?y:a}return e?`${e}`:a}const x=g(()=>{var a;const e=(a=i.value)==null?void 0:a.name;return typeof e=="string"&&e.trim().length?e.trim():_.value||"員工"}),k=g(()=>{var e;return m((e=i.value)==null?void 0:e.organizationName)}),C=g(()=>{var e;return m((e=i.value)==null?void 0:e.departmentName)}),P=g(()=>{var e;return m((e=i.value)==null?void 0:e.subDepartmentName)});U(()=>{const e=localStorage.getItem("username");e&&(_.value=e),h.value.length===0&&f.fetchMenu(),p.fetchProfile().catch(()=>{})});function F(e){l.push({name:e})}function M(){localStorage.removeItem("role"),localStorage.removeItem("username"),localStorage.removeItem("employeeId"),sessionStorage.removeItem("employeeId"),Q(),f.setMenu([]),p.clearProfile(),l.push("/")}return(e,a)=>{const y=r("el-avatar"),b=r("el-tooltip"),w=r("el-descriptions-item"),T=r("el-descriptions"),N=r("el-icon"),D=r("el-menu-item"),E=r("el-menu"),L=r("el-button"),R=r("router-view");return S(),B("div",ee,[t("aside",te,[t("div",oe,[a[1]||(a[1]=t("h2",{class:"brand-title"},"員工系統",-1)),t("div",ne,[o(y,{size:40,class:"user-avatar"},{default:n(()=>a[0]||(a[0]=[t("i",{class:"el-icon-user"},null,-1)])),_:1}),t("span",ae,d(x.value),1),o(T,{class:"profile-descriptions",size:"small",column:1,border:"","label-style":{width:"72px"}},{default:n(()=>[o(w,{label:"姓名"},{default:n(()=>[o(b,{content:x.value,placement:"top"},{default:n(()=>[t("span",se,d(x.value),1)]),_:1},8,["content"])]),_:1}),o(w,{label:"機構"},{default:n(()=>[o(b,{content:k.value,placement:"top"},{default:n(()=>[t("span",le,d(k.value),1)]),_:1},8,["content"])]),_:1}),o(w,{label:"部門"},{default:n(()=>[o(b,{content:C.value,placement:"top"},{default:n(()=>[t("span",re,d(C.value),1)]),_:1},8,["content"])]),_:1}),o(w,{label:"小單位"},{default:n(()=>[o(b,{content:P.value,placement:"top"},{default:n(()=>[t("span",ce,d(P.value),1)]),_:1},8,["content"])]),_:1})]),_:1})])]),o(E,{"default-active":u.value,class:"sidebar-menu","background-color":"#0f172a","text-color":"#cbd5e1","active-text-color":"#ffffff"},{default:n(()=>[(S(!0),B(q,null,A(G(h),v=>(S(),H(D,{key:v.name,index:v.name,onClick:_e=>F(v.name),class:"menu-item"},{default:n(()=>[o(N,{class:"menu-icon"},{default:n(()=>[t("i",{class:J(v.icon)},null,2)]),_:2},1024),t("span",ie,d(v.label),1)]),_:2},1032,["index","onClick"]))),128))]),_:1},8,["default-active"]),t("div",ue,[o(L,{type:"danger",onClick:M,class:"logout-btn",block:""},{default:n(()=>[o(N,null,{default:n(()=>a[2]||(a[2]=[t("i",{class:"el-icon-switch-button"},null,-1)])),_:1}),a[3]||(a[3]=K(" 登出系統 "))]),_:1})])]),t("main",me,[t("div",de,[o(R)])])])}}},ye=$(pe,[["__scopeId","data-v-32c57b41"]]);export{ye as default};
