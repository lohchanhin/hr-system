import{a as q}from"./api-RXpq1hcj.js";import{e as ke,o as we}from"./fieldOptions-BCLrdzho.js";import{_ as Ve,r as C,v as j,k as Se,j as Oe,c as h,o as k,b as g,d as a,w as n,e as m,t as A,F as U,m as x,g as p,h as Le,l as R,x as Fe,z as oe,E as S}from"./index-DJQU6_8E.js";const Ne={class:"other-control-setting"},he={class:"tab-content"},Ee={class:"dictionary-action-row"},Ke={class:"dictionary-header"},Te={class:"hint"},qe={class:"dictionary-controls"},Ae={class:"tab-content"},Ue={class:"list-action-row"},xe={class:"dialog-footer"},Re={class:"options-editor"},Ie={class:"dialog-footer"},Je={__name:"OtherControlSetting",setup(ne){var le;const I=C("item-setting"),y=C([{key:"C03",label:"職稱"},{key:"C04",label:"執業職稱"},{key:"C05",label:"語言能力"},{key:"C06",label:"身障等級"},{key:"C07",label:"身分類別"},{key:"C08",label:"教育程度"},{key:"C09",label:"緊急聯絡人稱謂"},{key:"C10",label:"教育訓練積分類別"},{key:"C11",label:"班別設定"},{key:"C12",label:"假別類別"},{key:"C13",label:"加班原因"},{key:"C14",label:"津貼項目"}]);function B(...l){for(const e of l)if(typeof e=="string"&&e.length)return e;return""}function P(l){if(typeof l=="string")return{name:l,code:l};if(l&&typeof l=="object"){const e=typeof l.name=="string"?l.name:B(l.label,l.text,l.display,l.value,l.code),o=typeof l.code=="string"?l.code:B(l.value,l.key,l.name,l.label);return{...l,name:e||o||"",code:o||e||""}}return{name:"",code:""}}const J=["select","checkbox","composite"];let ie=0;function D(l={}){return{id:ie++,name:typeof l.name=="string"?l.name:"",code:typeof l.code=="string"?l.code:""}}function se(l){const e=we(l);return e.length?e.map(o=>D(o)):[]}const re={C03:[{name:"人資專員",code:"HR-S"},{name:"工程師",code:"ENG"}],C04:[{name:"護理師",code:"NURSE"},{name:"會計師",code:"CPA"}],C05:[{name:"英文 — 流利",code:"EN_FL"},{name:"日文 — 進階",code:"JP_ADV"}],C06:[{name:"第一類中度",code:"DISA_MID"},{name:"第二類輕度",code:"DISA_LIGHT"}],C07:[{name:"正式員工",code:"FULLTIME"},{name:"約聘人員",code:"CONTRACT"}],C08:[{name:"博士",code:"PHD"},{name:"大學",code:"BACHELOR"}],C09:[{name:"先生",code:"MR"},{name:"女士",code:"MS"}],C10:[{name:"專業課程",code:"PROFESSIONAL"},{name:"基礎課程",code:"BASIC"}],C11:[{name:"日班",code:"DAY"},{name:"晚班",code:"NIGHT"}],C12:[{name:"特休假",code:"ANNUAL"},{name:"病假",code:"SICK"}],C13:[{name:"專案需求",code:"PROJECT"},{name:"排班調整",code:"SCHEDULE"}],C14:[{name:"交通津貼",code:"TRAFFIC"},{name:"餐費補助",code:"MEAL"}]};function $(){const l={};return y.value.forEach(e=>{const o=re[e.key]||[];l[e.key]=o.map(s=>P(s))}),l}const b=C($()),v=C(((le=y.value[0])==null?void 0:le.key)??""),E=C(!1),L=C(-1),c=C({dictionaryKey:v.value,name:"",code:""}),ue=j(()=>{var l;return((l=y.value.find(e=>e.key===v.value))==null?void 0:l.label)||""}),de=j(()=>L.value>-1?"編輯字典選項":"新增字典選項"),H=[{label:"文字輸入",value:"text"},{label:"多行文字",value:"textarea"},{label:"數字輸入",value:"number"},{label:"單選選項",value:"select"},{label:"複選",value:"checkbox"},{label:"複合加選",value:"composite"},{label:"日期",value:"date"},{label:"時間區間",value:"timeRange"},{label:"布林選項",value:"boolean"}],ce=H.reduce((l,e)=>({...l,[e.value]:e.label}),{}),G=[{label:"員工證字號",fieldKey:"nationalId",type:"text",category:"employee",group:"基本資料",required:!0,description:"供報稅與投保使用"},{label:"制服尺寸",fieldKey:"uniformSize",type:"select",category:"employee",group:"報到資訊",required:!1,description:"入職前通知行政備貨"},{label:"職稱選單 (C03)",fieldKey:"C03",type:"select",category:"dictionary",group:"職務設定",required:!0,description:"維護員工職稱清單"},{label:"執業職稱選單 (C04)",fieldKey:"C04",type:"select",category:"dictionary",group:"職務設定",required:!1,description:"提供專業人員執業職稱選項"},{label:"語言能力庫 (C05)",fieldKey:"C05",type:"composite",category:"dictionary",group:"基本資料",required:!1,description:"設定可勾選的語言能力與層級"},{label:"身障等級 (C06)",fieldKey:"C06",type:"select",category:"dictionary",group:"基本資料",required:!1,description:"維護身心障礙手冊等級"},{label:"身分類別 (C07)",fieldKey:"C07",type:"select",category:"dictionary",group:"基本資料",required:!1,description:"設定身份註記分類"},{label:"教育程度 (C08)",fieldKey:"C08",type:"select",category:"dictionary",group:"學歷資料",required:!1,description:"維護教育程度選單"},{label:"緊急聯絡人稱謂 (C09)",fieldKey:"C09",type:"select",category:"dictionary",group:"聯絡資訊",required:!1,description:"提供緊急聯絡人稱謂選項"},{label:"教育訓練積分類別 (C10)",fieldKey:"C10",type:"select",category:"dictionary",group:"教育訓練",required:!1,description:"維護教育訓練積分類別"},{label:"班別名稱 (C11)",fieldKey:"C11_name",type:"text",category:"dictionary",group:"班別設定",required:!0,description:"顯示於班別選單的名稱"},{label:"班別說明 (C11)",fieldKey:"C11_content",type:"textarea",category:"dictionary",group:"班別設定",required:!1,description:"補充班別內容或注意事項"},{label:"班別時段 (C11)",fieldKey:"C11_timeRange",type:"timeRange",category:"dictionary",group:"班別設定",required:!0,description:"設定班別的起訖時間"},{label:"休息是否計薪 (C11)",fieldKey:"C11_paidBreak",type:"boolean",category:"dictionary",group:"班別設定",required:!1,description:"決定休息時間是否計薪"},{label:"允許彈性時間 (C11)",fieldKey:"C11_allowFlexTime",type:"boolean",category:"dictionary",group:"班別設定",required:!1,description:"是否允許彈性前後時間"},{label:"彈性區間分鐘數 (C11)",fieldKey:"C11_flexWindow",type:"number",category:"dictionary",group:"班別設定",required:!1,description:"可彈性調整的分鐘數"},{label:"假別類別 (C12)",fieldKey:"C12",type:"select",category:"dictionary",group:"假別設定",required:!0,description:"維護假別類別與對應設定"},{label:"加班原因 (C13)",fieldKey:"C13",type:"select",category:"dictionary",group:"加班設定",required:!1,description:"設定常用的加班原因"},{label:"津貼項目 (C14)",fieldKey:"C14",type:"select",category:"dictionary",group:"薪資設定",required:!1,description:"維護津貼或補貼項目"}],f=C([...G]),K=C(!1),T=C(-1),r=C({label:"",fieldKey:"",type:"text",category:"",group:"",required:!1,description:"",options:void 0,optionsList:[]}),M=j(()=>J.includes(r.value.type));function W(){Array.isArray(r.value.optionsList)||(r.value.optionsList=[]),M.value&&(r.value.optionsList.length||r.value.optionsList.push(D()))}Se(()=>r.value.type,l=>{J.includes(l)&&W()});function Y(){Array.isArray(r.value.optionsList)||(r.value.optionsList=[]),r.value.optionsList.push(D())}function pe(l){!Array.isArray(r.value.optionsList)||l<0||(r.value.optionsList.splice(l,1),M.value&&r.value.optionsList.length===0&&Y())}function Q(l,e){if(!Array.isArray(r.value.optionsList))return;const o=l+e;if(o<0||o>=r.value.optionsList.length)return;const s=r.value.optionsList,[u]=s.splice(l,1);s.splice(o,0,u)}Oe(()=>{me()});async function me(){var l;try{const e=await q("/api/other-control-settings",{method:"GET"},{autoRedirect:!1});if(e.ok){const o=await e.json();if(Array.isArray(o.customFields)&&o.customFields.length?f.value=o.customFields:f.value=[...G],o.itemSettings&&typeof o.itemSettings=="object"){Object.keys(o.itemSettings).forEach(u=>{y.value.some(i=>i.key===u)||y.value.push({key:u,label:u})});const s=$();y.value.forEach(u=>{Array.isArray(o.itemSettings[u.key])&&(s[u.key]=o.itemSettings[u.key].map(i=>P(i)))}),b.value=s,y.value.some(u=>u.key===v.value)||(v.value=((l=y.value[0])==null?void 0:l.key)??"")}else b.value=$()}}catch(e){console.warn("載入其他控制設定失敗：",e)}}async function X(l="已儲存字典項目設定"){const e=b.value,o="儲存字典項目時發生問題，請稍後再試";try{const s=await q("/api/other-control-settings/item-settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)},{autoRedirect:!1}),u=await s.text().catch(()=>"");let i=null;if(u)try{i=JSON.parse(u)}catch(d){console.warn("解析儲存字典項目回應時發生錯誤：",d)}if(!s.ok){const d=(i==null?void 0:i.message)||o;throw u&&!(i!=null&&i.message)&&console.error("儲存字典項目失敗回應：",u),new Error(d)}return l&&S.success(l),i??!0}catch(s){return console.error("儲存字典項目時發生例外：",s),S.error((s==null?void 0:s.message)||o),!1}}function Z(l=v.value,e=-1){var o,s;if(l&&(v.value=l),L.value=e,e>-1){const u=(o=b.value[l])==null?void 0:o[e];u&&(c.value={dictionaryKey:l,name:u.name,code:u.code})}else c.value={dictionaryKey:l||((s=y.value[0])==null?void 0:s.key)||"",name:"",code:""};E.value=!0}async function fe(){if(!c.value.name||!c.value.code||!c.value.dictionaryKey){S.warning("請完整填寫字典與選項資訊");return}const l=JSON.parse(JSON.stringify(b.value)),e=c.value.dictionaryKey,o=[...l[e]||[]];L.value>-1?o.splice(L.value,1,{name:c.value.name,code:c.value.code}):o.push({name:c.value.name,code:c.value.code}),b.value={...l,[e]:o};const s=L.value>-1?"已更新字典選項":"已新增字典選項";await X(s)?E.value=!1:b.value=l}async function ye(l,e){if(!l||e<0)return;try{await oe.confirm("確定要刪除此選項嗎？","提醒",{type:"warning"})}catch{return}const o=JSON.parse(JSON.stringify(b.value)),s=[...o[l]||[]];s.splice(e,1),b.value={...o,[l]:s},await X("已刪除字典選項")||(b.value=o)}function ee(l=-1){if(T.value=l,l>-1){const e=f.value[l]||{};r.value={...e,options:e.options,optionsList:se(e.options)}}else r.value={label:"",fieldKey:"",type:"text",category:"",group:"",required:!1,description:"",options:void 0,optionsList:[]};W(),K.value=!0}async function ve(){if(!r.value.label||!r.value.fieldKey){S.warning("欄位名稱與識別代碼為必填");return}const l=JSON.parse(JSON.stringify(f.value)),e=J.includes(r.value.type);let o;e&&(o=ke(r.value.optionsList));const s={...r.value};e&&o!==void 0?s.options=o:delete s.options,delete s.optionsList;const u=JSON.parse(JSON.stringify(s));T.value>-1?f.value.splice(T.value,1,u):f.value.push(u);try{const i=await q("/api/other-control-settings/custom-fields",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({customFields:f.value})},{autoRedirect:!1});if(!i.ok){let d="";try{d=await i.text()}catch(_){console.warn("讀取儲存自訂欄位回應失敗：",_)}let F="儲存自訂欄位失敗，請稍後再試";if(d)try{const _=JSON.parse(d);_!=null&&_.message&&(F=_.message)}catch{F=d}throw new Error(F)}K.value=!1,T.value=-1,S.success("已更新自訂欄位")}catch(i){f.value=l;const d=(i==null?void 0:i.message)||"儲存自訂欄位失敗，請稍後再試";S.error(d)}}async function ge(l){try{await oe.confirm("確定要刪除此欄位嗎？","提醒",{type:"warning"})}catch{return}const e=JSON.parse(JSON.stringify(f.value));f.value.splice(l,1);try{const o=await q("/api/other-control-settings/custom-fields",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({customFields:f.value})},{autoRedirect:!1});if(!o.ok){let s="";try{s=await o.text()}catch(i){console.warn("讀取刪除自訂欄位回應失敗：",i)}let u="刪除自訂欄位失敗，請稍後再試";if(s)try{const i=JSON.parse(s);i!=null&&i.message&&(u=i.message)}catch{u=s}throw new Error(u)}S.success("已刪除自訂欄位")}catch(o){f.value=e;const s=(o==null?void 0:o.message)||"刪除自訂欄位失敗，請稍後再試";S.error(s)}}return(l,e)=>{const o=m("el-alert"),s=m("el-option"),u=m("el-select"),i=m("el-button"),d=m("el-table-column"),F=m("el-table"),_=m("el-tab-pane"),be=m("el-tabs"),w=m("el-form-item"),O=m("el-input"),te=m("el-form"),ae=m("el-dialog"),Ce=m("el-switch"),z=m("el-col"),_e=m("el-row");return k(),h("div",Ne,[e[31]||(e[31]=g("h2",null,"其他控制設定",-1)),a(be,{modelValue:I.value,"onUpdate:modelValue":e[3]||(e[3]=t=>I.value=t),type:"border-card"},{default:n(()=>[a(_,{label:"字典項目",name:"item-setting"},{default:n(()=>[g("div",he,[a(o,{title:"維護人資字典選項，確保報到與流程表單可即時使用最新的項目",type:"info","show-icon":"",class:"info-alert"}),g("div",Ee,[g("div",Ke,[g("h3",null,A(ue.value),1),g("span",Te,"字典代碼："+A(v.value),1)]),g("div",qe,[a(u,{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=t=>v.value=t),size:"small",class:"dictionary-select"},{default:n(()=>[(k(!0),h(U,null,x(y.value,t=>(k(),R(s,{key:t.key,label:`${t.key} ${t.label}`,value:t.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(i,{type:"primary",size:"small",onClick:e[1]||(e[1]=t=>Z())},{default:n(()=>e[17]||(e[17]=[p("新增選項")])),_:1})])]),a(F,{data:b.value[v.value]||[],border:""},{default:n(()=>[a(d,{type:"index",width:"60",label:"#"}),a(d,{prop:"name",label:"選項名稱"}),a(d,{prop:"code",label:"代碼",width:"160"}),a(d,{label:"操作",width:"200"},{default:n(({$index:t})=>[a(i,{size:"small",onClick:V=>Z(v.value,t)},{default:n(()=>e[18]||(e[18]=[p("編輯")])),_:2},1032,["onClick"]),a(i,{size:"small",type:"danger",onClick:V=>ye(v.value,t)},{default:n(()=>e[19]||(e[19]=[p("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1}),a(_,{label:"自訂欄位",name:"custom-field"},{default:n(()=>[g("div",Ae,[a(o,{title:"可用於員工資料或流程表單的額外欄位",type:"info","show-icon":"",class:"info-alert"}),g("div",Ue,[a(i,{type:"primary",onClick:e[2]||(e[2]=t=>ee())},{default:n(()=>e[20]||(e[20]=[p("新增欄位")])),_:1})]),a(F,{data:f.value,border:""},{default:n(()=>[a(d,{prop:"label",label:"欄位名稱",width:"180"}),a(d,{prop:"fieldKey",label:"識別代碼",width:"200"}),a(d,{prop:"type",label:"欄位型別",width:"120"},{default:n(({row:t})=>[p(A(Le(ce)[t.type]||t.type),1)]),_:1}),a(d,{prop:"required",label:"必填",width:"100"},{default:n(({row:t})=>[p(A(t.required?"是":"否"),1)]),_:1}),a(d,{prop:"description",label:"使用說明"}),a(d,{label:"操作",width:"180"},{default:n(({$index:t})=>[a(i,{size:"small",onClick:V=>ee(t)},{default:n(()=>e[21]||(e[21]=[p("編輯")])),_:2},1032,["onClick"]),a(i,{size:"small",type:"danger",onClick:V=>ge(t)},{default:n(()=>e[22]||(e[22]=[p("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1},8,["modelValue"]),a(ae,{modelValue:E.value,"onUpdate:modelValue":e[8]||(e[8]=t=>E.value=t),title:de.value,width:"420px"},{footer:n(()=>[g("span",xe,[a(i,{onClick:e[7]||(e[7]=t=>E.value=!1)},{default:n(()=>e[23]||(e[23]=[p("取消")])),_:1}),a(i,{type:"primary",onClick:fe},{default:n(()=>e[24]||(e[24]=[p("儲存")])),_:1})])]),default:n(()=>[a(te,{model:c.value,"label-width":"100px"},{default:n(()=>[a(w,{label:"所屬字典"},{default:n(()=>[a(u,{modelValue:c.value.dictionaryKey,"onUpdate:modelValue":e[4]||(e[4]=t=>c.value.dictionaryKey=t),disabled:L.value>-1},{default:n(()=>[(k(!0),h(U,null,x(y.value,t=>(k(),R(s,{key:t.key,label:`${t.key} ${t.label}`,value:t.key},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),a(w,{label:"選項名稱"},{default:n(()=>[a(O,{modelValue:c.value.name,"onUpdate:modelValue":e[5]||(e[5]=t=>c.value.name=t),placeholder:"顯示於下拉選單的名稱"},null,8,["modelValue"])]),_:1}),a(w,{label:"選項代碼"},{default:n(()=>[a(O,{modelValue:c.value.code,"onUpdate:modelValue":e[6]||(e[6]=t=>c.value.code=t),placeholder:"系統對應的代碼"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),a(ae,{modelValue:K.value,"onUpdate:modelValue":e[16]||(e[16]=t=>K.value=t),title:"自訂欄位",width:"480px"},{footer:n(()=>[g("span",Ie,[a(i,{onClick:e[15]||(e[15]=t=>K.value=!1)},{default:n(()=>e[29]||(e[29]=[p("取消")])),_:1}),a(i,{type:"primary",onClick:ve},{default:n(()=>e[30]||(e[30]=[p("儲存")])),_:1})])]),default:n(()=>[a(te,{model:r.value,"label-width":"100px"},{default:n(()=>[a(w,{label:"欄位名稱"},{default:n(()=>[a(O,{modelValue:r.value.label,"onUpdate:modelValue":e[9]||(e[9]=t=>r.value.label=t),placeholder:"顯示名稱"},null,8,["modelValue"])]),_:1}),a(w,{label:"識別代碼"},{default:n(()=>[a(O,{modelValue:r.value.fieldKey,"onUpdate:modelValue":e[10]||(e[10]=t=>r.value.fieldKey=t),placeholder:"英數字代碼"},null,8,["modelValue"])]),_:1}),a(w,{label:"欄位型別"},{default:n(()=>[a(u,{modelValue:r.value.type,"onUpdate:modelValue":e[11]||(e[11]=t=>r.value.type=t)},{default:n(()=>[(k(),h(U,null,x(H,t=>a(s,{key:t.value,label:t.label,value:t.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(w,{label:"是否必填"},{default:n(()=>[a(Ce,{modelValue:r.value.required,"onUpdate:modelValue":e[12]||(e[12]=t=>r.value.required=t)},null,8,["modelValue"])]),_:1}),a(w,{label:"使用說明"},{default:n(()=>[a(O,{modelValue:r.value.description,"onUpdate:modelValue":e[13]||(e[13]=t=>r.value.description=t),type:"textarea"},null,8,["modelValue"])]),_:1}),M.value?(k(),R(w,{key:0,label:"選項設定"},{default:n(()=>[g("div",Re,[(k(!0),h(U,null,x(r.value.optionsList,(t,V)=>(k(),h("div",{key:t.id,class:"options-editor__row","data-test":"option-row"},[a(_e,{gutter:8,align:"middle"},{default:n(()=>[a(z,{span:10},{default:n(()=>[a(O,{modelValue:t.name,"onUpdate:modelValue":N=>t.name=N,placeholder:"顯示文字","data-test":"option-name"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(z,{span:10},{default:n(()=>[a(O,{modelValue:t.code,"onUpdate:modelValue":N=>t.code=N,placeholder:"代碼","data-test":"option-code"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(z,{span:4,class:"options-editor__actions"},{default:n(()=>[a(i,{link:"",type:"primary",disabled:V===0,onClick:N=>Q(V,-1),"data-test":"move-up"},{default:n(()=>e[25]||(e[25]=[p(" 上 ")])),_:2},1032,["disabled","onClick"]),a(i,{link:"",type:"primary",disabled:V===r.value.optionsList.length-1,onClick:N=>Q(V,1),"data-test":"move-down"},{default:n(()=>e[26]||(e[26]=[p(" 下 ")])),_:2},1032,["disabled","onClick"]),a(i,{link:"",type:"danger",onClick:N=>pe(V),"data-test":"remove-option"},{default:n(()=>e[27]||(e[27]=[p(" 刪 ")])),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),a(i,{type:"primary",plain:"",size:"small",onClick:e[14]||(e[14]=t=>Y()),"data-test":"add-option"},{default:n(()=>e[28]||(e[28]=[p(" 新增選項 ")])),_:1})])]),_:1})):Fe("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},De=Ve(Je,[["__scopeId","data-v-61c3c48e"]]),je={__name:"OtherControlSettingView",setup(ne){return(I,y)=>(k(),R(De))}};export{je as default};
