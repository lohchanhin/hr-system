import{a as O}from"./api-DXOIGWP7.js";import{_ as G,r as V,k as j,c as P,b as h,d as l,w as t,e as d,o as L,g as k,E as c}from"./index-bjrOYCEG.js";const z={class:"attendance-setting"},J=720,X={__name:"AttendanceSetting",setup(q){const _=V("abnormal"),g={lateGrace:5,earlyLeaveGrace:5,missingThreshold:30,autoNotify:!0},w={enableBreakPunch:!0,breakInterval:60,outingNeedApprove:!1},x={weekdayThreshold:30,holidayRate:2,toCompRate:1.5},U={clockIn:{earlyMinutes:60,lateMinutes:240},clockOut:{earlyMinutes:240,lateMinutes:120}};function R(a=U){return{clockIn:{...a.clockIn},clockOut:{...a.clockOut}}}function I(a){const e=Number(a);return Number.isFinite(e)?Math.min(Math.max(e,0),J):null}function B(a){const e=R(),u=a&&typeof a=="object"?a:{};return["clockIn","clockOut"].forEach(n=>{const b=e[n],p=u[n]||{};["earlyMinutes","lateMinutes"].forEach(f=>{const v=I(p[f]);v!==null&&(b[f]=v)})}),e}const r=V({...g}),m=V({...w}),i=V({...x}),s=V(R());function M(a){!a||typeof a!="object"||(a.abnormalRules&&(r.value={...g,...a.abnormalRules}),a.breakOutRules&&(m.value={...w,...a.breakOutRules}),a.overtimeRules&&(i.value={...x,...a.overtimeRules}),a.actionBuffers&&(s.value=B(a.actionBuffers)))}async function A(){const a=await O("/api/attendance-settings"),e=await a.json().catch(()=>null);if(!a.ok){console.error("讀取出勤設定失敗",(e==null?void 0:e.error)||a.statusText);return}M(e)}async function y(){const a={abnormalRules:{...r.value},breakOutRules:{...m.value},overtimeRules:{...i.value},actionBuffers:B(s.value)},e=await O("/api/attendance-settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),u=await e.json().catch(()=>null);if(!e.ok)throw new Error((u==null?void 0:u.error)||"儲存設定時發生錯誤");return M(u),u}const N=async()=>{try{await y(),c.success("已儲存「異常判定規則」設定")}catch(a){c.error(a.message||"儲存失敗")}},T=async()=>{try{await y(),c.success("已儲存「分段打卡/外出」設定")}catch(a){c.error(a.message||"儲存失敗")}},C=async()=>{try{await y(),c.success("已儲存「加班規則」設定")}catch(a){c.error(a.message||"儲存失敗")}},F=async()=>{try{await y(),c.success("已儲存「打卡緩衝」設定")}catch(a){c.error(a.message||"儲存失敗")}};return j(()=>{A()}),(a,e)=>{const u=d("el-input-number"),n=d("el-form-item"),b=d("el-switch"),p=d("el-button"),f=d("el-form"),v=d("el-tab-pane"),E=d("el-divider"),S=d("el-tabs");return L(),P("div",z,[e[19]||(e[19]=h("h2",null,"出勤設定",-1)),l(S,{modelValue:_.value,"onUpdate:modelValue":e[14]||(e[14]=o=>_.value=o),type:"card"},{default:t(()=>[l(v,{label:"異常判定規則",name:"abnormal"},{default:t(()=>[l(f,{model:r.value,"label-width":"140px",class:"rule-form"},{default:t(()=>[l(n,{label:"遲到容許誤差(分鐘)"},{default:t(()=>[l(u,{modelValue:r.value.lateGrace,"onUpdate:modelValue":e[0]||(e[0]=o=>r.value.lateGrace=o),min:0},null,8,["modelValue"])]),_:1}),l(n,{label:"早退容許誤差(分鐘)"},{default:t(()=>[l(u,{modelValue:r.value.earlyLeaveGrace,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.earlyLeaveGrace=o),min:0},null,8,["modelValue"])]),_:1}),l(n,{label:"缺卡判斷時間(分鐘)"},{default:t(()=>[l(u,{modelValue:r.value.missingThreshold,"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.missingThreshold=o),min:0},null,8,["modelValue"])]),_:1}),l(n,{label:"未打卡自動通知"},{default:t(()=>[l(b,{modelValue:r.value.autoNotify,"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.autoNotify=o),"active-text":"啟用","inactive-text":"停用"},null,8,["modelValue"])]),_:1}),l(n,null,{default:t(()=>[l(p,{type:"primary",onClick:N},{default:t(()=>e[15]||(e[15]=[k("儲存規則")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(v,{label:"分段打卡/外出",name:"break-outing"},{default:t(()=>[l(f,{model:m.value,"label-width":"140px",class:"rule-form"},{default:t(()=>[l(n,{label:"是否允許分段打卡"},{default:t(()=>[l(b,{modelValue:m.value.enableBreakPunch,"onUpdate:modelValue":e[4]||(e[4]=o=>m.value.enableBreakPunch=o),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),l(n,{label:"分段打卡最少間隔(分鐘)"},{default:t(()=>[l(u,{modelValue:m.value.breakInterval,"onUpdate:modelValue":e[5]||(e[5]=o=>m.value.breakInterval=o),min:0,disabled:!m.value.enableBreakPunch},null,8,["modelValue","disabled"])]),_:1}),l(n,{label:"外出登記需審核"},{default:t(()=>[l(b,{modelValue:m.value.outingNeedApprove,"onUpdate:modelValue":e[6]||(e[6]=o=>m.value.outingNeedApprove=o),"active-text":"需要","inactive-text":"不需要"},null,8,["modelValue"])]),_:1}),l(n,null,{default:t(()=>[l(p,{type:"primary",onClick:T},{default:t(()=>e[16]||(e[16]=[k("儲存設定")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(v,{label:"加班規則",name:"overtime"},{default:t(()=>[l(f,{model:i.value,"label-width":"120px",class:"rule-form"},{default:t(()=>[l(n,{label:"平日加班起算(分)"},{default:t(()=>[l(u,{modelValue:i.value.weekdayThreshold,"onUpdate:modelValue":e[7]||(e[7]=o=>i.value.weekdayThreshold=o),min:0},null,8,["modelValue"])]),_:1}),l(n,{label:"假日加班倍數"},{default:t(()=>[l(u,{modelValue:i.value.holidayRate,"onUpdate:modelValue":e[8]||(e[8]=o=>i.value.holidayRate=o),min:1,step:.1},null,8,["modelValue"])]),_:1}),l(n,{label:"轉補休折算比率"},{default:t(()=>[l(u,{modelValue:i.value.toCompRate,"onUpdate:modelValue":e[9]||(e[9]=o=>i.value.toCompRate=o),min:1,step:.1},null,8,["modelValue"])]),_:1}),l(n,null,{default:t(()=>[l(p,{type:"primary",onClick:C},{default:t(()=>e[17]||(e[17]=[k("儲存加班規則")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(v,{label:"打卡緩衝",name:"action-buffers"},{default:t(()=>[l(f,{model:s.value,"label-width":"200px",class:"rule-form"},{default:t(()=>[l(n,{label:"上班提前可打卡 (分鐘)"},{default:t(()=>[l(u,{modelValue:s.value.clockIn.earlyMinutes,"onUpdate:modelValue":e[10]||(e[10]=o=>s.value.clockIn.earlyMinutes=o),min:0,max:720},null,8,["modelValue"])]),_:1}),l(n,{label:"上班最晚容許 (分鐘)"},{default:t(()=>[l(u,{modelValue:s.value.clockIn.lateMinutes,"onUpdate:modelValue":e[11]||(e[11]=o=>s.value.clockIn.lateMinutes=o),min:0,max:720},null,8,["modelValue"])]),_:1}),l(E),l(n,{label:"下班提前可打卡 (分鐘)"},{default:t(()=>[l(u,{modelValue:s.value.clockOut.earlyMinutes,"onUpdate:modelValue":e[12]||(e[12]=o=>s.value.clockOut.earlyMinutes=o),min:0,max:720},null,8,["modelValue"])]),_:1}),l(n,{label:"下班最晚容許 (分鐘)"},{default:t(()=>[l(u,{modelValue:s.value.clockOut.lateMinutes,"onUpdate:modelValue":e[13]||(e[13]=o=>s.value.clockOut.lateMinutes=o),min:0,max:720},null,8,["modelValue"])]),_:1}),l(n,null,{default:t(()=>[l(p,{type:"primary",onClick:F},{default:t(()=>e[18]||(e[18]=[k("儲存打卡緩衝")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])])}}},K=G(X,[["__scopeId","data-v-11fb2e06"]]);export{K as default};
