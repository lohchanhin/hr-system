import{a as O}from"./api-ZZnZ46lj.js";import{_ as Y,r as V,m as j,g as Z,p as M,c as _,o as i,d as z,a,w as o,b as s,e as p,F as w,i as D,h as L}from"./index-M7-4-VVN.js";const c={class:"org-dept-setting"},h={class:"tab-content"},ee={class:"tab-content"},le={class:"tab-content"},ae={slot:"footer",class:"dialog-footer"},te={__name:"OrgDepartmentSetting",setup(q){const A=V("org"),b=V([]),g=V([]),N=V([]),k=V(""),y=V(""),I=V(!1),t=V(J("org")),C=V("org"),x=V(null),G=j(()=>k.value?g.value.filter(u=>u.organization===k.value):g.value),H=j(()=>y.value?N.value.filter(u=>u.department===y.value):N.value),K=j(()=>{const u=C.value==="org"?"機構":C.value==="dept"?"部門":"小單位";return`${x.value===null?"新增":"編輯"}${u}`});function E(u){return u==="org"?"/api/organizations":u==="dept"?"/api/departments":"/api/sub-departments"}async function U(u,e){const r=localStorage.getItem("token")||"";let m=E(u);e&&(m+=`?${u==="dept"?"organization":"department"}=${e}`);const v=await O(m,{headers:{Authorization:`Bearer ${r}`}});if(v.ok){const f=await v.json();u==="org"?b.value=f:u==="dept"?g.value=f:N.value=f}}async function P(){await Promise.all([U("org"),U("dept",k.value),U("sub",y.value)])}function J(u){return u==="org"?{name:"",systemCode:"",unitName:"",orgCode:"",taxIdNumber:"",laborInsuranceNo:"",healthInsuranceNo:"",taxCode:"",address:"",phone:"",principal:""}:u==="dept"?{name:"",code:"",unitName:"",location:"",phone:"",manager:"",organization:""}:{name:"",code:"",unitName:"",location:"",phone:"",manager:"",headcount:0,scheduleSetting:"",department:""}}function $(u,e=null){if(C.value=u,e!==null){x.value=e;const r=u==="org"?b.value[e]:u==="dept"?g.value[e]:N.value[e];t.value={...r}}else x.value=null,t.value=J(u),u==="dept"&&(t.value.organization=k.value),u==="sub"&&(t.value.department=y.value);I.value=!0}async function Q(){const u=localStorage.getItem("token")||"",e=E(C.value),r=C.value==="org"?b:C.value==="dept"?g:N;let m;if(x.value===null)m=await O(e,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify(t.value)});else{const v=r.value[x.value]._id;m=await O(`${e}/${v}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`},body:JSON.stringify(t.value)})}m&&m.ok&&(await P(),I.value=!1)}function F(u,e){const r=localStorage.getItem("token")||"",m=u==="org"?b:u==="dept"?g:N,v=m.value[e]._id;O(`${E(u)}/${v}`,{method:"DELETE",headers:{Authorization:`Bearer ${r}`}}).then(f=>{f.ok&&m.value.splice(e,1)})}return Z(P),M(k,u=>{U("dept",u)}),M(y,u=>{U("sub",u)}),(u,e)=>{const r=s("el-button"),m=s("el-table-column"),v=s("el-table"),f=s("el-tab-pane"),T=s("el-option"),B=s("el-select"),R=s("el-tabs"),d=s("el-input"),n=s("el-form-item"),W=s("el-form"),X=s("el-dialog");return i(),_("div",c,[e[48]||(e[48]=z("h2",null,"機構與部門設定",-1)),a(R,{modelValue:A.value,"onUpdate:modelValue":e[7]||(e[7]=l=>A.value=l),type:"card"},{default:o(()=>[a(f,{label:"機構",name:"org"},{default:o(()=>[z("div",h,[a(r,{type:"primary",onClick:e[0]||(e[0]=l=>$("org"))},{default:o(()=>e[37]||(e[37]=[p("新增機構")])),_:1}),a(v,{data:b.value,style:{"margin-top":"20px"}},{default:o(()=>[a(m,{prop:"name",label:"名稱",width:"150"}),a(m,{prop:"systemCode",label:"系統代碼",width:"120"}),a(m,{label:"操作",width:"180"},{default:o(({$index:l})=>[a(r,{type:"primary",onClick:S=>$("org",l)},{default:o(()=>e[38]||(e[38]=[p("編輯")])),_:2},1032,["onClick"]),a(r,{type:"danger",onClick:S=>F("org",l)},{default:o(()=>e[39]||(e[39]=[p("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1}),a(f,{label:"部門",name:"dept"},{default:o(()=>[z("div",ee,[a(B,{modelValue:k.value,"onUpdate:modelValue":e[1]||(e[1]=l=>k.value=l),placeholder:"篩選機構",style:{width:"200px","margin-bottom":"10px"},onChange:e[2]||(e[2]=l=>U("dept",k.value))},{default:o(()=>[(i(!0),_(w,null,D(b.value,l=>(i(),L(T,{key:l._id,label:l.name,value:l._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(r,{type:"primary",onClick:e[3]||(e[3]=l=>$("dept"))},{default:o(()=>e[40]||(e[40]=[p("新增部門")])),_:1}),a(v,{data:G.value,style:{"margin-top":"20px"}},{default:o(()=>[a(m,{prop:"name",label:"名稱",width:"150"}),a(m,{prop:"code",label:"部門代碼",width:"120"}),a(m,{label:"操作",width:"180"},{default:o(({$index:l})=>[a(r,{type:"primary",onClick:S=>$("dept",l)},{default:o(()=>e[41]||(e[41]=[p("編輯")])),_:2},1032,["onClick"]),a(r,{type:"danger",onClick:S=>F("dept",l)},{default:o(()=>e[42]||(e[42]=[p("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1}),a(f,{label:"小單位",name:"sub"},{default:o(()=>[z("div",le,[a(B,{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=l=>y.value=l),placeholder:"篩選部門",style:{width:"200px","margin-bottom":"10px"},onChange:e[5]||(e[5]=l=>U("sub",y.value))},{default:o(()=>[(i(!0),_(w,null,D(g.value,l=>(i(),L(T,{key:l._id,label:l.name,value:l._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a(r,{type:"primary",onClick:e[6]||(e[6]=l=>$("sub"))},{default:o(()=>e[43]||(e[43]=[p("新增小單位")])),_:1}),a(v,{data:H.value,style:{"margin-top":"20px"}},{default:o(()=>[a(m,{prop:"name",label:"名稱",width:"150"}),a(m,{prop:"code",label:"代碼",width:"120"}),a(m,{label:"操作",width:"180"},{default:o(({$index:l})=>[a(r,{type:"primary",onClick:S=>$("sub",l)},{default:o(()=>e[44]||(e[44]=[p("編輯")])),_:2},1032,["onClick"]),a(r,{type:"danger",onClick:S=>F("sub",l)},{default:o(()=>e[45]||(e[45]=[p("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1},8,["modelValue"]),a(X,{modelValue:I.value,"onUpdate:modelValue":e[36]||(e[36]=l=>I.value=l),title:K.value,width:"400px"},{default:o(()=>[a(W,{model:t.value,"label-width":"100px"},{default:o(()=>[C.value==="org"?(i(),_(w,{key:0},[a(n,{label:"機構名稱"},{default:o(()=>[a(d,{modelValue:t.value.name,"onUpdate:modelValue":e[8]||(e[8]=l=>t.value.name=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"系統代碼"},{default:o(()=>[a(d,{modelValue:t.value.systemCode,"onUpdate:modelValue":e[9]||(e[9]=l=>t.value.systemCode=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"單位名稱"},{default:o(()=>[a(d,{modelValue:t.value.unitName,"onUpdate:modelValue":e[10]||(e[10]=l=>t.value.unitName=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"機構代碼"},{default:o(()=>[a(d,{modelValue:t.value.orgCode,"onUpdate:modelValue":e[11]||(e[11]=l=>t.value.orgCode=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"統一編號"},{default:o(()=>[a(d,{modelValue:t.value.taxIdNumber,"onUpdate:modelValue":e[12]||(e[12]=l=>t.value.taxIdNumber=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"勞保編號"},{default:o(()=>[a(d,{modelValue:t.value.laborInsuranceNo,"onUpdate:modelValue":e[13]||(e[13]=l=>t.value.laborInsuranceNo=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"健保編號"},{default:o(()=>[a(d,{modelValue:t.value.healthInsuranceNo,"onUpdate:modelValue":e[14]||(e[14]=l=>t.value.healthInsuranceNo=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"稅籍編號"},{default:o(()=>[a(d,{modelValue:t.value.taxCode,"onUpdate:modelValue":e[15]||(e[15]=l=>t.value.taxCode=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"位置"},{default:o(()=>[a(d,{modelValue:t.value.address,"onUpdate:modelValue":e[16]||(e[16]=l=>t.value.address=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"連絡電話"},{default:o(()=>[a(d,{modelValue:t.value.phone,"onUpdate:modelValue":e[17]||(e[17]=l=>t.value.phone=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"負責人"},{default:o(()=>[a(d,{modelValue:t.value.principal,"onUpdate:modelValue":e[18]||(e[18]=l=>t.value.principal=l)},null,8,["modelValue"])]),_:1})],64)):C.value==="dept"?(i(),_(w,{key:1},[a(n,{label:"機構"},{default:o(()=>[a(B,{modelValue:t.value.organization,"onUpdate:modelValue":e[19]||(e[19]=l=>t.value.organization=l),placeholder:"選擇機構"},{default:o(()=>[(i(!0),_(w,null,D(b.value,l=>(i(),L(T,{key:l._id,label:l.name,value:l._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"部門名稱"},{default:o(()=>[a(d,{modelValue:t.value.name,"onUpdate:modelValue":e[20]||(e[20]=l=>t.value.name=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"部門代碼"},{default:o(()=>[a(d,{modelValue:t.value.code,"onUpdate:modelValue":e[21]||(e[21]=l=>t.value.code=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"單位名稱"},{default:o(()=>[a(d,{modelValue:t.value.unitName,"onUpdate:modelValue":e[22]||(e[22]=l=>t.value.unitName=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"位置"},{default:o(()=>[a(d,{modelValue:t.value.location,"onUpdate:modelValue":e[23]||(e[23]=l=>t.value.location=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"連絡電話"},{default:o(()=>[a(d,{modelValue:t.value.phone,"onUpdate:modelValue":e[24]||(e[24]=l=>t.value.phone=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"部門主管"},{default:o(()=>[a(d,{modelValue:t.value.manager,"onUpdate:modelValue":e[25]||(e[25]=l=>t.value.manager=l)},null,8,["modelValue"])]),_:1})],64)):(i(),_(w,{key:2},[a(n,{label:"部門"},{default:o(()=>[a(B,{modelValue:t.value.department,"onUpdate:modelValue":e[26]||(e[26]=l=>t.value.department=l),placeholder:"選擇部門"},{default:o(()=>[(i(!0),_(w,null,D(g.value,l=>(i(),L(T,{key:l._id,label:l.name,value:l._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"小單位名稱"},{default:o(()=>[a(d,{modelValue:t.value.name,"onUpdate:modelValue":e[27]||(e[27]=l=>t.value.name=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"代碼"},{default:o(()=>[a(d,{modelValue:t.value.code,"onUpdate:modelValue":e[28]||(e[28]=l=>t.value.code=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"單位名稱"},{default:o(()=>[a(d,{modelValue:t.value.unitName,"onUpdate:modelValue":e[29]||(e[29]=l=>t.value.unitName=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"位置"},{default:o(()=>[a(d,{modelValue:t.value.location,"onUpdate:modelValue":e[30]||(e[30]=l=>t.value.location=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"連絡電話"},{default:o(()=>[a(d,{modelValue:t.value.phone,"onUpdate:modelValue":e[31]||(e[31]=l=>t.value.phone=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"部門主管"},{default:o(()=>[a(d,{modelValue:t.value.manager,"onUpdate:modelValue":e[32]||(e[32]=l=>t.value.manager=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"人力需求數"},{default:o(()=>[a(d,{modelValue:t.value.headcount,"onUpdate:modelValue":e[33]||(e[33]=l=>t.value.headcount=l)},null,8,["modelValue"])]),_:1}),a(n,{label:"班表拉選"},{default:o(()=>[a(d,{modelValue:t.value.scheduleSetting,"onUpdate:modelValue":e[34]||(e[34]=l=>t.value.scheduleSetting=l)},null,8,["modelValue"])]),_:1})],64))]),_:1},8,["model"]),z("span",ae,[a(r,{onClick:e[35]||(e[35]=l=>I.value=!1)},{default:o(()=>e[46]||(e[46]=[p("取消")])),_:1}),a(r,{type:"primary",onClick:Q},{default:o(()=>e[47]||(e[47]=[p("儲存")])),_:1})])]),_:1},8,["modelValue","title"])])}}},oe=Y(te,[["__scopeId","data-v-b33c53a7"]]),de={__name:"OrgDepartmentSettingView",setup(q){return(A,b)=>(i(),L(oe))}};export{de as default};
