import{a as k}from"./api-BPq4vKht.js";import{_ as ue,r as y,j as re,k as pe,c as B,b as t,d as l,v as f,w as o,e as u,z as V,o as M,g as r,q as fe,F as me,t as ce,A as ve}from"./index-DndZETEu.js";import{b as be}from"./shiftColors-BbvJ2s1U.js";const ye={class:"shift-schedule-setting"},_e={class:"page-header"},ke={class:"header-stats"},Ve={class:"stat-item"},ge={class:"stat-number"},we={class:"stat-item"},he={class:"stat-number"},Te={class:"tab-content"},Ce={class:"content-header"},Ue={class:"table-container"},xe={class:"date-info"},Se={class:"action-buttons"},$e={class:"dialog-footer"},De={class:"tab-content"},Be={class:"content-header"},Me={class:"table-container"},Ae={class:"shift-info"},ze={class:"shift-name"},We={class:"time-range"},He={class:"start-time"},je={class:"end-time"},Pe={class:"break-info"},Ee={class:"break-duration"},Fe={key:0,class:"break-window"},qe={class:"action-buttons"},Ne={class:"break-window-list"},Oe={class:"dialog-footer"},Le={class:"tab-content"},Ie={class:"settings-card"},Ye={class:"form-group"},Y="YYYY/MM/DD",_="HH:mm",Je={__name:"ShiftScheduleSetting",setup(Ge){const E=y("calendar"),g=y([]),h=y(!1);let U=null;const c=y({date:"",type:"",desc:""});async function A(){const s=await k("/api/holidays",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`}});s.ok&&(g.value=await s.json())}function F(s=null){s!==null?(U=s,c.value={...g.value[s]}):(U=null,c.value={date:"",type:"",desc:""}),h.value=!0}async function J(){const s=U===null?"POST":"PUT";let e="/api/holidays";if(s==="PUT"){const i=g.value[U]._id;e+=`/${i}`}await k(e,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`},body:JSON.stringify(c.value)}),await A(),h.value=!1}async function G(s){const e=g.value[s]._id;await k(`/api/holidays/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`}}),await A()}const w=y([]),T=y(!1);let x=null;const K=["#dbeafe","#ede9fe","#fef3c7","#dcfce7","#fee2e2","#fce7f3","#cffafe","#fae8ff"],Q=["#0f172a","#1e3a8a","#047857","#92400e","#991b1b","#9d174d","#155e75","#f8fafc"],z=()=>({name:"",code:"",startTime:"",endTime:"",breakDuration:60,breakWindows:[],crossDay:!1,remark:"",color:"",bgColor:""}),n=y(z()),R=re(()=>{const s=be(n.value);return{background:`linear-gradient(135deg, ${s["--shift-cell-bg-start"]??"#f1f5f9"} 0%, ${s["--shift-cell-bg-end"]??"#e2e8f0"} 100%)`,color:s["--shift-text-color"]??"#0f172a",borderColor:s["--shift-border-color"]??"rgba(148, 163, 184, 0.45)"}});async function W(){const s=await k("/api/shifts",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`}});if(s.ok){const e=await s.json();w.value=Array.isArray(e==null?void 0:e.shifts)?e.shifts:Array.isArray(e)?e:[]}}function q(s=null){s!==null?(x=s,n.value={...z(),...w.value[s]}):(x=null,n.value=z()),Array.isArray(n.value.breakWindows)||(n.value.breakWindows=[]),T.value=!0}function X(s){return s.breakDuration!=null?`${s.breakDuration} 分鐘`:s.breakMinutes!=null?`${s.breakMinutes} 分鐘`:s.breakTime?s.breakTime:"未設定"}function N(s){return!Array.isArray(s.breakWindows)||!s.breakWindows.length?"":s.breakWindows.map(e=>{const i=[e.start,e.end].filter(Boolean).join("~");return e.label?`${i}（${e.label}）`:i}).filter(Boolean).join("，")}function Z(){n.value.breakWindows.push({start:"",end:"",label:""})}function ee(s){n.value.breakWindows.splice(s,1)}async function le(){const s=x===null?"POST":"PUT";let e="/api/shifts";if(s==="PUT"){const i=w.value[x]._id;e+=`/${i}`}await k(e,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`},body:JSON.stringify(n.value)}),await W(),T.value=!1}async function ae(s){const e=w.value[s]._id;await k(`/api/shifts/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`}}),await W()}const p=y({enableHolidayMove:!1,needSignature:!1,needMakeup:!1});async function te(){const s=p.value._id?"PUT":"POST";let e="/api/holiday-move-settings";s==="PUT"&&(e+=`/${p.value._id}`),(await k(e,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${V()}`},body:JSON.stringify(p.value)})).ok&&alert("已儲存「國定假日挪移」設定")}pe(()=>{A(),W()});function oe(s){return{國定假日:"danger",例假日:"success",公司休息日:"warning",補班日:"info"}[s]||"default"}return(s,e)=>{const i=u("el-button"),m=u("el-table-column"),H=u("el-tag"),O=u("el-table"),se=u("el-date-picker"),d=u("el-form-item"),S=u("el-option"),ne=u("el-select"),C=u("el-input"),j=u("el-form"),L=u("el-dialog"),P=u("el-tab-pane"),$=u("el-time-picker"),ie=u("el-input-number"),D=u("el-switch"),I=u("el-color-picker"),de=u("el-tabs");return M(),B("div",ye,[t("div",_e,[e[24]||(e[24]=t("div",{class:"header-content"},[t("h1",{class:"page-title"},"排班與班別管理設定"),t("p",{class:"page-description"},"管理班別時間、假日設定與國定假日挪移配置")],-1)),t("div",ke,[t("div",Ve,[t("div",ge,f(g.value.length),1),e[22]||(e[22]=t("div",{class:"stat-label"},"假日",-1))]),t("div",we,[t("div",he,f(w.value.length),1),e[23]||(e[23]=t("div",{class:"stat-label"},"班別",-1))])])]),l(de,{modelValue:E.value,"onUpdate:modelValue":e[21]||(e[21]=a=>E.value=a),type:"card",class:"schedule-tabs"},{default:o(()=>[l(P,{name:"calendar"},{label:o(()=>e[25]||(e[25]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-calendar"}),t("span",null,"行事曆設定")],-1)])),default:o(()=>[t("div",Te,[t("div",Ce,[e[27]||(e[27]=t("h2",{class:"section-title"},"假日管理",-1)),l(i,{type:"primary",onClick:e[0]||(e[0]=a=>F()),class:"add-btn"},{default:o(()=>e[26]||(e[26]=[t("i",{class:"el-icon-plus"},null,-1),r(" 新增假日 ")])),_:1})]),t("div",Ue,[l(O,{data:g.value,class:"data-table","header-cell-style":{background:"#f8fafc",color:"#475569",fontWeight:"600"},"row-style":{height:"56px"}},{default:o(()=>[l(m,{prop:"date",label:"日期",width:"160"},{default:o(({row:a})=>[t("div",xe,[e[28]||(e[28]=t("i",{class:"el-icon-date"},null,-1)),r(" "+f(a.date),1)])]),_:1}),l(m,{prop:"type",label:"假日類型",width:"140"},{default:o(({row:a})=>[l(H,{type:oe(a.type),class:"holiday-tag"},{default:o(()=>[r(f(a.type),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"desc",label:"描述","min-width":"200"}),l(m,{label:"操作",width:"200",fixed:"right"},{default:o(({row:a,$index:b})=>[t("div",Se,[l(i,{type:"primary",size:"small",onClick:v=>F(b),class:"edit-btn"},{default:o(()=>e[29]||(e[29]=[t("i",{class:"el-icon-edit"},null,-1),r(" 編輯 ")])),_:2},1032,["onClick"]),l(i,{type:"danger",size:"small",onClick:v=>G(b),class:"delete-btn"},{default:o(()=>e[30]||(e[30]=[t("i",{class:"el-icon-delete"},null,-1),r(" 刪除 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])]),l(L,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=a=>h.value=a),title:"假日資料",width:"500px",class:"form-dialog"},{footer:o(()=>[t("div",$e,[l(i,{onClick:e[4]||(e[4]=a=>h.value=!1),class:"cancel-btn"},{default:o(()=>e[31]||(e[31]=[r("取消")])),_:1}),l(i,{type:"primary",onClick:J,class:"save-btn"},{default:o(()=>e[32]||(e[32]=[t("i",{class:"el-icon-check"},null,-1),r(" 儲存 ")])),_:1})])]),default:o(()=>[l(j,{model:c.value,"label-width":"120px",class:"dialog-form"},{default:o(()=>[l(d,{label:"日期",required:""},{default:o(()=>[l(se,{modelValue:c.value.date,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value.date=a),type:"date",placeholder:"選擇日期",format:Y,"value-format":Y,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(d,{label:"假日類型",required:""},{default:o(()=>[l(ne,{modelValue:c.value.type,"onUpdate:modelValue":e[2]||(e[2]=a=>c.value.type=a),placeholder:"選擇類型",style:{width:"100%"}},{default:o(()=>[l(S,{label:"國定假日",value:"國定假日"}),l(S,{label:"例假日",value:"例假日"}),l(S,{label:"公司休息日",value:"公司休息日"}),l(S,{label:"補班日",value:"補班日"})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"描述"},{default:o(()=>[l(C,{modelValue:c.value.desc,"onUpdate:modelValue":e[3]||(e[3]=a=>c.value.desc=a),placeholder:"例如：中秋節 / 週休 等",type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])]),_:1}),l(P,{name:"shift"},{label:o(()=>e[33]||(e[33]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-time"}),t("span",null,"班別設定")],-1)])),default:o(()=>[t("div",De,[t("div",Be,[e[35]||(e[35]=t("h2",{class:"section-title"},"班別管理",-1)),l(i,{type:"primary",onClick:e[6]||(e[6]=a=>q()),class:"add-btn"},{default:o(()=>e[34]||(e[34]=[t("i",{class:"el-icon-plus"},null,-1),r(" 新增班別 ")])),_:1})]),t("div",Me,[l(O,{data:w.value,class:"data-table","header-cell-style":{background:"#f8fafc",color:"#475569",fontWeight:"600"},"row-style":{height:"56px"}},{default:o(()=>[l(m,{prop:"code",label:"代碼",width:"100"},{default:o(({row:a})=>[l(H,{class:"code-tag"},{default:o(()=>[r(f(a.code),1)]),_:2},1024)]),_:1}),l(m,{prop:"name",label:"班別名稱",width:"180"},{default:o(({row:a})=>[t("div",Ae,[e[36]||(e[36]=t("div",{class:"shift-icon"},[t("i",{class:"el-icon-time"})],-1)),t("div",ze,f(a.name),1)])]),_:1}),l(m,{label:"工作時間",width:"200"},{default:o(({row:a})=>[t("div",We,[t("span",He,f(a.startTime),1),e[37]||(e[37]=t("i",{class:"el-icon-right time-separator"},null,-1)),t("span",je,f(a.endTime),1)])]),_:1}),l(m,{label:"休息","min-width":"220"},{default:o(({row:a})=>[t("div",Pe,[t("div",Ee,f(X(a)),1),N(a)?(M(),B("div",Fe,f(N(a)),1)):fe("",!0)])]),_:1}),l(m,{prop:"crossDay",label:"跨日班",width:"100"},{default:o(({row:a})=>[l(H,{type:a.crossDay?"warning":"success",size:"small"},{default:o(()=>[r(f(a.crossDay?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"remark",label:"備註","min-width":"150"}),l(m,{label:"操作",width:"200",fixed:"right"},{default:o(({row:a,$index:b})=>[t("div",qe,[l(i,{type:"primary",size:"small",onClick:v=>q(b),class:"edit-btn"},{default:o(()=>e[38]||(e[38]=[t("i",{class:"el-icon-edit"},null,-1),r(" 編輯 ")])),_:2},1032,["onClick"]),l(i,{type:"danger",size:"small",onClick:v=>ae(b),class:"delete-btn"},{default:o(()=>e[39]||(e[39]=[t("i",{class:"el-icon-delete"},null,-1),r(" 刪除 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])]),l(L,{modelValue:T.value,"onUpdate:modelValue":e[17]||(e[17]=a=>T.value=a),title:"班別資料",width:"500px",class:"form-dialog"},{footer:o(()=>[t("div",Oe,[l(i,{onClick:e[16]||(e[16]=a=>T.value=!1),class:"cancel-btn"},{default:o(()=>e[44]||(e[44]=[r("取消")])),_:1}),l(i,{type:"primary",onClick:le,class:"save-btn"},{default:o(()=>e[45]||(e[45]=[t("i",{class:"el-icon-check"},null,-1),r(" 儲存 ")])),_:1})])]),default:o(()=>[l(j,{model:n.value,"label-width":"120px",class:"dialog-form"},{default:o(()=>[l(d,{label:"班別代碼",required:""},{default:o(()=>[l(C,{modelValue:n.value.code,"onUpdate:modelValue":e[7]||(e[7]=a=>n.value.code=a),placeholder:"如：A1, B2, C3"},null,8,["modelValue"])]),_:1}),l(d,{label:"班別名稱",required:""},{default:o(()=>[l(C,{modelValue:n.value.name,"onUpdate:modelValue":e[8]||(e[8]=a=>n.value.name=a),placeholder:"如：早班 / 夜班 / 彈性班"},null,8,["modelValue"])]),_:1}),l(d,{label:"上班時間",required:""},{default:o(()=>[l($,{modelValue:n.value.startTime,"onUpdate:modelValue":e[9]||(e[9]=a=>n.value.startTime=a),format:_,"value-format":_,placeholder:"選擇上班時間",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(d,{label:"下班時間",required:""},{default:o(()=>[l($,{modelValue:n.value.endTime,"onUpdate:modelValue":e[10]||(e[10]=a=>n.value.endTime=a),format:_,"value-format":_,placeholder:"選擇下班時間",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(d,{label:"休息時長(分鐘)"},{default:o(()=>[l(ie,{modelValue:n.value.breakDuration,"onUpdate:modelValue":e[11]||(e[11]=a=>n.value.breakDuration=a),min:0,step:15,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(d,{label:"休息時段"},{default:o(()=>[t("div",Ne,[(M(!0),B(me,null,ce(n.value.breakWindows,(a,b)=>(M(),B("div",{key:b,class:"break-window-row"},[l($,{modelValue:a.start,"onUpdate:modelValue":v=>a.start=v,format:_,"value-format":_,placeholder:"開始",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"]),e[41]||(e[41]=t("span",{class:"time-separator"},"~",-1)),l($,{modelValue:a.end,"onUpdate:modelValue":v=>a.end=v,format:_,"value-format":_,placeholder:"結束",style:{width:"120px"}},null,8,["modelValue","onUpdate:modelValue"]),l(C,{modelValue:a.label,"onUpdate:modelValue":v=>a.label=v,placeholder:"備註",style:{width:"140px"}},null,8,["modelValue","onUpdate:modelValue"]),l(i,{type:"danger",link:"",onClick:v=>ee(b)},{default:o(()=>e[40]||(e[40]=[t("i",{class:"el-icon-delete"},null,-1)])),_:2},1032,["onClick"])]))),128)),l(i,{type:"primary",link:"",onClick:Z},{default:o(()=>e[42]||(e[42]=[r("新增時段")])),_:1}),e[43]||(e[43]=t("div",{class:"form-help"},"若未填休息時段，將以「休息時長」扣除工時計算。",-1))])]),_:1}),l(d,{label:"跨日班"},{default:o(()=>[l(D,{modelValue:n.value.crossDay,"onUpdate:modelValue":e[12]||(e[12]=a=>n.value.crossDay=a),"active-text":"是","inactive-text":"否","active-color":"#10b981"},null,8,["modelValue"])]),_:1}),l(d,{label:"班別底色"},{default:o(()=>[l(I,{modelValue:n.value.bgColor,"onUpdate:modelValue":e[13]||(e[13]=a=>n.value.bgColor=a),predefine:K,"color-format":"hex","show-alpha":!1},null,8,["modelValue"])]),_:1}),l(d,{label:"文字顏色"},{default:o(()=>[l(I,{modelValue:n.value.color,"onUpdate:modelValue":e[14]||(e[14]=a=>n.value.color=a),predefine:Q,"color-format":"hex","show-alpha":!1},null,8,["modelValue"])]),_:1}),l(d,{label:"顏色預覽"},{default:o(()=>[t("div",{class:"shift-color-preview",style:ve(R.value)},f(n.value.code||n.value.name||"SHIFT"),5)]),_:1}),l(d,{label:"備註"},{default:o(()=>[l(C,{modelValue:n.value.remark,"onUpdate:modelValue":e[15]||(e[15]=a=>n.value.remark=a),type:"textarea",rows:3,placeholder:"班別說明或特殊注意事項"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])]),_:1}),l(P,{name:"holidayMove"},{label:o(()=>e[46]||(e[46]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-s-promotion"}),t("span",null,"國定假日挪移")],-1)])),default:o(()=>[t("div",Le,[t("div",Ie,[e[51]||(e[51]=t("h2",{class:"section-title"},"假日挪移規則",-1)),l(j,{model:p.value,"label-width":"220px",class:"settings-form"},{default:o(()=>[t("div",Ye,[l(d,{label:"是否允許挪移國定假日"},{default:o(()=>[l(D,{modelValue:p.value.enableHolidayMove,"onUpdate:modelValue":e[18]||(e[18]=a=>p.value.enableHolidayMove=a),"active-text":"允許","inactive-text":"禁止","active-color":"#10b981"},null,8,["modelValue"]),e[47]||(e[47]=t("div",{class:"form-help"},"允許員工申請將國定假日挪移到其他日期",-1))]),_:1}),l(d,{label:"挪移申請是否需簽名(電子簽核)"},{default:o(()=>[l(D,{modelValue:p.value.needSignature,"onUpdate:modelValue":e[19]||(e[19]=a=>p.value.needSignature=a),disabled:!p.value.enableHolidayMove,"active-text":"需要","inactive-text":"不需要","active-color":"#10b981"},null,8,["modelValue","disabled"]),e[48]||(e[48]=t("div",{class:"form-help"},"挪移申請是否需要經過電子簽核流程",-1))]),_:1}),l(d,{label:"挪移後是否補班"},{default:o(()=>[l(D,{modelValue:p.value.needMakeup,"onUpdate:modelValue":e[20]||(e[20]=a=>p.value.needMakeup=a),disabled:!p.value.enableHolidayMove,"active-text":"需要","inactive-text":"不需要","active-color":"#10b981"},null,8,["modelValue","disabled"]),e[49]||(e[49]=t("div",{class:"form-help"},"挪移假日後是否需要在其他日期補班",-1))]),_:1})]),l(d,null,{default:o(()=>[l(i,{type:"primary",onClick:te,class:"save-settings-btn"},{default:o(()=>e[50]||(e[50]=[t("i",{class:"el-icon-check"},null,-1),r(" 儲存挪移規則 ")])),_:1})]),_:1})]),_:1},8,["model"])])])]),_:1})]),_:1},8,["modelValue"])])}}},Xe=ue(Je,[["__scopeId","data-v-435a2ef5"]]);export{Xe as default};
