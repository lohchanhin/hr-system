import{B as Pe,r as g,p as Be,_ as we,x as G,C as Je,D as ke,G as De,c as y,o as m,F as A,l as B,e as O,k as E,w as _,b as v,H as ue,I as We,t as V,J as W,j as Ye,d as h,y as Y,a as Ge,E as R,u as He,g as P,h as re,n as qe,z as ie}from"./index-BLHruX9W.js";import{a as C}from"./api-BH1Z2RaR.js";const Ke=Pe("auth",()=>{const L=g("employee");function k(){const c=Be();if(c)try{const N=JSON.parse(atob(c.split(".")[1]));L.value=N.role||"employee"}catch{L.value="employee"}else L.value="employee"}return{role:L,loadUser:k}}),Qe={class:"dashboard"},Xe={class:"metric-label"},Ze={class:"metric-value"},et=Object.assign({name:"ScheduleDashboard"},{__name:"ScheduleDashboard",props:{summary:{type:Object,default:()=>({direct:0,unscheduled:0,onLeave:0})}},setup(L){const k=L,c=G(()=>[{label:"直屬員工數",value:k.summary.direct,icon:Je,color:"#0f766e"},{label:"未排班員工",value:k.summary.unscheduled,icon:ke,color:"#dc2626"},{label:"請假中員工",value:k.summary.onLeave,icon:De,color:"#f59e0b"}]);return(N,U)=>{const J=O("el-card");return m(),y("div",Qe,[(m(!0),y(A,null,B(c.value,D=>(m(),E(J,{class:"metric-card",key:D.label},{default:_(()=>[(m(),E(ue(D.icon),{class:"metric-icon",style:We({color:D.color})},null,8,["style"])),v("div",Xe,V(D.label),1),v("div",Ze,V(D.value),1)]),_:2},1024))),128))])}}}),tt=we(et,[["__scopeId","data-v-ceb5c889"]]),at={class:"schedule-page"},lt={class:"filters-card"},st={class:"filters-content"},nt={class:"filter-group"},ot={class:"filter-group"},rt={class:"filter-group"},it={class:"actions-card"},ut={class:"primary-actions"},dt={class:"secondary-actions"},ct={class:"schedule-card"},vt={class:"schedule-header"},pt={class:"employee-info"},mt={class:"department-name"},ft={key:0,class:"sub-department"},ht={class:"employee-name"},_t={class:"department-selects"},yt={key:0,class:"leave-indicator"},bt={class:"shift-details"},gt={class:"detail-row"},St={class:"detail-value"},wt={class:"detail-row"},kt={class:"detail-value"},Dt={key:0,class:"detail-row"},It={class:"detail-value"},jt={class:"modern-shift-tag"},Ct={key:2,class:"missing-label"},Vt={key:1,class:"empty-cell"},$t={key:1,class:"modern-schedule-cell collapsed-cell"},Et={key:0,class:"approval-card"},At={class:"approval-header"},Ot={class:"approval-count"},Ut={class:"applicant-name"},xt={class:"form-type"},Mt={__name:"Schedule",setup(L){const k=g(W().format("YYYY-MM")),c=g({}),N=g([]),U=g([]),J=g([]),D=g([]),x=g([]),w=g(""),I=g(""),j=g(""),M=g(""),S=g(""),Q=g(""),T=g([]),de=g({direct:0,unscheduled:0,onLeave:0}),X=g(""),Z=g("all"),ee=g(new Set),ne=l=>{const e=c.value[l]||{},a=Object.values(e),o=a.some(r=>r.shiftId),n=a.some(r=>r.leave);return o?n?"onLeave":"scheduled":"unscheduled"},Ie=G(()=>{let l=X.value?U.value.filter(e=>e.name.includes(X.value)):U.value;return Z.value!=="all"&&(l=l.filter(e=>ne(e._id)===Z.value)),l}),ce=G(()=>U.value.length>50),je=l=>{ee.value.has(l)?ee.value.delete(l):ee.value.add(l)},Ce=G(()=>x.value.filter(l=>l.department===w.value)),Ve=He(),H=Ke();H.loadUser();const ve=G(()=>["supervisor","admin"].includes(H.role)),$e=ve,Ee=l=>{var o,n;const e=(o=R)==null?void 0:o.warning;typeof e=="function"&&e(l);const a=typeof window<"u"?(n=window.ElMessage)==null?void 0:n.warning:void 0;typeof a=="function"&&a!==e&&a(l)},oe=G(()=>{const l=W(k.value+"-01"),e=l.endOf("month").date(),a=["日","一","二","三","四","五","六"];return Array.from({length:e},(o,n)=>{const r=n+1,p=a[l.date(r).day()];return{date:r,label:`${r}(${p})`}})});async function Ae(){const l=await C("/api/shifts");if(l.ok){const e=await l.json(),a=Array.isArray(e==null?void 0:e.shifts)?e.shifts:Array.isArray(e)?e:[];Array.isArray(a)&&(N.value=a.map(o=>({_id:o._id,code:o.code,startTime:o.startTime,endTime:o.endTime,remark:o.remark})))}else l.status===403?alert("缺少權限，請重新登入或聯絡管理員"):console.error("取得班表設定失敗",l.status)}async function pe(l=""){try{const e=l||j.value,a=e?`/api/sub-departments?department=${e}`:"/api/sub-departments",o=await C(a);if(!o.ok)throw new Error("Failed to fetch sub departments");const n=await o.json(),r=D.value.reduce((i,u)=>{const f=String(u._id);return i[f]=f,u.name&&(i[u.name]=f),i},{});j.value&&(r[j.value]=j.value),M.value&&(r[M.value]=j.value||M.value);const p=Array.isArray(n)?n.map(i=>{const u=i==null?void 0:i.department;let f="";return u&&typeof u=="object"?f=(u==null?void 0:u._id)||(u==null?void 0:u.id)||r[u==null?void 0:u.name]||"":f=r[u]||u||"",{...i,_id:String((i==null?void 0:i._id)??(i==null?void 0:i.id)??""),department:String(f)}}).filter(i=>i._id):[];let t=p;if(e&&(t=p.filter(i=>i.department===String(e)),!t.length&&S.value)){const i=p.find(u=>u._id===S.value);i?t=[i]:t=[{_id:S.value,name:Q.value||"",department:String(e)}]}if(H.role==="supervisor"){const i=T.value.length?T.value:S.value?[S.value]:[],u=new Set(i.map(f=>String(f)));u.size?t=t.filter(f=>u.has(String(f._id))):t=[]}x.value=t,x.value.length?S.value&&x.value.some(i=>i._id===S.value)?I.value=S.value:I.value&&x.value.some(i=>i._id===I.value)||(I.value=x.value[0]._id):I.value=""}catch(e){console.error(e),x.value=[],I.value=""}}async function Oe(){var l;try{const e=await C("/api/departments"),a=e.ok?await e.json():[],o=Array.isArray(a)?a.map(t=>{const i=(t==null?void 0:t._id)??(t==null?void 0:t.id)??(t==null?void 0:t.value)??"";return{...t,_id:String(i),name:(t==null?void 0:t.name)??""}}).filter(t=>t._id):[],n=w.value||j.value;let r=o;n&&(r=o.filter(t=>t._id===n||M.value&&t.name===M.value),!r.length&&n&&(r=[{_id:n,name:M.value||((l=o.find(t=>t._id===n))==null?void 0:l.name)||""}])),D.value=r.length?r:o,D.value.length?D.value.some(t=>t._id===w.value)||(w.value=D.value[0]._id):!w.value&&n&&(w.value=n);const p=w.value||j.value||(D.value.length?D.value[0]._id:"");await pe(p)}catch(e){console.error(e)}}const te=()=>{var a,o;if(!ve.value||typeof window>"u")return"";const l=(a=window.sessionStorage)==null?void 0:a.getItem("employeeId");if(l&&l!=="undefined")return l;const e=(o=window.localStorage)==null?void 0:o.getItem("employeeId");return e&&e!=="undefined"?e:""};async function Ue(){if(H.role!=="supervisor"){j.value="",M.value="",S.value="",Q.value="",T.value=[];return}const l=te();if(!l){j.value="",M.value="",S.value="",Q.value="",T.value=[];return}let e=null;try{const i=await C(`/api/employees/${l}`);if(!i.ok)throw new Error("Failed to fetch supervisor context");e=await i.json()}catch(i){console.error(i)}const a=e==null?void 0:e.department,o=typeof a=="object"?(a==null?void 0:a._id)||(a==null?void 0:a.id)||(a==null?void 0:a.value):a,n=typeof a=="object"?(a==null?void 0:a.name)||"":(e==null?void 0:e.departmentName)||"";j.value=o?String(o):"",M.value=n?String(n):"",j.value?w.value=j.value:w.value="";const r=e==null?void 0:e.subDepartment,p=typeof r=="object"?(r==null?void 0:r._id)||(r==null?void 0:r.id)||(r==null?void 0:r.value):r,t=typeof r=="object"?(r==null?void 0:r.name)||"":(e==null?void 0:e.subDepartmentName)||"";S.value=p?String(p):"",Q.value=t?String(t):"",S.value?I.value=S.value:I.value="",await xe(l)}async function xe(l=""){if(H.role!=="supervisor"){T.value=[];return}const e=l||te();if(!e){T.value=S.value?[String(S.value)]:[];return}try{const a=await C(`/api/employees?supervisor=${e}`);if(!a.ok)throw new Error("Failed to fetch direct reports");const o=await a.json(),n=Array.isArray(o)?o:[],r=new Set,p=[],t=i=>{if(!i&&i!==0)return;const u=String(i);u&&(r.has(u)||(r.add(u),p.push(u)))};n.forEach(i=>{const u=i==null?void 0:i.subDepartment;t(u&&typeof u=="object"?(u==null?void 0:u._id)||(u==null?void 0:u.id)||(u==null?void 0:u.value):u)}),t(S.value),T.value=p}catch(a){console.error(a),T.value=S.value?[String(S.value)]:[]}}async function ae(){const l=te(),e=l?`&supervisor=${l}`:"";try{const a=await C(`/api/schedules/monthly?month=${k.value}${e}`);if(!a.ok)throw new Error("Failed to fetch schedules");const o=await a.json(),n=Array.isArray(o)?o:[],r=oe.value;c.value={},!U.value.length&&n.length&&await se(w.value,I.value),U.value.forEach(t=>{c.value[t._id]={},r.forEach(i=>{c.value[t._id][i.date]={shiftId:"",department:t.departmentId,subDepartment:t.subDepartmentId}})}),n.forEach(t=>{var s;const i=((s=t.employee)==null?void 0:s._id)||t.employee,u=W(t.date).date(),f=U.value.find(d=>d._id===i)||{};c.value[i][u]={id:t._id,shiftId:t.shiftId,department:t.department||f.departmentId,subDepartment:t.subDepartment||f.subDepartmentId}});const p=await C(`/api/schedules/leave-approvals?month=${k.value}${e}`);if(p.ok){const t=await p.json(),i=Array.isArray(t==null?void 0:t.approvals)?t.approvals:[],u=Array.isArray(t==null?void 0:t.leaves)?t.leaves:[];J.value=i,u.forEach(f=>{var q,K;if(f.status!=="approved")return;const s=((q=f.employee)==null?void 0:q._id)||f.employee,d=W(f.startDate).date(),$=W(f.endDate).date();for(let z=d;z<=$;z++)(K=c.value[s])!=null&&K[z]&&(c.value[s][z].leave={type:f.leaveType})})}}catch(a){console.error(a),R.error("取得排班資料失敗")}}async function Me(){if(Object.values(c.value).some(a=>Object.values(a).some(o=>!o.shiftId&&!o.leave))){Ee("尚有未排班項目，請確認後再儲存");return}const e=[];if(Object.keys(c.value).forEach(a=>{Object.keys(c.value[a]).forEach(o=>{const n=c.value[a][o];n.shiftId&&!n.id&&e.push({employee:a,date:`${k.value}-${String(o).padStart(2,"0")}`,shiftId:n.shiftId,department:n.department,subDepartment:n.subDepartment})})}),!!e.length)try{const a=await C("/api/schedules/batch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({schedules:e})});if(!a.ok)throw new Error("save failed");(await a.json()).forEach(n=>{var t;const r=((t=n.employee)==null?void 0:t._id)||n.employee,p=W(n.date).date();c.value[r]||(c.value[r]={}),c.value[r][p]={id:n._id,shiftId:n.shiftId}}),R.success("儲存完成")}catch{R.error("儲存失敗")}}function me(l){sessionStorage.setItem("schedulePreview",JSON.stringify({scheduleMap:c.value,employees:U.value,days:oe.value,shifts:N.value})),Ve.push({name:l==="week"?"PreviewWeek":"PreviewMonth"})}async function fe(l){try{const e=await C(`/api/schedules/export?month=${k.value}&format=${l}`);if(!e.ok)throw new Error;const a=await e.blob(),o=URL.createObjectURL(a),n=document.createElement("a");n.href=o,n.download=`schedules-${k.value}.${l==="excel"?"xlsx":"pdf"}`,n.click(),URL.revokeObjectURL(o)}catch{R.error("匯出失敗")}}async function Ne(l,e,a){const o=`${k.value}-${String(e).padStart(2,"0")}`,n=c.value[l][e],r=(n==null?void 0:n.shiftId)??"";if(n&&n.id)try{const p=await C(`/api/schedules/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({shiftId:a,department:n.department,subDepartment:n.subDepartment})});p.ok||await le(p,"更新排班失敗",l,e,r)}catch{await le(null,"更新排班失敗",l,e,r)}else try{const p=await C("/api/schedules",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({employee:l,date:o,shiftId:a,department:n.department,subDepartment:n.subDepartment})});if(p.ok){const t=await p.json();c.value[l][e]={id:t._id,shiftId:t.shiftId,department:n.department,subDepartment:n.subDepartment}}else await le(p,"新增排班失敗",l,e,r)}catch{await le(null,"新增排班失敗",l,e,r)}}async function Te(){I.value="",await pe(w.value),await se(w.value,""),await ae()}async function Le(){await se(w.value,I.value),await ae()}async function le(l,e,a,o,n){c.value[a]||(c.value[a]={});const r=c.value[a][o]||{shiftId:"",department:"",subDepartment:""};r.shiftId=n,c.value[a][o]=r;let p="";try{if(l){const t=await l.json();p=(t==null?void 0:t.error)||""}}catch{}p==="employee conflict"?ie.alert("人員衝突"):p==="department overlap"?ie.alert("跨區重複"):p==="leave conflict"?ie.alert("請假衝突"):R.error(e)}function F(l){return N.value.find(e=>e._id===l)}function Fe(l){const e=F(l);return e?/早/.test(e.code)?"shift-morning":/晚|夜/.test(e.code)?"shift-evening":"shift-normal":""}function ze(l){return x.value.filter(e=>e.department===l)}async function se(l="",e=""){const a=te(),o=[],n=l||w.value||j.value,r=e||I.value;a&&o.push(`supervisor=${a}`),n&&o.push(`department=${n}`),r&&o.push(`subDepartment=${r}`);const p=`/api/employees${o.length?`?${o.join("&")}`:""}`;try{const t=await C(p);if(!t.ok)throw new Error("Failed to fetch employees");const i=await t.json(),u=D.value.reduce((d,$)=>(d[$._id]=$.name,d),{}),f=x.value.reduce((d,$)=>(d[$._id]=$.name,d),{}),s=i.map(d=>({_id:d._id,name:d.name,departmentId:d.department,subDepartmentId:d.subDepartment,department:u[d.department]||"",subDepartment:f[d.subDepartment]||""})).sort((d,$)=>d.department.localeCompare($.department));U.value=s}catch(t){console.error(t),R.error("取得員工資料失敗")}}async function he(){try{const l=await C(`/api/schedules/summary?month=${k.value}`);if(l.ok){const e=await l.json();de.value={direct:e.length,unscheduled:e.filter(a=>a.shiftCount===0).length,onLeave:e.filter(a=>a.leaveCount>0).length}}}catch(l){console.error(l)}}async function Re(){await ae(),await he()}return Ye(async()=>{await he(),await Ae(),await Ue(),await Oe(),await se(w.value,I.value),await ae()}),(l,e)=>{const a=O("el-date-picker"),o=O("el-option"),n=O("el-select"),r=O("el-button"),p=O("el-input"),t=O("el-table-column"),i=O("el-popover"),u=O("el-table"),f=O("el-tag");return m(),y("div",at,[e[24]||(e[24]=v("div",{class:"page-header"},[v("h1",{class:"page-title"},"排班管理"),v("p",{class:"page-subtitle"},"管理員工排班與班表預覽")],-1)),h(tt,{summary:de.value},null,8,["summary"]),v("div",lt,[e[13]||(e[13]=v("div",{class:"filters-header"},[v("h3",{class:"filters-title"},"篩選條件")],-1)),v("div",st,[v("div",nt,[e[10]||(e[10]=v("label",{class:"filter-label"},"選擇月份",-1)),h(a,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=s=>k.value=s),type:"month",onChange:Re,class:"modern-date-picker"},null,8,["modelValue"])]),v("div",ot,[e[11]||(e[11]=v("label",{class:"filter-label"},"部門",-1)),h(n,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=s=>w.value=s),placeholder:"請選擇部門",onChange:Te,disabled:!0,class:"modern-select"},{default:_(()=>[(m(!0),y(A,null,B(D.value,s=>(m(),E(o,{key:s._id,label:s.name,value:s._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),v("div",rt,[e[12]||(e[12]=v("label",{class:"filter-label"},"單位",-1)),h(n,{modelValue:I.value,"onUpdate:modelValue":e[2]||(e[2]=s=>I.value=s),placeholder:"請選擇單位",onChange:Le,class:"modern-select"},{default:_(()=>[(m(!0),y(A,null,B(Ce.value,s=>(m(),E(o,{key:s._id,label:s.name,value:s._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])])]),v("div",it,[v("div",ut,[h(r,{type:"primary",onClick:Me,class:"action-btn primary"},{default:_(()=>e[14]||(e[14]=[v("i",{class:"el-icon-check"},null,-1),P(" 儲存排班 ")])),_:1})]),v("div",dt,[h(r,{onClick:e[3]||(e[3]=s=>me("week")),class:"action-btn secondary"},{default:_(()=>e[15]||(e[15]=[v("i",{class:"el-icon-calendar"},null,-1),P(" 預覽週表 ")])),_:1}),h(r,{onClick:e[4]||(e[4]=s=>me("month")),class:"action-btn secondary"},{default:_(()=>e[16]||(e[16]=[v("i",{class:"el-icon-date"},null,-1),P(" 預覽月表 ")])),_:1}),h(r,{onClick:e[5]||(e[5]=()=>fe("pdf")),class:"action-btn export"},{default:_(()=>e[17]||(e[17]=[v("i",{class:"el-icon-download"},null,-1),P(" 匯出 PDF ")])),_:1}),h(r,{onClick:e[6]||(e[6]=()=>fe("excel")),class:"action-btn export"},{default:_(()=>e[18]||(e[18]=[v("i",{class:"el-icon-s-grid"},null,-1),P(" 匯出 Excel ")])),_:1})])]),v("div",ct,[v("div",vt,[e[19]||(e[19]=Ge('<h3 class="schedule-title" data-v-072975a1>員工排班表</h3><div class="schedule-legend" data-v-072975a1><span class="legend-item morning" data-v-072975a1>早班</span><span class="legend-item evening" data-v-072975a1>晚班</span><span class="legend-item normal" data-v-072975a1>正常班</span><span class="legend-item leave" data-v-072975a1>請假</span></div>',2)),h(p,{modelValue:X.value,"onUpdate:modelValue":e[7]||(e[7]=s=>X.value=s),placeholder:"搜尋員工",clearable:"",class:"employee-search"},null,8,["modelValue"]),h(n,{modelValue:Z.value,"onUpdate:modelValue":e[8]||(e[8]=s=>Z.value=s),placeholder:"狀態",class:"status-filter"},{default:_(()=>[h(o,{label:"全部",value:"all"}),h(o,{label:"缺班",value:"unscheduled"}),h(o,{label:"待審核請假",value:"onLeave"})]),_:1},8,["modelValue"])]),h(u,{class:"modern-schedule-table",data:Ie.value,"header-cell-style":{backgroundColor:"#ecfeff",color:"#164e63",fontWeight:"600"},"row-style":{backgroundColor:"#ffffff"},onRowClick:e[9]||(e[9]=s=>ce.value&&je(s._id))},{default:_(()=>[h(t,{label:"部門／單位",width:"180",fixed:"left"},{default:_(({row:s})=>[v("div",pt,[v("div",mt,V(s.department),1),s.subDepartment?(m(),y("div",ft,V(s.subDepartment),1)):Y("",!0)])]),_:1}),h(t,{prop:"name",label:"員工姓名",width:"120",fixed:"left"},{default:_(({row:s})=>[v("div",ht,[ne(s._id)==="unscheduled"?(m(),E(ue(re(ke)),{key:0,class:"status-icon unscheduled"})):ne(s._id)==="onLeave"?(m(),E(ue(re(De)),{key:1,class:"status-icon on-leave"})):Y("",!0),P(" "+V(s.name),1)])]),_:1}),(m(!0),y(A,null,B(oe.value,s=>(m(),E(t,{key:s.date,label:s.label,width:"140",align:"center"},{default:_(({row:d})=>{var $,q,K,z,_e,ye,be,ge,Se;return[!ce.value||ee.value.has(d._id)?(m(),y("div",{key:0,class:qe(["modern-schedule-cell",[Fe((q=($=c.value[d._id])==null?void 0:$[s.date])==null?void 0:q.shiftId),{"has-leave":(z=(K=c.value[d._id])==null?void 0:K[s.date])==null?void 0:z.leave,"missing-shift":!((ye=(_e=c.value[d._id])==null?void 0:_e[s.date])!=null&&ye.shiftId)&&!((ge=(be=c.value[d._id])==null?void 0:be[s.date])!=null&&ge.leave)}]])},[(Se=c.value[d._id])!=null&&Se[s.date]?(m(),y(A,{key:0},[re($e)?(m(),y(A,{key:0},[h(n,{modelValue:c.value[d._id][s.date].shiftId,"onUpdate:modelValue":b=>c.value[d._id][s.date].shiftId=b,placeholder:"選擇班別",onChange:b=>Ne(d._id,s.date,b),class:"cell-select shift-select",size:"small"},{default:_(()=>[(m(!0),y(A,null,B(N.value,b=>(m(),E(o,{key:b._id,label:b.code,value:b._id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),v("div",_t,[h(n,{modelValue:c.value[d._id][s.date].department,"onUpdate:modelValue":b=>c.value[d._id][s.date].department=b,placeholder:"部門",size:"small",onChange:()=>c.value[d._id][s.date].subDepartment="",class:"cell-select dept-select"},{default:_(()=>[(m(!0),y(A,null,B(D.value,b=>(m(),E(o,{key:b._id,label:b.name,value:b._id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"]),h(n,{modelValue:c.value[d._id][s.date].subDepartment,"onUpdate:modelValue":b=>c.value[d._id][s.date].subDepartment=b,placeholder:"單位",size:"small",class:"cell-select sub-dept-select"},{default:_(()=>[(m(!0),y(A,null,B(ze(c.value[d._id][s.date].department),b=>(m(),E(o,{key:b._id,label:b.name,value:b._id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])])],64)):(m(),y(A,{key:1},[c.value[d._id][s.date].leave?(m(),y("div",yt," 請假中 ")):F(c.value[d._id][s.date].shiftId)?(m(),E(i,{key:1,placement:"top",trigger:"hover",width:200},{reference:_(()=>[v("div",jt,V(F(c.value[d._id][s.date].shiftId).code),1)]),default:_(()=>[v("div",bt,[v("div",gt,[e[20]||(e[20]=v("span",{class:"detail-label"},"上班時間：",-1)),v("span",St,V(F(c.value[d._id][s.date].shiftId).startTime),1)]),v("div",wt,[e[21]||(e[21]=v("span",{class:"detail-label"},"下班時間：",-1)),v("span",kt,V(F(c.value[d._id][s.date].shiftId).endTime),1)]),F(c.value[d._id][s.date].shiftId).remark?(m(),y("div",Dt,[e[22]||(e[22]=v("span",{class:"detail-label"},"備註：",-1)),v("span",It,V(F(c.value[d._id][s.date].shiftId).remark),1)])):Y("",!0)])]),_:2},1024)):Y("",!0)],64)),!c.value[d._id][s.date].shiftId&&!c.value[d._id][s.date].leave?(m(),y("div",Ct," 未排班 ")):Y("",!0)],64)):(m(),y("span",Vt,"-"))],2)):(m(),y("div",$t,"展開班表"))]}),_:2},1032,["label"]))),128))]),_:1},8,["data"])]),J.value.length?(m(),y("div",Et,[v("div",At,[e[23]||(e[23]=v("h3",{class:"approval-title"},"待處理審批",-1)),v("div",Ot,V(J.value.length)+" 項待處理",1)]),h(u,{class:"modern-approval-table",data:J.value,"header-cell-style":{backgroundColor:"#f1f5f9",color:"#164e63",fontWeight:"600"}},{default:_(()=>[h(t,{label:"申請人",width:"120"},{default:_(({row:s})=>{var d;return[v("div",Ut,V((d=s.applicant_employee)==null?void 0:d.name),1)]}),_:1}),h(t,{label:"申請類型",width:"150"},{default:_(({row:s})=>{var d;return[v("div",xt,V(((d=s.form)==null?void 0:d.name)||"未知類型"),1)]}),_:1}),h(t,{prop:"status",label:"狀態",width:"100"},{default:_(({row:s})=>[h(f,{type:s.status==="approved"?"success":s.status==="rejected"?"danger":"warning",class:"status-tag"},{default:_(()=>[P(V(s.status),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])])):Y("",!0)])}}},Lt=we(Mt,[["__scopeId","data-v-072975a1"]]);export{Lt as default};
