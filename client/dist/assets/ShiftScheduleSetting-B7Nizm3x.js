import{a as y}from"./api-BD68GGQR.js";import{_ as ne,r as v,j as ie,c as Y,b as t,d as l,t as _,w as a,e as r,p as g,o as O,g as d,F as de,l as ue,k as re}from"./index-Drg5voG6.js";const pe={class:"shift-schedule-setting"},me={class:"page-header"},ve={class:"header-stats"},fe={class:"stat-item"},ce={class:"stat-number"},be={class:"stat-item"},ye={class:"stat-number"},ge={class:"tab-content"},_e={class:"content-header"},Ve={class:"table-container"},ke={class:"date-info"},we={class:"action-buttons"},he={class:"dialog-footer"},Te={class:"tab-content"},Ce={class:"content-header"},xe={class:"table-container"},Ue={class:"shift-info"},Se={class:"shift-name"},Me={class:"time-range"},Be={class:"start-time"},$e={class:"end-time"},De={class:"action-buttons"},ze={class:"dialog-footer"},Pe={class:"tab-content"},je={class:"settings-card"},Ae={class:"form-group"},Oe={class:"tab-content"},He={class:"settings-card"},Fe={class:"form-group"},Ee={class:"tab-content"},Ne={class:"settings-card"},qe={class:"form-group"},I="YYYY/MM/DD",D="HH:mm",Le={__name:"ShiftScheduleSetting",setup(Ge){const H=v("calendar"),k=v([]),h=v(!1);let M=null;const f=v({date:"",type:"",desc:""});async function z(){const s=await y("/api/holidays",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${g()}`}});s.ok&&(k.value=await s.json())}function F(s=null){s!==null?(M=s,f.value={...k.value[s]}):(M=null,f.value={date:"",type:"",desc:""}),h.value=!0}async function W(){const s=M===null?"POST":"PUT";let e="/api/holidays";if(s==="PUT"){const i=k.value[M]._id;e+=`/${i}`}await y(e,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${g()}`},body:JSON.stringify(f.value)}),await z(),h.value=!1}async function K(s){const e=k.value[s]._id;await y(`/api/holidays/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g()}`}}),await z()}const w=v([]),T=v(!1);let B=null;const u=v({name:"",code:"",startTime:"",endTime:"",crossDay:!1,remark:""});async function P(){const s=await y("/api/shifts",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${g()}`}});s.ok&&(w.value=await s.json())}function E(s=null){s!==null?(B=s,u.value={...w.value[s]}):(B=null,u.value={name:"",code:"",startTime:"",endTime:"",crossDay:!1,remark:""}),T.value=!0}async function Q(){const s=B===null?"POST":"PUT";let e="/api/shifts";if(s==="PUT"){const i=w.value[B]._id;e+=`/${i}`}await y(e,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${g()}`},body:JSON.stringify(u.value)}),await P(),T.value=!1}async function R(s){const e=w.value[s]._id;await y(`/api/shifts/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g()}`}}),await P()}const c=v({defaultTwoDayOff:!0,tempChangeAllowed:!1,deptManager:""}),N=v([]);async function X(){const s=await y("/api/dept-managers",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${g()}`}});s.ok&&(N.value=await s.json())}async function Z(){const s=c.value._id?"PUT":"POST";let e="/api/dept-schedules";s==="PUT"&&(e+=`/${c.value._id}`),(await y(e,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${g()}`},body:JSON.stringify(c.value)})).ok&&alert("已儲存「部門排班規則」設定")}const p=v({enableGlobalBreak:!1,breakMinutes:60,allowMultiBreak:!1});async function ee(){const s=p.value._id?"PUT":"POST";let e="/api/break-settings";s==="PUT"&&(e+=`/${p.value._id}`),(await y(e,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${g()}`},body:JSON.stringify(p.value)})).ok&&alert("已儲存「中場休息」設定")}const m=v({enableHolidayMove:!1,needSignature:!1,needMakeup:!1});async function le(){const s=m.value._id?"PUT":"POST";let e="/api/holiday-move-settings";s==="PUT"&&(e+=`/${m.value._id}`),(await y(e,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${g()}`},body:JSON.stringify(m.value)})).ok&&alert("已儲存「國定假日挪移」設定")}ie(()=>{z(),P(),X()});function te(s){return{國定假日:"danger",例假日:"success",公司休息日:"warning",補班日:"info"}[s]||"default"}return(s,e)=>{const i=r("el-button"),b=r("el-table-column"),j=r("el-tag"),q=r("el-table"),ae=r("el-date-picker"),n=r("el-form-item"),C=r("el-option"),L=r("el-select"),$=r("el-input"),x=r("el-form"),G=r("el-dialog"),U=r("el-tab-pane"),J=r("el-time-picker"),V=r("el-switch"),oe=r("el-input-number"),se=r("el-tabs");return O(),Y("div",pe,[t("div",me,[e[27]||(e[27]=t("div",{class:"header-content"},[t("h1",{class:"page-title"},"排班與班別管理設定"),t("p",{class:"page-description"},"管理班別時間、假日設定、排班規則和休息時間配置")],-1)),t("div",ve,[t("div",fe,[t("div",ce,_(k.value.length),1),e[25]||(e[25]=t("div",{class:"stat-label"},"假日",-1))]),t("div",be,[t("div",ye,_(w.value.length),1),e[26]||(e[26]=t("div",{class:"stat-label"},"班別",-1))])])]),l(se,{modelValue:H.value,"onUpdate:modelValue":e[24]||(e[24]=o=>H.value=o),type:"card",class:"schedule-tabs"},{default:a(()=>[l(U,{name:"calendar"},{label:a(()=>e[28]||(e[28]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-calendar"}),t("span",null,"行事曆設定")],-1)])),default:a(()=>[t("div",ge,[t("div",_e,[e[30]||(e[30]=t("h2",{class:"section-title"},"假日管理",-1)),l(i,{type:"primary",onClick:e[0]||(e[0]=o=>F()),class:"add-btn"},{default:a(()=>e[29]||(e[29]=[t("i",{class:"el-icon-plus"},null,-1),d(" 新增假日 ")])),_:1})]),t("div",Ve,[l(q,{data:k.value,class:"data-table","header-cell-style":{background:"#f8fafc",color:"#475569",fontWeight:"600"},"row-style":{height:"56px"}},{default:a(()=>[l(b,{prop:"date",label:"日期",width:"160"},{default:a(({row:o})=>[t("div",ke,[e[31]||(e[31]=t("i",{class:"el-icon-date"},null,-1)),d(" "+_(o.date),1)])]),_:1}),l(b,{prop:"type",label:"假日類型",width:"140"},{default:a(({row:o})=>[l(j,{type:te(o.type),class:"holiday-tag"},{default:a(()=>[d(_(o.type),1)]),_:2},1032,["type"])]),_:1}),l(b,{prop:"desc",label:"描述","min-width":"200"}),l(b,{label:"操作",width:"200",fixed:"right"},{default:a(({row:o,$index:S})=>[t("div",we,[l(i,{type:"primary",size:"small",onClick:A=>F(S),class:"edit-btn"},{default:a(()=>e[32]||(e[32]=[t("i",{class:"el-icon-edit"},null,-1),d(" 編輯 ")])),_:2},1032,["onClick"]),l(i,{type:"danger",size:"small",onClick:A=>K(S),class:"delete-btn"},{default:a(()=>e[33]||(e[33]=[t("i",{class:"el-icon-delete"},null,-1),d(" 刪除 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])]),l(G,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=o=>h.value=o),title:"假日資料",width:"500px",class:"form-dialog"},{footer:a(()=>[t("div",he,[l(i,{onClick:e[4]||(e[4]=o=>h.value=!1),class:"cancel-btn"},{default:a(()=>e[34]||(e[34]=[d("取消")])),_:1}),l(i,{type:"primary",onClick:W,class:"save-btn"},{default:a(()=>e[35]||(e[35]=[t("i",{class:"el-icon-check"},null,-1),d(" 儲存 ")])),_:1})])]),default:a(()=>[l(x,{model:f.value,"label-width":"120px",class:"dialog-form"},{default:a(()=>[l(n,{label:"日期",required:""},{default:a(()=>[l(ae,{modelValue:f.value.date,"onUpdate:modelValue":e[1]||(e[1]=o=>f.value.date=o),type:"date",placeholder:"選擇日期",format:I,"value-format":I,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(n,{label:"假日類型",required:""},{default:a(()=>[l(L,{modelValue:f.value.type,"onUpdate:modelValue":e[2]||(e[2]=o=>f.value.type=o),placeholder:"選擇類型",style:{width:"100%"}},{default:a(()=>[l(C,{label:"國定假日",value:"國定假日"}),l(C,{label:"例假日",value:"例假日"}),l(C,{label:"公司休息日",value:"公司休息日"}),l(C,{label:"補班日",value:"補班日"})]),_:1},8,["modelValue"])]),_:1}),l(n,{label:"描述"},{default:a(()=>[l($,{modelValue:f.value.desc,"onUpdate:modelValue":e[3]||(e[3]=o=>f.value.desc=o),placeholder:"例如：中秋節 / 週休 等",type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])]),_:1}),l(U,{name:"shift"},{label:a(()=>e[36]||(e[36]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-time"}),t("span",null,"班別設定")],-1)])),default:a(()=>[t("div",Te,[t("div",Ce,[e[38]||(e[38]=t("h2",{class:"section-title"},"班別管理",-1)),l(i,{type:"primary",onClick:e[6]||(e[6]=o=>E()),class:"add-btn"},{default:a(()=>e[37]||(e[37]=[t("i",{class:"el-icon-plus"},null,-1),d(" 新增班別 ")])),_:1})]),t("div",xe,[l(q,{data:w.value,class:"data-table","header-cell-style":{background:"#f8fafc",color:"#475569",fontWeight:"600"},"row-style":{height:"56px"}},{default:a(()=>[l(b,{prop:"code",label:"代碼",width:"100"},{default:a(({row:o})=>[l(j,{class:"code-tag"},{default:a(()=>[d(_(o.code),1)]),_:2},1024)]),_:1}),l(b,{prop:"name",label:"班別名稱",width:"180"},{default:a(({row:o})=>[t("div",Ue,[e[39]||(e[39]=t("div",{class:"shift-icon"},[t("i",{class:"el-icon-time"})],-1)),t("div",Se,_(o.name),1)])]),_:1}),l(b,{label:"工作時間",width:"200"},{default:a(({row:o})=>[t("div",Me,[t("span",Be,_(o.startTime),1),e[40]||(e[40]=t("i",{class:"el-icon-right time-separator"},null,-1)),t("span",$e,_(o.endTime),1)])]),_:1}),l(b,{prop:"crossDay",label:"跨日班",width:"100"},{default:a(({row:o})=>[l(j,{type:o.crossDay?"warning":"success",size:"small"},{default:a(()=>[d(_(o.crossDay?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(b,{prop:"remark",label:"備註","min-width":"150"}),l(b,{label:"操作",width:"200",fixed:"right"},{default:a(({row:o,$index:S})=>[t("div",De,[l(i,{type:"primary",size:"small",onClick:A=>E(S),class:"edit-btn"},{default:a(()=>e[41]||(e[41]=[t("i",{class:"el-icon-edit"},null,-1),d(" 編輯 ")])),_:2},1032,["onClick"]),l(i,{type:"danger",size:"small",onClick:A=>R(S),class:"delete-btn"},{default:a(()=>e[42]||(e[42]=[t("i",{class:"el-icon-delete"},null,-1),d(" 刪除 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])]),l(G,{modelValue:T.value,"onUpdate:modelValue":e[14]||(e[14]=o=>T.value=o),title:"班別資料",width:"500px",class:"form-dialog"},{footer:a(()=>[t("div",ze,[l(i,{onClick:e[13]||(e[13]=o=>T.value=!1),class:"cancel-btn"},{default:a(()=>e[43]||(e[43]=[d("取消")])),_:1}),l(i,{type:"primary",onClick:Q,class:"save-btn"},{default:a(()=>e[44]||(e[44]=[t("i",{class:"el-icon-check"},null,-1),d(" 儲存 ")])),_:1})])]),default:a(()=>[l(x,{model:u.value,"label-width":"120px",class:"dialog-form"},{default:a(()=>[l(n,{label:"班別代碼",required:""},{default:a(()=>[l($,{modelValue:u.value.code,"onUpdate:modelValue":e[7]||(e[7]=o=>u.value.code=o),placeholder:"如：A1, B2, C3"},null,8,["modelValue"])]),_:1}),l(n,{label:"班別名稱",required:""},{default:a(()=>[l($,{modelValue:u.value.name,"onUpdate:modelValue":e[8]||(e[8]=o=>u.value.name=o),placeholder:"如：早班 / 夜班 / 彈性班"},null,8,["modelValue"])]),_:1}),l(n,{label:"上班時間",required:""},{default:a(()=>[l(J,{modelValue:u.value.startTime,"onUpdate:modelValue":e[9]||(e[9]=o=>u.value.startTime=o),format:D,"value-format":D,placeholder:"選擇上班時間",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(n,{label:"下班時間",required:""},{default:a(()=>[l(J,{modelValue:u.value.endTime,"onUpdate:modelValue":e[10]||(e[10]=o=>u.value.endTime=o),format:D,"value-format":D,placeholder:"選擇下班時間",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(n,{label:"跨日班"},{default:a(()=>[l(V,{modelValue:u.value.crossDay,"onUpdate:modelValue":e[11]||(e[11]=o=>u.value.crossDay=o),"active-text":"是","inactive-text":"否","active-color":"#10b981"},null,8,["modelValue"])]),_:1}),l(n,{label:"備註"},{default:a(()=>[l($,{modelValue:u.value.remark,"onUpdate:modelValue":e[12]||(e[12]=o=>u.value.remark=o),type:"textarea",rows:3,placeholder:"班別說明或特殊注意事項"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])]),_:1}),l(U,{name:"deptSchedule"},{label:a(()=>e[45]||(e[45]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-s-operation"}),t("span",null,"部門排班規則")],-1)])),default:a(()=>[t("div",Pe,[t("div",je,[e[50]||(e[50]=t("h2",{class:"section-title"},"排班規則設定",-1)),l(x,{model:c.value,"label-width":"200px",class:"settings-form"},{default:a(()=>[t("div",Ae,[l(n,{label:"預設週休二日"},{default:a(()=>[l(V,{modelValue:c.value.defaultTwoDayOff,"onUpdate:modelValue":e[15]||(e[15]=o=>c.value.defaultTwoDayOff=o),"active-text":"啟用","inactive-text":"停用","active-color":"#10b981"},null,8,["modelValue"]),e[46]||(e[46]=t("div",{class:"form-help"},"啟用後新員工預設採用週休二日制度",-1))]),_:1}),l(n,{label:"可否臨時調班"},{default:a(()=>[l(V,{modelValue:c.value.tempChangeAllowed,"onUpdate:modelValue":e[16]||(e[16]=o=>c.value.tempChangeAllowed=o),"active-text":"允許","inactive-text":"禁止","active-color":"#10b981"},null,8,["modelValue"]),e[47]||(e[47]=t("div",{class:"form-help"},"允許員工在系統中申請臨時調班",-1))]),_:1}),l(n,{label:"部門排班管理者"},{default:a(()=>[l(L,{modelValue:c.value.deptManager,"onUpdate:modelValue":e[17]||(e[17]=o=>c.value.deptManager=o),placeholder:"選擇管理者",style:{width:"300px"}},{default:a(()=>[(O(!0),Y(de,null,ue(N.value,o=>(O(),re(C,{key:o.value,label:o.label,value:o.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[48]||(e[48]=t("div",{class:"form-help"},"指定負責部門排班管理的人員",-1))]),_:1})]),l(n,null,{default:a(()=>[l(i,{type:"primary",onClick:Z,class:"save-settings-btn"},{default:a(()=>e[49]||(e[49]=[t("i",{class:"el-icon-check"},null,-1),d(" 儲存部門排班規則 ")])),_:1})]),_:1})]),_:1},8,["model"])])])]),_:1}),l(U,{name:"breakSetting"},{label:a(()=>e[51]||(e[51]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-coffee-cup"}),t("span",null,"中場休息設定")],-1)])),default:a(()=>[t("div",Oe,[t("div",He,[e[56]||(e[56]=t("h2",{class:"section-title"},"休息時間設定",-1)),l(x,{model:p.value,"label-width":"220px",class:"settings-form"},{default:a(()=>[t("div",Fe,[l(n,{label:"是否啟用全局中場休息設定"},{default:a(()=>[l(V,{modelValue:p.value.enableGlobalBreak,"onUpdate:modelValue":e[18]||(e[18]=o=>p.value.enableGlobalBreak=o),"active-text":"啟用","inactive-text":"停用","active-color":"#10b981"},null,8,["modelValue"]),e[52]||(e[52]=t("div",{class:"form-help"},"啟用後所有員工都會套用統一的休息時間設定",-1))]),_:1}),l(n,{label:"全局休息時間 (分鐘)"},{default:a(()=>[l(oe,{modelValue:p.value.breakMinutes,"onUpdate:modelValue":e[19]||(e[19]=o=>p.value.breakMinutes=o),min:0,max:240,disabled:!p.value.enableGlobalBreak,style:{width:"200px"}},null,8,["modelValue","disabled"]),e[53]||(e[53]=t("div",{class:"form-help"},"設定每日的休息時間長度",-1))]),_:1}),l(n,{label:"是否允許多段休息"},{default:a(()=>[l(V,{modelValue:p.value.allowMultiBreak,"onUpdate:modelValue":e[20]||(e[20]=o=>p.value.allowMultiBreak=o),disabled:!p.value.enableGlobalBreak,"active-text":"允許","inactive-text":"不允許","active-color":"#10b981"},null,8,["modelValue","disabled"]),e[54]||(e[54]=t("div",{class:"form-help"},"允許員工將休息時間分成多個時段",-1))]),_:1})]),l(n,null,{default:a(()=>[l(i,{type:"primary",onClick:ee,class:"save-settings-btn"},{default:a(()=>e[55]||(e[55]=[t("i",{class:"el-icon-check"},null,-1),d(" 儲存休息設定 ")])),_:1})]),_:1})]),_:1},8,["model"])])])]),_:1}),l(U,{name:"holidayMove"},{label:a(()=>e[57]||(e[57]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-s-promotion"}),t("span",null,"國定假日挪移")],-1)])),default:a(()=>[t("div",Ee,[t("div",Ne,[e[62]||(e[62]=t("h2",{class:"section-title"},"假日挪移規則",-1)),l(x,{model:m.value,"label-width":"220px",class:"settings-form"},{default:a(()=>[t("div",qe,[l(n,{label:"是否允許挪移國定假日"},{default:a(()=>[l(V,{modelValue:m.value.enableHolidayMove,"onUpdate:modelValue":e[21]||(e[21]=o=>m.value.enableHolidayMove=o),"active-text":"允許","inactive-text":"禁止","active-color":"#10b981"},null,8,["modelValue"]),e[58]||(e[58]=t("div",{class:"form-help"},"允許員工申請將國定假日挪移到其他日期",-1))]),_:1}),l(n,{label:"挪移申請是否需簽名(電子簽核)"},{default:a(()=>[l(V,{modelValue:m.value.needSignature,"onUpdate:modelValue":e[22]||(e[22]=o=>m.value.needSignature=o),disabled:!m.value.enableHolidayMove,"active-text":"需要","inactive-text":"不需要","active-color":"#10b981"},null,8,["modelValue","disabled"]),e[59]||(e[59]=t("div",{class:"form-help"},"挪移申請是否需要經過電子簽核流程",-1))]),_:1}),l(n,{label:"挪移後是否補班"},{default:a(()=>[l(V,{modelValue:m.value.needMakeup,"onUpdate:modelValue":e[23]||(e[23]=o=>m.value.needMakeup=o),disabled:!m.value.enableHolidayMove,"active-text":"需要","inactive-text":"不需要","active-color":"#10b981"},null,8,["modelValue","disabled"]),e[60]||(e[60]=t("div",{class:"form-help"},"挪移假日後是否需要在其他日期補班",-1))]),_:1})]),l(n,null,{default:a(()=>[l(i,{type:"primary",onClick:le,class:"save-settings-btn"},{default:a(()=>e[61]||(e[61]=[t("i",{class:"el-icon-check"},null,-1),d(" 儲存挪移規則 ")])),_:1})]),_:1})]),_:1},8,["model"])])])]),_:1})]),_:1},8,["modelValue"])])}}},Ie=ne(Le,[["__scopeId","data-v-80b22bd3"]]);export{Ie as default};
