import{a as x}from"./api-6fBn2dnK.js";import{_ as O,r as p,j as h,c as A,b as S,d as l,w as a,e as m,o as G,g as y,E as i}from"./index-BsavUnBu.js";const j={class:"attendance-setting"},P={__name:"AttendanceSetting",setup(E){const _=p("abnormal"),k={lateGrace:5,earlyLeaveGrace:5,missingThreshold:30,autoNotify:!0},g={enableBreakPunch:!0,breakInterval:60,outingNeedApprove:!1},R={weekdayThreshold:30,holidayRate:2,toCompRate:1.5},r=p({...k}),s=p({...g}),d=p({...R});function w(t){!t||typeof t!="object"||(t.abnormalRules&&(r.value={...k,...t.abnormalRules}),t.breakOutRules&&(s.value={...g,...t.breakOutRules}),t.overtimeRules&&(d.value={...R,...t.overtimeRules}))}async function U(){const t=await x("/api/attendance-settings"),e=await t.json().catch(()=>null);if(!t.ok){console.error("讀取出勤設定失敗",(e==null?void 0:e.error)||t.statusText);return}w(e)}async function v(){const t={abnormalRules:{...r.value},breakOutRules:{...s.value},overtimeRules:{...d.value}},e=await x("/api/attendance-settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),n=await e.json().catch(()=>null);if(!e.ok)throw new Error((n==null?void 0:n.error)||"儲存設定時發生錯誤");return w(n),n}const T=async()=>{try{await v(),i.success("已儲存「異常判定規則」設定")}catch(t){i.error(t.message||"儲存失敗")}},N=async()=>{try{await v(),i.success("已儲存「分段打卡/外出」設定")}catch(t){i.error(t.message||"儲存失敗")}},B=async()=>{try{await v(),i.success("已儲存「加班規則」設定")}catch(t){i.error(t.message||"儲存失敗")}};return h(()=>{U()}),(t,e)=>{const n=m("el-input-number"),u=m("el-form-item"),f=m("el-switch"),b=m("el-button"),c=m("el-form"),V=m("el-tab-pane"),C=m("el-tabs");return G(),A("div",j,[e[14]||(e[14]=S("h2",null,"出勤設定",-1)),l(C,{modelValue:_.value,"onUpdate:modelValue":e[10]||(e[10]=o=>_.value=o),type:"card"},{default:a(()=>[l(V,{label:"異常判定規則",name:"abnormal"},{default:a(()=>[l(c,{model:r.value,"label-width":"140px",class:"rule-form"},{default:a(()=>[l(u,{label:"遲到容許誤差(分鐘)"},{default:a(()=>[l(n,{modelValue:r.value.lateGrace,"onUpdate:modelValue":e[0]||(e[0]=o=>r.value.lateGrace=o),min:0},null,8,["modelValue"])]),_:1}),l(u,{label:"早退容許誤差(分鐘)"},{default:a(()=>[l(n,{modelValue:r.value.earlyLeaveGrace,"onUpdate:modelValue":e[1]||(e[1]=o=>r.value.earlyLeaveGrace=o),min:0},null,8,["modelValue"])]),_:1}),l(u,{label:"缺卡判斷時間(分鐘)"},{default:a(()=>[l(n,{modelValue:r.value.missingThreshold,"onUpdate:modelValue":e[2]||(e[2]=o=>r.value.missingThreshold=o),min:0},null,8,["modelValue"])]),_:1}),l(u,{label:"未打卡自動通知"},{default:a(()=>[l(f,{modelValue:r.value.autoNotify,"onUpdate:modelValue":e[3]||(e[3]=o=>r.value.autoNotify=o),"active-text":"啟用","inactive-text":"停用"},null,8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(b,{type:"primary",onClick:T},{default:a(()=>e[11]||(e[11]=[y("儲存規則")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(V,{label:"分段打卡/外出",name:"break-outing"},{default:a(()=>[l(c,{model:s.value,"label-width":"140px",class:"rule-form"},{default:a(()=>[l(u,{label:"是否允許分段打卡"},{default:a(()=>[l(f,{modelValue:s.value.enableBreakPunch,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.enableBreakPunch=o),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),l(u,{label:"分段打卡最少間隔(分鐘)"},{default:a(()=>[l(n,{modelValue:s.value.breakInterval,"onUpdate:modelValue":e[5]||(e[5]=o=>s.value.breakInterval=o),min:0,disabled:!s.value.enableBreakPunch},null,8,["modelValue","disabled"])]),_:1}),l(u,{label:"外出登記需審核"},{default:a(()=>[l(f,{modelValue:s.value.outingNeedApprove,"onUpdate:modelValue":e[6]||(e[6]=o=>s.value.outingNeedApprove=o),"active-text":"需要","inactive-text":"不需要"},null,8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(b,{type:"primary",onClick:N},{default:a(()=>e[12]||(e[12]=[y("儲存設定")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(V,{label:"加班規則",name:"overtime"},{default:a(()=>[l(c,{model:d.value,"label-width":"120px",class:"rule-form"},{default:a(()=>[l(u,{label:"平日加班起算(分)"},{default:a(()=>[l(n,{modelValue:d.value.weekdayThreshold,"onUpdate:modelValue":e[7]||(e[7]=o=>d.value.weekdayThreshold=o),min:0},null,8,["modelValue"])]),_:1}),l(u,{label:"假日加班倍數"},{default:a(()=>[l(n,{modelValue:d.value.holidayRate,"onUpdate:modelValue":e[8]||(e[8]=o=>d.value.holidayRate=o),min:1,step:.1},null,8,["modelValue"])]),_:1}),l(u,{label:"轉補休折算比率"},{default:a(()=>[l(n,{modelValue:d.value.toCompRate,"onUpdate:modelValue":e[9]||(e[9]=o=>d.value.toCompRate=o),min:1,step:.1},null,8,["modelValue"])]),_:1}),l(u,null,{default:a(()=>[l(b,{type:"primary",onClick:B},{default:a(()=>e[13]||(e[13]=[y("儲存加班規則")])),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),_:1},8,["modelValue"])])}}},L=O(P,[["__scopeId","data-v-0fd6d15c"]]);export{L as default};
