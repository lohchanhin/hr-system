import{a as b}from"./api-Coim478o.js";import{_ as te,r as v,v as ae,j as oe,c as se,b as t,d as l,t as c,w as a,e as u,y,o as ie,g as r,z as ne}from"./index-B1-Hvwow.js";import{b as de}from"./shiftColors-BbvJ2s1U.js";const ue={class:"shift-schedule-setting"},re={class:"page-header"},fe={class:"header-stats"},pe={class:"stat-item"},me={class:"stat-number"},ce={class:"stat-item"},ve={class:"stat-number"},be={class:"tab-content"},ye={class:"content-header"},_e={class:"table-container"},ge={class:"date-info"},he={class:"action-buttons"},Ve={class:"dialog-footer"},we={class:"tab-content"},ke={class:"content-header"},Te={class:"table-container"},Ce={class:"shift-info"},Se={class:"shift-name"},xe={class:"time-range"},Ue={class:"start-time"},$e={class:"end-time"},Me={class:"action-buttons"},De={class:"dialog-footer"},ze={class:"tab-content"},He={class:"settings-card"},Ae={class:"form-group"},I="YYYY/MM/DD",U="HH:mm",Be={__name:"ShiftScheduleSetting",setup(Pe){const P=v("calendar"),_=v([]),h=v(!1);let k=null;const p=v({date:"",type:"",desc:""});async function $(){const s=await b("/api/holidays",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${y()}`}});s.ok&&(_.value=await s.json())}function j(s=null){s!==null?(k=s,p.value={..._.value[s]}):(k=null,p.value={date:"",type:"",desc:""}),h.value=!0}async function L(){const s=k===null?"POST":"PUT";let e="/api/holidays";if(s==="PUT"){const n=_.value[k]._id;e+=`/${n}`}await b(e,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${y()}`},body:JSON.stringify(p.value)}),await $(),h.value=!1}async function Y(s){const e=_.value[s]._id;await b(`/api/holidays/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y()}`}}),await $()}const g=v([]),V=v(!1);let T=null;const J=["#dbeafe","#ede9fe","#fef3c7","#dcfce7","#fee2e2","#fce7f3","#cffafe","#fae8ff"],W=["#0f172a","#1e3a8a","#047857","#92400e","#991b1b","#9d174d","#155e75","#f8fafc"],M=()=>({name:"",code:"",startTime:"",endTime:"",crossDay:!1,remark:"",color:"",bgColor:""}),i=v(M()),G=ae(()=>{const s=de(i.value);return{background:`linear-gradient(135deg, ${s["--shift-cell-bg-start"]??"#f1f5f9"} 0%, ${s["--shift-cell-bg-end"]??"#e2e8f0"} 100%)`,color:s["--shift-text-color"]??"#0f172a",borderColor:s["--shift-border-color"]??"rgba(148, 163, 184, 0.45)"}});async function D(){const s=await b("/api/shifts",{headers:{"Content-Type":"application/json",Authorization:`Bearer ${y()}`}});if(s.ok){const e=await s.json();g.value=Array.isArray(e==null?void 0:e.shifts)?e.shifts:Array.isArray(e)?e:[]}}function E(s=null){s!==null?(T=s,i.value={...M(),...g.value[s]}):(T=null,i.value=M()),V.value=!0}async function K(){const s=T===null?"POST":"PUT";let e="/api/shifts";if(s==="PUT"){const n=g.value[T]._id;e+=`/${n}`}await b(e,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${y()}`},body:JSON.stringify(i.value)}),await D(),V.value=!1}async function Q(s){const e=g.value[s]._id;await b(`/api/shifts/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y()}`}}),await D()}const f=v({enableHolidayMove:!1,needSignature:!1,needMakeup:!1});async function R(){const s=f.value._id?"PUT":"POST";let e="/api/holiday-move-settings";s==="PUT"&&(e+=`/${f.value._id}`),(await b(e,{method:s,headers:{"Content-Type":"application/json",Authorization:`Bearer ${y()}`},body:JSON.stringify(f.value)})).ok&&alert("已儲存「國定假日挪移」設定")}oe(()=>{$(),D()});function X(s){return{國定假日:"danger",例假日:"success",公司休息日:"warning",補班日:"info"}[s]||"default"}return(s,e)=>{const n=u("el-button"),m=u("el-table-column"),z=u("el-tag"),F=u("el-table"),Z=u("el-date-picker"),d=u("el-form-item"),C=u("el-option"),ee=u("el-select"),S=u("el-input"),H=u("el-form"),q=u("el-dialog"),A=u("el-tab-pane"),N=u("el-time-picker"),x=u("el-switch"),O=u("el-color-picker"),le=u("el-tabs");return ie(),se("div",ue,[t("div",re,[e[23]||(e[23]=t("div",{class:"header-content"},[t("h1",{class:"page-title"},"排班與班別管理設定"),t("p",{class:"page-description"},"管理班別時間、假日設定與國定假日挪移配置")],-1)),t("div",fe,[t("div",pe,[t("div",me,c(_.value.length),1),e[21]||(e[21]=t("div",{class:"stat-label"},"假日",-1))]),t("div",ce,[t("div",ve,c(g.value.length),1),e[22]||(e[22]=t("div",{class:"stat-label"},"班別",-1))])])]),l(le,{modelValue:P.value,"onUpdate:modelValue":e[20]||(e[20]=o=>P.value=o),type:"card",class:"schedule-tabs"},{default:a(()=>[l(A,{name:"calendar"},{label:a(()=>e[24]||(e[24]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-calendar"}),t("span",null,"行事曆設定")],-1)])),default:a(()=>[t("div",be,[t("div",ye,[e[26]||(e[26]=t("h2",{class:"section-title"},"假日管理",-1)),l(n,{type:"primary",onClick:e[0]||(e[0]=o=>j()),class:"add-btn"},{default:a(()=>e[25]||(e[25]=[t("i",{class:"el-icon-plus"},null,-1),r(" 新增假日 ")])),_:1})]),t("div",_e,[l(F,{data:_.value,class:"data-table","header-cell-style":{background:"#f8fafc",color:"#475569",fontWeight:"600"},"row-style":{height:"56px"}},{default:a(()=>[l(m,{prop:"date",label:"日期",width:"160"},{default:a(({row:o})=>[t("div",ge,[e[27]||(e[27]=t("i",{class:"el-icon-date"},null,-1)),r(" "+c(o.date),1)])]),_:1}),l(m,{prop:"type",label:"假日類型",width:"140"},{default:a(({row:o})=>[l(z,{type:X(o.type),class:"holiday-tag"},{default:a(()=>[r(c(o.type),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"desc",label:"描述","min-width":"200"}),l(m,{label:"操作",width:"200",fixed:"right"},{default:a(({row:o,$index:w})=>[t("div",he,[l(n,{type:"primary",size:"small",onClick:B=>j(w),class:"edit-btn"},{default:a(()=>e[28]||(e[28]=[t("i",{class:"el-icon-edit"},null,-1),r(" 編輯 ")])),_:2},1032,["onClick"]),l(n,{type:"danger",size:"small",onClick:B=>Y(w),class:"delete-btn"},{default:a(()=>e[29]||(e[29]=[t("i",{class:"el-icon-delete"},null,-1),r(" 刪除 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])]),l(q,{modelValue:h.value,"onUpdate:modelValue":e[5]||(e[5]=o=>h.value=o),title:"假日資料",width:"500px",class:"form-dialog"},{footer:a(()=>[t("div",Ve,[l(n,{onClick:e[4]||(e[4]=o=>h.value=!1),class:"cancel-btn"},{default:a(()=>e[30]||(e[30]=[r("取消")])),_:1}),l(n,{type:"primary",onClick:L,class:"save-btn"},{default:a(()=>e[31]||(e[31]=[t("i",{class:"el-icon-check"},null,-1),r(" 儲存 ")])),_:1})])]),default:a(()=>[l(H,{model:p.value,"label-width":"120px",class:"dialog-form"},{default:a(()=>[l(d,{label:"日期",required:""},{default:a(()=>[l(Z,{modelValue:p.value.date,"onUpdate:modelValue":e[1]||(e[1]=o=>p.value.date=o),type:"date",placeholder:"選擇日期",format:I,"value-format":I,style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(d,{label:"假日類型",required:""},{default:a(()=>[l(ee,{modelValue:p.value.type,"onUpdate:modelValue":e[2]||(e[2]=o=>p.value.type=o),placeholder:"選擇類型",style:{width:"100%"}},{default:a(()=>[l(C,{label:"國定假日",value:"國定假日"}),l(C,{label:"例假日",value:"例假日"}),l(C,{label:"公司休息日",value:"公司休息日"}),l(C,{label:"補班日",value:"補班日"})]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"描述"},{default:a(()=>[l(S,{modelValue:p.value.desc,"onUpdate:modelValue":e[3]||(e[3]=o=>p.value.desc=o),placeholder:"例如：中秋節 / 週休 等",type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])]),_:1}),l(A,{name:"shift"},{label:a(()=>e[32]||(e[32]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-time"}),t("span",null,"班別設定")],-1)])),default:a(()=>[t("div",we,[t("div",ke,[e[34]||(e[34]=t("h2",{class:"section-title"},"班別管理",-1)),l(n,{type:"primary",onClick:e[6]||(e[6]=o=>E()),class:"add-btn"},{default:a(()=>e[33]||(e[33]=[t("i",{class:"el-icon-plus"},null,-1),r(" 新增班別 ")])),_:1})]),t("div",Te,[l(F,{data:g.value,class:"data-table","header-cell-style":{background:"#f8fafc",color:"#475569",fontWeight:"600"},"row-style":{height:"56px"}},{default:a(()=>[l(m,{prop:"code",label:"代碼",width:"100"},{default:a(({row:o})=>[l(z,{class:"code-tag"},{default:a(()=>[r(c(o.code),1)]),_:2},1024)]),_:1}),l(m,{prop:"name",label:"班別名稱",width:"180"},{default:a(({row:o})=>[t("div",Ce,[e[35]||(e[35]=t("div",{class:"shift-icon"},[t("i",{class:"el-icon-time"})],-1)),t("div",Se,c(o.name),1)])]),_:1}),l(m,{label:"工作時間",width:"200"},{default:a(({row:o})=>[t("div",xe,[t("span",Ue,c(o.startTime),1),e[36]||(e[36]=t("i",{class:"el-icon-right time-separator"},null,-1)),t("span",$e,c(o.endTime),1)])]),_:1}),l(m,{prop:"crossDay",label:"跨日班",width:"100"},{default:a(({row:o})=>[l(z,{type:o.crossDay?"warning":"success",size:"small"},{default:a(()=>[r(c(o.crossDay?"是":"否"),1)]),_:2},1032,["type"])]),_:1}),l(m,{prop:"remark",label:"備註","min-width":"150"}),l(m,{label:"操作",width:"200",fixed:"right"},{default:a(({row:o,$index:w})=>[t("div",Me,[l(n,{type:"primary",size:"small",onClick:B=>E(w),class:"edit-btn"},{default:a(()=>e[37]||(e[37]=[t("i",{class:"el-icon-edit"},null,-1),r(" 編輯 ")])),_:2},1032,["onClick"]),l(n,{type:"danger",size:"small",onClick:B=>Q(w),class:"delete-btn"},{default:a(()=>e[38]||(e[38]=[t("i",{class:"el-icon-delete"},null,-1),r(" 刪除 ")])),_:2},1032,["onClick"])])]),_:1})]),_:1},8,["data"])]),l(q,{modelValue:V.value,"onUpdate:modelValue":e[16]||(e[16]=o=>V.value=o),title:"班別資料",width:"500px",class:"form-dialog"},{footer:a(()=>[t("div",De,[l(n,{onClick:e[15]||(e[15]=o=>V.value=!1),class:"cancel-btn"},{default:a(()=>e[39]||(e[39]=[r("取消")])),_:1}),l(n,{type:"primary",onClick:K,class:"save-btn"},{default:a(()=>e[40]||(e[40]=[t("i",{class:"el-icon-check"},null,-1),r(" 儲存 ")])),_:1})])]),default:a(()=>[l(H,{model:i.value,"label-width":"120px",class:"dialog-form"},{default:a(()=>[l(d,{label:"班別代碼",required:""},{default:a(()=>[l(S,{modelValue:i.value.code,"onUpdate:modelValue":e[7]||(e[7]=o=>i.value.code=o),placeholder:"如：A1, B2, C3"},null,8,["modelValue"])]),_:1}),l(d,{label:"班別名稱",required:""},{default:a(()=>[l(S,{modelValue:i.value.name,"onUpdate:modelValue":e[8]||(e[8]=o=>i.value.name=o),placeholder:"如：早班 / 夜班 / 彈性班"},null,8,["modelValue"])]),_:1}),l(d,{label:"上班時間",required:""},{default:a(()=>[l(N,{modelValue:i.value.startTime,"onUpdate:modelValue":e[9]||(e[9]=o=>i.value.startTime=o),format:U,"value-format":U,placeholder:"選擇上班時間",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(d,{label:"下班時間",required:""},{default:a(()=>[l(N,{modelValue:i.value.endTime,"onUpdate:modelValue":e[10]||(e[10]=o=>i.value.endTime=o),format:U,"value-format":U,placeholder:"選擇下班時間",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),l(d,{label:"跨日班"},{default:a(()=>[l(x,{modelValue:i.value.crossDay,"onUpdate:modelValue":e[11]||(e[11]=o=>i.value.crossDay=o),"active-text":"是","inactive-text":"否","active-color":"#10b981"},null,8,["modelValue"])]),_:1}),l(d,{label:"班別底色"},{default:a(()=>[l(O,{modelValue:i.value.bgColor,"onUpdate:modelValue":e[12]||(e[12]=o=>i.value.bgColor=o),predefine:J,"color-format":"hex","show-alpha":!1},null,8,["modelValue"])]),_:1}),l(d,{label:"文字顏色"},{default:a(()=>[l(O,{modelValue:i.value.color,"onUpdate:modelValue":e[13]||(e[13]=o=>i.value.color=o),predefine:W,"color-format":"hex","show-alpha":!1},null,8,["modelValue"])]),_:1}),l(d,{label:"顏色預覽"},{default:a(()=>[t("div",{class:"shift-color-preview",style:ne(G.value)},c(i.value.code||i.value.name||"SHIFT"),5)]),_:1}),l(d,{label:"備註"},{default:a(()=>[l(S,{modelValue:i.value.remark,"onUpdate:modelValue":e[14]||(e[14]=o=>i.value.remark=o),type:"textarea",rows:3,placeholder:"班別說明或特殊注意事項"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])]),_:1}),l(A,{name:"holidayMove"},{label:a(()=>e[41]||(e[41]=[t("div",{class:"tab-label"},[t("i",{class:"el-icon-s-promotion"}),t("span",null,"國定假日挪移")],-1)])),default:a(()=>[t("div",ze,[t("div",He,[e[46]||(e[46]=t("h2",{class:"section-title"},"假日挪移規則",-1)),l(H,{model:f.value,"label-width":"220px",class:"settings-form"},{default:a(()=>[t("div",Ae,[l(d,{label:"是否允許挪移國定假日"},{default:a(()=>[l(x,{modelValue:f.value.enableHolidayMove,"onUpdate:modelValue":e[17]||(e[17]=o=>f.value.enableHolidayMove=o),"active-text":"允許","inactive-text":"禁止","active-color":"#10b981"},null,8,["modelValue"]),e[42]||(e[42]=t("div",{class:"form-help"},"允許員工申請將國定假日挪移到其他日期",-1))]),_:1}),l(d,{label:"挪移申請是否需簽名(電子簽核)"},{default:a(()=>[l(x,{modelValue:f.value.needSignature,"onUpdate:modelValue":e[18]||(e[18]=o=>f.value.needSignature=o),disabled:!f.value.enableHolidayMove,"active-text":"需要","inactive-text":"不需要","active-color":"#10b981"},null,8,["modelValue","disabled"]),e[43]||(e[43]=t("div",{class:"form-help"},"挪移申請是否需要經過電子簽核流程",-1))]),_:1}),l(d,{label:"挪移後是否補班"},{default:a(()=>[l(x,{modelValue:f.value.needMakeup,"onUpdate:modelValue":e[19]||(e[19]=o=>f.value.needMakeup=o),disabled:!f.value.enableHolidayMove,"active-text":"需要","inactive-text":"不需要","active-color":"#10b981"},null,8,["modelValue","disabled"]),e[44]||(e[44]=t("div",{class:"form-help"},"挪移假日後是否需要在其他日期補班",-1))]),_:1})]),l(d,null,{default:a(()=>[l(n,{type:"primary",onClick:R,class:"save-settings-btn"},{default:a(()=>e[45]||(e[45]=[t("i",{class:"el-icon-check"},null,-1),r(" 儲存挪移規則 ")])),_:1})]),_:1})]),_:1},8,["model"])])])]),_:1})]),_:1},8,["modelValue"])])}}},qe=te(Be,[["__scopeId","data-v-ef8466a9"]]);export{qe as default};
