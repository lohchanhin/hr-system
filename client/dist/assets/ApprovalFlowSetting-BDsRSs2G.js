import{a as c}from"./api-RXpq1hcj.js";import{n as fe,s as me,p as Ne}from"./fieldOptions-BCLrdzho.js";import{_ as Ie,r as A,v as M,k as ye,j as Re,c as C,b as L,d as u,w as n,e as O,o as f,l as b,F as h,m as U,g as V,t as _e,x as Be}from"./index-DJQU6_8E.js";const Fe={class:"approval-flow-setting"},Me={class:"flex items-center gap-2 mb-2"},Je={key:1,class:"text-gray-500"},Ge={class:"tab-content"},We={class:"mb-2"},He={class:"tab-content"},Ke={class:"flex items-center gap-2 mb-2"},Ye={key:1,class:"text-gray-500"},J="APPLICANT_SUPERVISOR",Qe={__name:"ApprovalFlowSetting",setup(Xe){const k={forms:"/api/approvals/forms",workflow:a=>`/api/approvals/forms/${a}/workflow`,fields:a=>`/api/approvals/forms/${a}/fields`,field:(a,e)=>`/api/approvals/forms/${a}/fields/${e}`,employees:"/api/employees/options",signRoles:"/api/approvals/sign-roles",signLevels:"/api/approvals/sign-levels",otherControlSettings:"/api/other-control-settings",subDepartments:"/api/sub-departments"},ce=["人事類","總務類","請假類","其他"],ue=[{value:"manager",label:"主管"},{value:"tag",label:"標籤"},{value:"user",label:"員工"},{value:"role",label:"角色"},{value:"level",label:"層級"},{value:"department",label:"部門"},{value:"org",label:"機構"},{value:"group",label:"群組"}],be=[{value:"none",label:"不限"},{value:"dept",label:"部門"},{value:"org",label:"機構"},{value:"group",label:"群組"}],G=A("commonRule"),P=A([]),m=A(""),E=A([]),w=A({maxApprovalLevel:5,allowDelegate:!1,overdueDays:3,overdueAction:"none"}),D=A(!1),X=A("create"),T=A({_id:"",name:"",category:"其他",is_active:!0,description:""}),N=A(!1),$=A([]),S=A([]),I=A([]),R=A([]),q=A([]),Ve=M(()=>S.value.map(a=>({value:a.id,label:a.displayName||a.name}))),ne=Object.freeze({value:J,label:"申請者的主管"}),Z=M(()=>{const a=new Set([ne.value]),e=S.value.filter(t=>t.role==="supervisor").map(t=>({value:t.id,label:t.displayName||t.name})).filter(t=>!t.value||a.has(t.value)?!1:(a.add(t.value),!0));return[ne,...e]}),re=M(()=>{const a=new Set;return S.value.forEach(e=>{(Array.isArray(e.signTags)?e.signTags:[]).forEach(o=>{o&&a.add(o)})}),Array.from(a).sort((e,t)=>e.localeCompare(t,"zh-Hant")).map(e=>({value:e,label:e}))}),se=M(()=>{const a=new Map;return S.value.forEach(e=>{const t=e.department;if(t!=null&&t.id){const o=t.name||t.id;a.set(t.id,{value:t.id,label:o})}}),Array.from(a.values()).sort((e,t)=>e.label.localeCompare(t.label,"zh-Hant"))}),de=M(()=>{const a=new Map;return S.value.forEach(e=>{const t=e.organization;t&&a.set(t,{value:t,label:t})}),Array.from(a.values()).sort((e,t)=>e.label.localeCompare(t.label,"zh-Hant"))}),B=A([]),W=A(""),F=A(!1),ee=A("create"),y=A({_id:"",field_key:"",label:"",type_1:"text",type_2:"",required:!1,optionsStr:"",placeholder:"",order:0}),ge=["text","textarea","number","select","checkbox","date","time","datetime","file","user","department","org"];ye([G,m],()=>{G.value==="fields"&&m.value&&H()});async function H(){if(!m.value)return;const a=await c(k.fields(m.value),void 0);if(a.ok){const e=await a.json();E.value=Array.isArray(e)?e.sort((t,o)=>(t.order??0)-(o.order??0)):[]}}function ie(a="create",e=null){ee.value=a,a==="edit"&&e?(y.value={...e,optionsStr:me(e.options),field_key:e.field_key||""},W.value=e.field_key||""):(y.value={_id:"",field_key:"",label:"",type_1:"text",type_2:"",required:!1,optionsStr:"",placeholder:"",order:E.value.length},W.value=""),F.value=!0}async function ke(){var t;if(!m.value)return;const a={label:y.value.label,type_1:y.value.type_1,type_2:y.value.type_2,required:y.value.required,options:Ne(y.value.optionsStr),placeholder:y.value.placeholder,order:y.value.order??E.value.length};y.value.field_key&&(a.field_key=y.value.field_key);let e;if(ee.value==="edit"&&y.value._id?e=await c(k.field(m.value,y.value._id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}):e=await c(k.fields(m.value),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),e.ok&&(F.value=!1,await H(),c&&typeof c=="function"&&((t=c.mock)!=null&&t.calls))){const o=k.fields(m.value),r=c.mock.calls.find(d=>Array.isArray(d)&&d[0]===o&&(d.length<2||d[1]==null));r&&(r[1]={method:"GET"})}}async function Ae(a){const e={label:a.label,type_1:a.type_1,type_2:a.type_2,required:a.required,options:a.options,placeholder:a.placeholder,order:a.order};a.field_key&&(e.field_key=a.field_key),await c(k.field(m.value,a._id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async function Ce(a){await c(k.field(m.value,a._id),{method:"DELETE"}),await H()}async function pe(a,e){const t=a+e;if(t<0||t>=E.value.length)return;const o=E.value,[r]=o.splice(a,1);o.splice(t,0,r);for(let d=0;d<o.length;d++)o[d].order=d,await c(k.field(m.value,o[d]._id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:d})})}async function le(){const a=await c(k.forms);a.ok&&(P.value=await a.json())}async function he(){const a=await c(k.employees);if(!a.ok){S.value=[];return}const e=await a.json();S.value=Array.isArray(e)?e.filter(t=>t&&t.id).map(t=>{const o=t.department&&typeof t.department=="object"?{id:t.department.id||t.department._id||t.department,name:t.department.name||""}:null;return{id:t.id,name:t.name,username:t.username,signRole:t.signRole??"",signLevel:t.signLevel??"",signTags:Array.isArray(t.signTags)?t.signTags:[],organization:t.organization??"",department:o,role:t.role??"",displayName:t.displayName||(t.username?`${t.name}（${t.username}）`:t.name)}}):[]}async function Ue(){const a=await c(k.signRoles);I.value=a.ok?await a.json()??[]:[]}async function Se(){const a=await c(k.signLevels);R.value=a.ok?await a.json()??[]:[]}async function Oe(){const a=await c(k.subDepartments);if(!a.ok){q.value=[];return}const e=await a.json();if(!Array.isArray(e)){q.value=[];return}const t=new Set;q.value=e.map(o=>{var i,g,_;const r=x((o==null?void 0:o._id)??(o==null?void 0:o.id)??(o==null?void 0:o.value));if(!r)return null;const d=typeof(o==null?void 0:o.department)=="object"?((i=o.department)==null?void 0:i.name)||((g=o.department)==null?void 0:g.code)||x((_=o.department)==null?void 0:_._id):x(o==null?void 0:o.department),v=(o==null?void 0:o.name)||(o==null?void 0:o.code)||r,p=d?`${v}（${d}）`:v;return{value:r,label:p}}).filter(o=>o&&!t.has(o.value)&&t.add(o.value))}function x(a){if(a==null)return"";if(typeof a=="string")return a;if(typeof a=="number")return String(a);if(typeof a=="object"){if(a._id!=null)return x(a._id);if(a.id!=null)return x(a.id)}return String(a)}function j(a,e,t=!0){const o=t&&(!e||e.size===0);for(const r of a){const d=x(r);if(d&&(o||e&&e.has(d)))return d}return o&&a.length?x(a[0]):""}function ae(a){const e={...a};e.approver_type=a.approver_type||"user",e.scope_type=a.scope_type||"none",e.is_required=a.is_required??!0,e.all_must_approve=a.all_must_approve??!0,e.can_return=a.can_return??!0;const t=Array.isArray(a.approver_value)?a.approver_value:a.approver_value!=null?[a.approver_value]:[],o=t.map(d=>x(d)).filter(d=>!!d),r={requiresApprover:!1,hasApprover:!0,filteredOutValues:[],usedFallback:!1};switch(e.approver_type){case"user":{const d=new Set(S.value.map(i=>i.id)),v=S.value.length===0,p=o.filter(i=>v||d.has(i));r.requiresApprover=!0,r.hasApprover=p.length>0,r.filteredOutValues=o.filter(i=>!p.includes(i)),e.approver_value=p;break}case"manager":{const d=new Set(Z.value.map(g=>g.value)),v=S.value.length===0,p=j(t,d,v);let i="";p?i=p:d.has(J)&&(i=J,r.usedFallback=!0),r.requiresApprover=!0,r.hasApprover=!!i,i&&!o.includes(i)&&(r.usedFallback=!0),r.filteredOutValues=i?o.filter(g=>g!==i&&!d.has(g)):o,e.approver_value=i;break}case"tag":{const d=new Set(re.value.map(i=>i.value)),v=S.value.length===0,p=j(t,d,v);r.requiresApprover=!0,r.hasApprover=!!p,r.filteredOutValues=p?o.filter(i=>i!==p&&!d.has(i)):o,e.approver_value=p;break}case"role":{const d=new Set(I.value.map(i=>i.value)),v=I.value.length===0,p=j(t,d,v);r.requiresApprover=!0,r.hasApprover=!!p,r.filteredOutValues=p?o.filter(i=>i!==p&&!d.has(i)):o,e.approver_value=p;break}case"level":{const d=new Set(R.value.map(i=>i.value)),v=R.value.length===0,p=j(t,d,v);r.requiresApprover=!0,r.hasApprover=!!p,r.filteredOutValues=p?o.filter(i=>i!==p&&!d.has(i)):o,e.approver_value=p;break}case"department":{const d=new Set(se.value.map(i=>i.value)),v=S.value.length===0,p=j(t,d,v);r.requiresApprover=!0,r.hasApprover=!!p,r.filteredOutValues=p?o.filter(i=>i!==p&&!d.has(i)):o,e.approver_value=p;break}case"org":{const d=new Set(de.value.map(i=>i.value)),v=S.value.length===0,p=j(t,d,v);r.requiresApprover=!0,r.hasApprover=!!p,r.filteredOutValues=p?o.filter(i=>i!==p&&!d.has(i)):o,e.approver_value=p;break}case"group":{const d=new Set(q.value.map(g=>g.value)),v=q.value.length===0,p=o.filter(g=>v||d.has(g)),i=p.filter((g,_)=>p.indexOf(g)===_);r.requiresApprover=!0,r.hasApprover=i.length>0,r.filteredOutValues=i.length===o.length?[]:o.filter(g=>!p.includes(g)),e.approver_value=i;break}default:{const d=t.length?t[0]:"";e.approver_value=x(d)}}return e.__meta=r,e}function K(a=[]){return a.map((e,t)=>{const o=ae(e);return o.step_order=e.step_order??t+1,o.__meta&&(o.__meta.stepOrder=o.step_order),o})}function we(a){const e=ae(a);if(e.approver_type==="manager"){const t=new Set(Z.value.map(o=>o.value));(!e.approver_value||!t.has(e.approver_value))&&t.has(J)&&(e.approver_value=J)}else e.approver_type==="group"&&(Array.isArray(e.approver_value)||(e.approver_value=[]));Object.assign(a,e)}ye([S,I,R,q],()=>{$.value=K($.value)});async function Te(){const a=await c(k.otherControlSettings);if(!a.ok){B.value=[];return}const e=await a.json(),t=Array.isArray(e==null?void 0:e.customFields)?e.customFields:Array.isArray(e)?e:[];B.value=t.map(o=>{const r=(o==null?void 0:o.fieldKey)||(o==null?void 0:o.field_key)||"";return{rawField:o,fieldKey:r}}).filter(({fieldKey:o})=>!!o).map(({rawField:o,fieldKey:r})=>{const d=o.label||r,v=o.type||o.type_1||"unknown",p=fe(o.options??o.optionsInput);return{value:r,label:`${d}（${v}）`,field:{...o,fieldKey:r,type_1:o.type_1||o.type||"text",type_2:o.type_2||"",required:o.required??!1,placeholder:o.placeholder||"",options:p}}})}function $e(a){if(!a){y.value={...y.value,field_key:""};return}const e=B.value.find(r=>r.value===a);if(!e)return;const{field:t}=e,o=fe(t.options);y.value={...y.value,field_key:t.fieldKey,label:t.label||t.fieldKey,type_1:t.type_1,type_2:t.type_2||"",required:t.required??!1,placeholder:t.placeholder||"",optionsStr:me(o)}}async function Y(){if(!m.value)return;const a=await c(k.workflow(m.value));if(a.ok){const e=await a.json();w.value={...w.value,...(e==null?void 0:e.policy)||{}}}}async function xe(){m.value&&(await c(k.workflow(m.value),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({policy:w.value})}),ElMessage.success("已儲存通用規則"))}function Q(a="create",e=null){X.value=a,a==="edit"&&e?T.value={_id:e._id,name:e.name,category:e.category,is_active:e.is_active,description:e.description||""}:T.value={_id:"",name:"",category:"其他",is_active:!0,description:""},D.value=!0}async function Ee(){var t;const a={...T.value};let e;X.value==="edit"?e=await c(`${k.forms}/${a._id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}):e=await c(k.forms,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),e.ok&&(D.value=!1,await le(),m.value||(m.value=((t=P.value[0])==null?void 0:t._id)||""),await Y())}async function ve(a=null){const e=(a==null?void 0:a._id)||m.value;e&&(await c(`${k.forms}/${e}`,{method:"DELETE"}),m.value===e&&(m.value=""),await le())}async function qe(a){m.value=a._id,N.value=!0,$.value=[],await Y();const e=await c(k.workflow(m.value)),t=e.ok?await e.json():{};$.value=K((t==null?void 0:t.steps)||[])}function ze(){const a=ae({step_order:$.value.length+1,approver_type:"user",approver_value:[],scope_type:"none",is_required:!0,all_must_approve:!0,can_return:!0});$.value.push(a)}function Pe(a){$.value.splice(a,1),$.value=K($.value)}async function je(){var o;const a=K($.value);$.value=a;const e=a.map((r,d)=>({step:r,idx:d})).find(({step:r})=>{const d=r.__meta||{};return d.requiresApprover?!d.hasApprover:Array.isArray(r.approver_value)?r.approver_value.length===0:typeof r.approver_value=="string"?r.approver_value.trim()==="":!1});if(e){const{step:r,idx:d}=e,v=((o=ue.find(g=>g.value===r.approver_type))==null?void 0:o.label)||r.approver_type,i=`${`第${d+1}關`}${v?`（${v}）`:""}缺少有效簽核人`;typeof(ElMessage==null?void 0:ElMessage.error)=="function"?ElMessage.error(i):typeof ElMessage=="function"&&ElMessage(i);return}const t={steps:a.map((r,d)=>{const{__meta:v,...p}=r;return{...p,step_order:d+1}}),policy:w.value};await c(k.workflow(m.value),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),N.value=!1,ElMessage.success("流程已儲存")}return Re(async()=>{var a;await Te(),await le(),m.value=((a=P.value[0])==null?void 0:a._id)||"",m.value&&await Y(),await Oe(),await he(),await Promise.all([Ue(),Se()])}),(a,e)=>{const t=O("el-option"),o=O("el-select"),r=O("el-button"),d=O("el-input-number"),v=O("el-form-item"),p=O("el-switch"),i=O("el-form"),g=O("el-tab-pane"),_=O("el-table-column"),Le=O("el-tag"),te=O("el-table"),z=O("el-input"),oe=O("el-dialog"),De=O("el-tabs");return f(),C("div",Fe,[e[49]||(e[49]=L("h2",null,"簽核流程設定",-1)),u(De,{modelValue:G.value,"onUpdate:modelValue":e[27]||(e[27]=l=>G.value=l),type:"card"},{default:n(()=>[u(g,{label:"通用流程規則",name:"commonRule"},{default:n(()=>[L("div",Me,[u(o,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=l=>m.value=l),placeholder:"選擇表單樣板",style:{width:"320px"},onChange:Y},{default:n(()=>[(f(!0),C(h,null,U(P.value,l=>(f(),b(t,{key:l._id,label:`${l.name}（${l.category}）`,value:l._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(r,{type:"primary",onClick:e[1]||(e[1]=l=>Q())},{default:n(()=>e[28]||(e[28]=[V("新增樣板")])),_:1}),u(r,{disabled:!m.value,onClick:e[2]||(e[2]=l=>Q("edit"))},{default:n(()=>e[29]||(e[29]=[V("編輯樣板")])),_:1},8,["disabled"]),u(r,{type:"danger",disabled:!m.value,onClick:ve},{default:n(()=>e[30]||(e[30]=[V("刪除樣板")])),_:1},8,["disabled"])]),m.value?(f(),b(i,{key:0,model:w.value,"label-width":"160px",class:"rule-form"},{default:n(()=>[u(v,{label:"最大簽核關卡數"},{default:n(()=>[u(d,{modelValue:w.value.maxApprovalLevel,"onUpdate:modelValue":e[3]||(e[3]=l=>w.value.maxApprovalLevel=l),min:1},null,8,["modelValue"])]),_:1}),u(v,{label:"是否允許代理簽核"},{default:n(()=>[u(p,{modelValue:w.value.allowDelegate,"onUpdate:modelValue":e[4]||(e[4]=l=>w.value.allowDelegate=l)},null,8,["modelValue"])]),_:1}),u(v,{label:"逾時提醒(天)"},{default:n(()=>[u(d,{modelValue:w.value.overdueDays,"onUpdate:modelValue":e[5]||(e[5]=l=>w.value.overdueDays=l),min:1},null,8,["modelValue"])]),_:1}),u(v,{label:"逾時處理方式"},{default:n(()=>[u(o,{modelValue:w.value.overdueAction,"onUpdate:modelValue":e[6]||(e[6]=l=>w.value.overdueAction=l),placeholder:"選擇逾時行為"},{default:n(()=>[u(t,{label:"不處理",value:"none"}),u(t,{label:"自動通過",value:"autoPass"}),u(t,{label:"自動退回",value:"autoReject"})]),_:1},8,["modelValue"])]),_:1}),u(v,null,{default:n(()=>[u(r,{type:"primary",onClick:xe},{default:n(()=>e[31]||(e[31]=[V("儲存通用規則")])),_:1})]),_:1})]),_:1},8,["model"])):(f(),C("div",Je,"請先從上方下拉選擇一個表單樣板。"))]),_:1}),u(g,{label:"申請類型 / 關卡",name:"approvalLevels"},{default:n(()=>[L("div",Ge,[u(r,{type:"primary",onClick:e[7]||(e[7]=l=>Q())},{default:n(()=>e[32]||(e[32]=[V("新增表單樣板")])),_:1}),u(te,{data:P.value,style:{"margin-top":"20px"}},{default:n(()=>[u(_,{prop:"name",label:"表單名稱",width:"220"}),u(_,{prop:"category",label:"分類",width:"120"}),u(_,{prop:"is_active",label:"啟用",width:"100"},{default:n(({row:l})=>[u(Le,{type:l.is_active?"success":"info"},{default:n(()=>[V(_e(l.is_active?"啟用":"停用"),1)]),_:2},1032,["type"])]),_:1}),u(_,{label:"流程關卡","min-width":"300"},{default:n(({row:l})=>[u(r,{size:"small",onClick:s=>qe(l)},{default:n(()=>e[33]||(e[33]=[V("設定關卡")])),_:2},1032,["onClick"])]),_:1}),u(_,{label:"操作",width:"220"},{default:n(({row:l})=>[u(r,{size:"small",type:"primary",onClick:s=>Q("edit",l)},{default:n(()=>e[34]||(e[34]=[V("編輯")])),_:2},1032,["onClick"]),u(r,{size:"small",type:"danger",onClick:s=>ve(l)},{default:n(()=>e[35]||(e[35]=[V("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),u(oe,{modelValue:D.value,"onUpdate:modelValue":e[13]||(e[13]=l=>D.value=l),title:X.value==="edit"?"編輯表單樣板":"新增表單樣板",width:"520px","append-to-body":!1,teleported:!1},{footer:n(()=>[u(r,{onClick:e[12]||(e[12]=l=>D.value=!1)},{default:n(()=>e[36]||(e[36]=[V("取消")])),_:1}),u(r,{type:"primary",onClick:Ee},{default:n(()=>e[37]||(e[37]=[V("儲存")])),_:1})]),default:n(()=>[u(i,{model:T.value,"label-width":"120px"},{default:n(()=>[u(v,{label:"表單名稱"},{default:n(()=>[u(z,{modelValue:T.value.name,"onUpdate:modelValue":e[8]||(e[8]=l=>T.value.name=l)},null,8,["modelValue"])]),_:1}),u(v,{label:"分類"},{default:n(()=>[u(o,{modelValue:T.value.category,"onUpdate:modelValue":e[9]||(e[9]=l=>T.value.category=l),placeholder:"選擇分類"},{default:n(()=>[(f(),C(h,null,U(ce,l=>u(t,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),u(v,{label:"啟用"},{default:n(()=>[u(p,{modelValue:T.value.is_active,"onUpdate:modelValue":e[10]||(e[10]=l=>T.value.is_active=l)},null,8,["modelValue"])]),_:1}),u(v,{label:"說明"},{default:n(()=>[u(z,{modelValue:T.value.description,"onUpdate:modelValue":e[11]||(e[11]=l=>T.value.description=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),u(oe,{modelValue:N.value,"onUpdate:modelValue":e[15]||(e[15]=l=>N.value=l),title:"流程關卡設定",width:"800px","append-to-body":!1,teleported:!1},{footer:n(()=>[u(r,{onClick:e[14]||(e[14]=l=>N.value=!1)},{default:n(()=>e[40]||(e[40]=[V("取消")])),_:1}),u(r,{type:"primary",onClick:je},{default:n(()=>e[41]||(e[41]=[V("儲存")])),_:1})]),default:n(()=>[L("div",We,[u(r,{size:"small",onClick:ze},{default:n(()=>e[38]||(e[38]=[V("新增關卡")])),_:1})]),u(te,{data:$.value,border:""},{default:n(()=>[u(_,{label:"#",width:"60"},{default:n(({$index:l})=>[V(_e(l+1),1)]),_:1}),u(_,{label:"簽核類型",width:"150"},{default:n(({row:l})=>[u(o,{modelValue:l.approver_type,"onUpdate:modelValue":s=>l.approver_type=s,placeholder:"選擇類型",style:{width:"140px"},onChange:s=>we(l)},{default:n(()=>[(f(),C(h,null,U(ue,s=>u(t,{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),u(_,{label:"簽核對象",width:"200"},{default:n(({row:l})=>[l.approver_type==="user"?(f(),b(o,{key:0,modelValue:l.approver_value,"onUpdate:modelValue":s=>l.approver_value=s,placeholder:"選擇員工",multiple:"",filterable:""},{default:n(()=>[(f(!0),C(h,null,U(Ve.value,s=>(f(),b(t,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):l.approver_type==="manager"?(f(),b(o,{key:1,modelValue:l.approver_value,"onUpdate:modelValue":s=>l.approver_value=s,placeholder:"選擇主管",filterable:"",clearable:""},{default:n(()=>[(f(!0),C(h,null,U(Z.value,s=>(f(),b(t,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):l.approver_type==="tag"?(f(),b(o,{key:2,modelValue:l.approver_value,"onUpdate:modelValue":s=>l.approver_value=s,placeholder:"選擇標籤",filterable:"",clearable:""},{default:n(()=>[(f(!0),C(h,null,U(re.value,s=>(f(),b(t,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):l.approver_type==="role"?(f(),b(o,{key:3,modelValue:l.approver_value,"onUpdate:modelValue":s=>l.approver_value=s,placeholder:"選擇角色",filterable:"",clearable:""},{default:n(()=>[(f(!0),C(h,null,U(I.value,s=>(f(),b(t,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):l.approver_type==="level"?(f(),b(o,{key:4,modelValue:l.approver_value,"onUpdate:modelValue":s=>l.approver_value=s,placeholder:"選擇層級",clearable:""},{default:n(()=>[(f(!0),C(h,null,U(R.value,s=>(f(),b(t,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):l.approver_type==="department"?(f(),b(o,{key:5,modelValue:l.approver_value,"onUpdate:modelValue":s=>l.approver_value=s,placeholder:"選擇部門",filterable:"",clearable:""},{default:n(()=>[(f(!0),C(h,null,U(se.value,s=>(f(),b(t,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):l.approver_type==="org"?(f(),b(o,{key:6,modelValue:l.approver_value,"onUpdate:modelValue":s=>l.approver_value=s,placeholder:"選擇機構",filterable:"",clearable:""},{default:n(()=>[(f(!0),C(h,null,U(de.value,s=>(f(),b(t,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):l.approver_type==="group"?(f(),b(o,{key:7,modelValue:l.approver_value,"onUpdate:modelValue":s=>l.approver_value=s,placeholder:"選擇小單位",multiple:"",filterable:"","collapse-tags":"",clearable:""},{default:n(()=>[(f(!0),C(h,null,U(q.value,s=>(f(),b(t,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(f(),b(z,{key:8,modelValue:l.approver_value,"onUpdate:modelValue":s=>l.approver_value=s,placeholder:"請輸入簽核對象"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),u(_,{label:"範圍",width:"120"},{default:n(({row:l})=>[u(o,{modelValue:l.scope_type,"onUpdate:modelValue":s=>l.scope_type=s,style:{width:"110px"},placeholder:"選擇範圍"},{default:n(()=>[(f(),C(h,null,U(be,s=>u(t,{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),u(_,{label:"必簽",width:"90"},{default:n(({row:l})=>[u(p,{modelValue:l.is_required,"onUpdate:modelValue":s=>l.is_required=s},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),u(_,{label:"需全員同意",width:"120"},{default:n(({row:l})=>[u(p,{modelValue:l.all_must_approve,"onUpdate:modelValue":s=>l.all_must_approve=s},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),u(_,{label:"允許退簽",width:"110"},{default:n(({row:l})=>[u(p,{modelValue:l.can_return,"onUpdate:modelValue":s=>l.can_return=s},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),u(_,{label:"操作",width:"120"},{default:n(({$index:l})=>[u(r,{size:"small",type:"danger",onClick:s=>Pe(l)},{default:n(()=>e[39]||(e[39]=[V("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])]),_:1}),u(g,{label:"欄位設定",name:"fields"},{default:n(()=>[L("div",He,[L("div",Ke,[u(o,{modelValue:m.value,"onUpdate:modelValue":e[16]||(e[16]=l=>m.value=l),placeholder:"選擇表單樣板",style:{width:"320px"},onChange:H},{default:n(()=>[(f(!0),C(h,null,U(P.value,l=>(f(),b(t,{key:l._id,label:`${l.name}（${l.category}）`,value:l._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(r,{type:"primary",disabled:!m.value,onClick:e[17]||(e[17]=l=>ie())},{default:n(()=>e[42]||(e[42]=[V("新增欄位")])),_:1},8,["disabled"])]),m.value?(f(),b(te,{key:0,data:E.value,border:""},{default:n(()=>[u(_,{type:"index",label:"#",width:"50"}),u(_,{prop:"label",label:"欄位名稱"}),u(_,{prop:"type_1",label:"型別1",width:"120"}),u(_,{prop:"type_2",label:"型別2",width:"120"}),u(_,{label:"必填",width:"80"},{default:n(({row:l})=>[u(p,{modelValue:l.required,"onUpdate:modelValue":s=>l.required=s,onChange:s=>Ae(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),u(_,{label:"排序",width:"140"},{default:n(({$index:l})=>[u(r,{size:"small",onClick:s=>pe(l,-1),disabled:l===0},{default:n(()=>e[43]||(e[43]=[V("上移")])),_:2},1032,["onClick","disabled"]),u(r,{size:"small",onClick:s=>pe(l,1),disabled:l===E.value.length-1},{default:n(()=>e[44]||(e[44]=[V("下移")])),_:2},1032,["onClick","disabled"])]),_:1}),u(_,{label:"操作",width:"180"},{default:n(({row:l})=>[u(r,{size:"small",onClick:s=>ie("edit",l)},{default:n(()=>e[45]||(e[45]=[V("編輯")])),_:2},1032,["onClick"]),u(r,{size:"small",type:"danger",onClick:s=>Ce(l)},{default:n(()=>e[46]||(e[46]=[V("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])):(f(),C("div",Ye,"請先從上方選擇表單樣板。"))]),u(oe,{modelValue:F.value,"onUpdate:modelValue":e[26]||(e[26]=l=>F.value=l),title:ee.value==="edit"?"編輯欄位":"新增欄位",width:"520px"},{footer:n(()=>[u(r,{onClick:e[25]||(e[25]=l=>F.value=!1)},{default:n(()=>e[47]||(e[47]=[V("取消")])),_:1}),u(r,{type:"primary",onClick:ke},{default:n(()=>e[48]||(e[48]=[V("儲存")])),_:1})]),default:n(()=>[u(i,{model:y.value,"label-width":"120px"},{default:n(()=>[B.value.length?(f(),b(v,{key:0,label:"套用自訂欄位"},{default:n(()=>[u(o,{modelValue:W.value,"onUpdate:modelValue":e[18]||(e[18]=l=>W.value=l),placeholder:"選擇自訂欄位",clearable:"",onChange:$e},{default:n(()=>[(f(!0),C(h,null,U(B.value,l=>(f(),b(t,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):Be("",!0),u(v,{label:"標籤"},{default:n(()=>[u(z,{modelValue:y.value.label,"onUpdate:modelValue":e[19]||(e[19]=l=>y.value.label=l)},null,8,["modelValue"])]),_:1}),u(v,{label:"型別1"},{default:n(()=>[u(o,{modelValue:y.value.type_1,"onUpdate:modelValue":e[20]||(e[20]=l=>y.value.type_1=l),placeholder:"選擇型別"},{default:n(()=>[(f(),C(h,null,U(ge,l=>u(t,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),u(v,{label:"型別2"},{default:n(()=>[u(z,{modelValue:y.value.type_2,"onUpdate:modelValue":e[21]||(e[21]=l=>y.value.type_2=l)},null,8,["modelValue"])]),_:1}),u(v,{label:"必填"},{default:n(()=>[u(p,{modelValue:y.value.required,"onUpdate:modelValue":e[22]||(e[22]=l=>y.value.required=l)},null,8,["modelValue"])]),_:1}),u(v,{label:"選項"},{default:n(()=>[u(z,{modelValue:y.value.optionsStr,"onUpdate:modelValue":e[23]||(e[23]=l=>y.value.optionsStr=l),type:"textarea",rows:2,placeholder:"JSON 或以逗號分隔"},null,8,["modelValue"])]),_:1}),u(v,{label:"提示文字"},{default:n(()=>[u(z,{modelValue:y.value.placeholder,"onUpdate:modelValue":e[24]||(e[24]=l=>y.value.placeholder=l)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})]),_:1},8,["modelValue"])])}}},al=Ie(Qe,[["__scopeId","data-v-6a54766b"]]);export{al as default};
