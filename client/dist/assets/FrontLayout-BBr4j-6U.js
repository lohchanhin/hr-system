import{G as J,r as h,_ as K,i as D,j as v,H as Q,k as X,l as Y,m as Z,c as g,b as t,q as C,d as o,w as n,e as c,v as m,p as N,u as ee,o as p,F as te,t as oe,h as U,n as ne,x as ae}from"./index-DCVNWy_M.js";import{u as le}from"./menu-DE1rM8GK.js";import{a as se}from"./api-zmJxpGr7.js";import{i as re,r as ce}from"./menuIcons-CeyEi02D.js";import{u as ie}from"./auth-BzMzchi9.js";function ue(){var a,r;return typeof window>"u"?null:((a=window.sessionStorage)==null?void 0:a.getItem("employeeId"))||((r=window.localStorage)==null?void 0:r.getItem("employeeId"))||null}const de=J("profile",()=>{const a=h(null),r=h(!1),i=h(null);async function _({force:u=!1}={}){if(a.value&&!u)return a.value;const w=ue();if(!w)throw a.value=null,i.value=new Error("缺少員工識別碼"),i.value;r.value=!0,i.value=null;try{const d=await se(`/api/profile?employeeId=${encodeURIComponent(w)}`);if(!d.ok)throw new Error("讀取個人資料失敗");const k=await d.json();return a.value=k,k}catch(d){throw i.value=d,a.value=null,d}finally{r.value=!1}}function I(u){a.value=u}function y(){a.value=null,i.value=null}return{profile:a,loading:r,error:i,fetchProfile:_,setProfile:I,clearProfile:y}}),fe={class:"front-layout"},me={class:"logo-area"},pe={class:"logo-brand"},_e={key:0,class:"brand-title"},ve={key:0,class:"toggle-text"},ge={key:0,class:"sidebar-header"},he={class:"user-info"},ye={class:"user-name"},we={class:"info-text"},be={class:"info-text"},Se={class:"info-text"},Ie={class:"info-text"},ke=["src","data-icon-key"],xe={class:"menu-label"},Ce={class:"logout-section"},Me={key:0,class:"logout-text"},Pe={class:"main-view"},ze={class:"content-wrapper"},Le="/HR.png",Ne="未提供",Re={__name:"FrontLayout",setup(a){const r=ee(),i=Q(),_=le(),{items:I}=D(_),y=de(),{profile:u}=D(y),w=ie(),d=h(""),k=v(()=>i.name||""),l=h(!1),R=h(!1),M=v(()=>l.value?"展開側欄":"收合側欄");function P(e,s=Ne){if(typeof e=="string"){const b=e.trim();return b.length?b:s}return e?`${e}`:s}const z=v(()=>{var s;const e=(s=u.value)==null?void 0:s.name;return typeof e=="string"&&e.trim().length?e.trim():d.value||"員工"}),E=v(()=>{var e;return P((e=u.value)==null?void 0:e.organizationName)}),B=v(()=>{var e;return P((e=u.value)==null?void 0:e.departmentName)}),F=v(()=>{var e;return P((e=u.value)==null?void 0:e.subDepartmentName)});function L({ignoreManualOverride:e=!1}={}){typeof window>"u"||!e&&R.value||(l.value=window.innerWidth<=1024)}X(()=>{w.loadUser({forceRefresh:!0});const e=localStorage.getItem("username");e&&(d.value=e),I.value.length===0&&_.fetchMenu(),y.fetchProfile().catch(()=>{}),L({ignoreManualOverride:!0}),typeof window<"u"&&window.addEventListener("resize",L)}),Y(()=>{typeof window<"u"&&window.removeEventListener("resize",L)}),Z(()=>w.role,(e,s)=>{e!==s&&_.fetchMenu()});function H(e){return ce(e)}function O(e){r.push({name:e})}function V(){R.value=!0,l.value=!l.value}function $(){localStorage.removeItem("role"),localStorage.removeItem("username"),localStorage.removeItem("employeeId"),sessionStorage.removeItem("role"),sessionStorage.removeItem("employeeId"),ae(),_.setMenu([]),y.clearProfile(),r.push("/")}return(e,s)=>{const b=c("el-icon"),T=c("el-button"),S=c("el-tooltip"),j=c("el-avatar"),x=c("el-descriptions-item"),q=c("el-descriptions"),A=c("el-menu-item"),G=c("el-menu"),W=c("router-view");return p(),g("div",fe,[t("aside",{class:N(["sidebar",{collapsed:l.value}])},[t("div",me,[t("div",pe,[t("img",{src:Le,alt:"HR 品牌",class:"logo-image"}),l.value?C("",!0):(p(),g("span",_e,"員工系統"))]),o(S,{content:M.value,placement:"right"},{default:n(()=>[o(T,{type:"primary",plain:"",class:N(["toggle-btn",{"is-collapsed":l.value}]),onClick:V,"aria-label":M.value,"data-test":"sidebar-toggle"},{default:n(()=>[o(b,null,{default:n(()=>[t("i",{class:N(l.value?"el-icon-menu":"el-icon-close")},null,2)]),_:1}),l.value?C("",!0):(p(),g("span",ve,m(M.value),1))]),_:1},8,["class","aria-label"])]),_:1},8,["content"])]),l.value?C("",!0):(p(),g("div",ge,[t("div",he,[o(j,{size:40,class:"user-avatar"},{default:n(()=>s[0]||(s[0]=[t("i",{class:"el-icon-user"},null,-1)])),_:1}),t("span",ye,m(z.value),1),o(q,{class:"profile-descriptions",size:"small",column:1,border:"","label-style":{width:"72px"}},{default:n(()=>[o(x,{label:"姓名"},{default:n(()=>[o(S,{content:z.value,placement:"top"},{default:n(()=>[t("span",we,m(z.value),1)]),_:1},8,["content"])]),_:1}),o(x,{label:"機構"},{default:n(()=>[o(S,{content:E.value,placement:"top"},{default:n(()=>[t("span",be,m(E.value),1)]),_:1},8,["content"])]),_:1}),o(x,{label:"部門"},{default:n(()=>[o(S,{content:B.value,placement:"top"},{default:n(()=>[t("span",Se,m(B.value),1)]),_:1},8,["content"])]),_:1}),o(x,{label:"小單位"},{default:n(()=>[o(S,{content:F.value,placement:"top"},{default:n(()=>[t("span",Ie,m(F.value),1)]),_:1},8,["content"])]),_:1})]),_:1})])])),o(G,{"default-active":k.value,class:"sidebar-menu","background-color":"#0f172a","text-color":"#cbd5e1","active-text-color":"#ffffff",collapse:l.value},{default:n(()=>[(p(!0),g(te,null,oe(U(I),f=>(p(),ne(A,{key:f.name,index:f.name,onClick:Ee=>O(f.name),class:"menu-item"},{default:n(()=>[t("img",{src:H(f),class:"menu-icon","data-icon-key":U(re)[f.icon]?f.icon:"default",alt:""},null,8,ke),t("span",xe,m(f.label),1)]),_:2},1032,["index","onClick"]))),128))]),_:1},8,["default-active","collapse"]),t("div",Ce,[o(T,{type:"danger",onClick:$,class:"logout-btn",block:""},{default:n(()=>[o(b,null,{default:n(()=>s[1]||(s[1]=[t("i",{class:"el-icon-switch-button"},null,-1)])),_:1}),l.value?C("",!0):(p(),g("span",Me,"登出系統"))]),_:1})])],2),t("main",Pe,[t("div",ze,[o(W)])])])}}},He=K(Re,[["__scopeId","data-v-2ebf75e7"]]);export{He as default};
