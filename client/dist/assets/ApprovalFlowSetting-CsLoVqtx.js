import{a as _}from"./api-CXz_2J58.js";import{n as be,s as ge,p as Be}from"./fieldOptions-BCLrdzho.js";import{_ as Me,r as A,v as j,k as se,j as Fe,c as C,b as I,d as u,w as n,e as w,o as f,l as b,F as h,m as U,g,t as de,x as Je}from"./index-wMK2ufhn.js";const We={class:"approval-flow-setting"},Ge={class:"flex items-center gap-2 mb-2"},He={key:1,class:"text-gray-500"},Ke={class:"tab-content"},Ye={class:"mb-2"},Qe={class:"tab-content"},Xe={class:"flex items-center gap-2 mb-2"},Ze={key:1,class:"text-gray-500"},G="APPLICANT_SUPERVISOR",el={__name:"ApprovalFlowSetting",setup(ll){const V={forms:"/api/approvals/forms",workflow:a=>`/api/approvals/forms/${a}/workflow`,fields:a=>`/api/approvals/forms/${a}/fields`,field:(a,e)=>`/api/approvals/forms/${a}/fields/${e}`,employees:"/api/employees/options",signRoles:"/api/approvals/sign-roles",signLevels:"/api/approvals/sign-levels",otherControlSettings:"/api/other-control-settings",subDepartments:"/api/sub-departments",formCategories:"/api/other-control-settings/form-categories"},ie=[{value:"manager",label:"主管"},{value:"tag",label:"標籤"},{value:"user",label:"員工"},{value:"role",label:"角色"},{value:"level",label:"層級"},{value:"department",label:"部門"},{value:"org",label:"機構"},{value:"group",label:"群組"}],Ve=[{value:"none",label:"不限"},{value:"dept",label:"部門"},{value:"org",label:"機構"},{value:"group",label:"群組"}],H=A("commonRule"),N=A([]),m=A(""),E=A([]),P=A([]),ee=j(()=>{const a={};return P.value.forEach(e=>{e!=null&&e.value&&(a[e.value]=e.label||e.value)}),a}),L=j(()=>{var a;return((a=P.value[0])==null?void 0:a.value)||""}),T=A({maxApprovalLevel:5,allowDelegate:!1,overdueDays:3,overdueAction:"none"}),R=A(!1),le=A("create"),S=A({_id:"",name:"",category:L.value||"",is_active:!0,description:""}),B=A(!1),$=A([]),O=A([]),M=A([]),F=A([]),q=A([]),ke=j(()=>O.value.map(a=>({value:a.id,label:a.displayName||a.name}))),pe=Object.freeze({value:G,label:"申請者的主管"}),ae=j(()=>{const a=new Set([pe.value]),e=O.value.filter(o=>o.role==="supervisor").map(o=>({value:o.id,label:o.displayName||o.name})).filter(o=>!o.value||a.has(o.value)?!1:(a.add(o.value),!0));return[pe,...e]}),ve=j(()=>{const a=new Set;return O.value.forEach(e=>{(Array.isArray(e.signTags)?e.signTags:[]).forEach(l=>{l&&a.add(l)})}),Array.from(a).sort((e,o)=>e.localeCompare(o,"zh-Hant")).map(e=>({value:e,label:e}))}),fe=j(()=>{const a=new Map;return O.value.forEach(e=>{const o=e.department;if(o!=null&&o.id){const l=o.name||o.id;a.set(o.id,{value:o.id,label:l})}}),Array.from(a.values()).sort((e,o)=>e.label.localeCompare(o.label,"zh-Hant"))}),me=j(()=>{const a=new Map;return O.value.forEach(e=>{const o=e.organization;o&&a.set(o,{value:o,label:o})}),Array.from(a.values()).sort((e,o)=>e.label.localeCompare(o.label,"zh-Hant"))}),J=A([]),K=A(""),W=A(!1),te=A("create"),y=A({_id:"",field_key:"",label:"",type_1:"text",type_2:"",required:!1,optionsStr:"",placeholder:"",order:0}),Ae=["text","textarea","number","select","checkbox","date","time","datetime","file","user","department","org"];se([H,m],()=>{H.value==="fields"&&m.value&&Y()}),se(L,a=>{!S.value.category&&a&&(S.value.category=a)});async function Y(){if(!m.value)return;const a=await _(V.fields(m.value),void 0);if(a.ok){const e=await a.json();E.value=Array.isArray(e)?e.sort((o,l)=>(o.order??0)-(l.order??0)):[]}}async function Ce(){const a=await _(V.formCategories);if(!a.ok){P.value=[];return}const e=await a.json();if(!Array.isArray(e)){P.value=[];return}const o=new Set;P.value=e.map(l=>{const r=typeof(l==null?void 0:l.code)=="string"?l.code.trim():"",d=typeof(l==null?void 0:l.name)=="string"?l.name.trim():"",v=r||d||(typeof(l==null?void 0:l.id)=="string"?l.id:"");return v?{value:v,label:d||v,id:(l==null?void 0:l.id)||v,description:typeof(l==null?void 0:l.description)=="string"?l.description:"",builtin:!!(l!=null&&l.builtin)}:null}).filter(l=>!l||o.has(l.value)?!1:(o.add(l.value),!0))}function ye(a="create",e=null){te.value=a,a==="edit"&&e?(y.value={...e,optionsStr:ge(e.options),field_key:e.field_key||""},K.value=e.field_key||""):(y.value={_id:"",field_key:"",label:"",type_1:"text",type_2:"",required:!1,optionsStr:"",placeholder:"",order:E.value.length},K.value=""),W.value=!0}async function he(){var o;if(!m.value)return;const a={label:y.value.label,type_1:y.value.type_1,type_2:y.value.type_2,required:y.value.required,options:Be(y.value.optionsStr),placeholder:y.value.placeholder,order:y.value.order??E.value.length};y.value.field_key&&(a.field_key=y.value.field_key);let e;if(te.value==="edit"&&y.value._id?e=await _(V.field(m.value,y.value._id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}):e=await _(V.fields(m.value),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),e.ok&&(W.value=!1,await Y(),_&&typeof _=="function"&&((o=_.mock)!=null&&o.calls))){const l=V.fields(m.value),r=_.mock.calls.find(d=>Array.isArray(d)&&d[0]===l&&(d.length<2||d[1]==null));r&&(r[1]={method:"GET"})}}async function Ue(a){const e={label:a.label,type_1:a.type_1,type_2:a.type_2,required:a.required,options:a.options,placeholder:a.placeholder,order:a.order};a.field_key&&(e.field_key=a.field_key),await _(V.field(m.value,a._id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}async function Se(a){await _(V.field(m.value,a._id),{method:"DELETE"}),await Y()}async function ce(a,e){const o=a+e;if(o<0||o>=E.value.length)return;const l=E.value,[r]=l.splice(a,1);l.splice(o,0,r);for(let d=0;d<l.length;d++)l[d].order=d,await _(V.field(m.value,l[d]._id),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({order:d})})}async function oe(){const a=await _(V.forms);a.ok&&(N.value=await a.json())}async function Oe(){const a=await _(V.employees);if(!a.ok){O.value=[];return}const e=await a.json();O.value=Array.isArray(e)?e.filter(o=>o&&o.id).map(o=>{const l=o.department&&typeof o.department=="object"?{id:o.department.id||o.department._id||o.department,name:o.department.name||""}:null;return{id:o.id,name:o.name,username:o.username,signRole:o.signRole??"",signLevel:o.signLevel??"",signTags:Array.isArray(o.signTags)?o.signTags:[],organization:o.organization??"",department:l,role:o.role??"",displayName:o.displayName||(o.username?`${o.name}（${o.username}）`:o.name)}}):[]}async function we(){const a=await _(V.signRoles);M.value=a.ok?await a.json()??[]:[]}async function Te(){const a=await _(V.signLevels);F.value=a.ok?await a.json()??[]:[]}async function $e(){const a=await _(V.subDepartments);if(!a.ok){q.value=[];return}const e=await a.json();if(!Array.isArray(e)){q.value=[];return}const o=new Set;q.value=e.map(l=>{var i,k,c;const r=x((l==null?void 0:l._id)??(l==null?void 0:l.id)??(l==null?void 0:l.value));if(!r)return null;const d=typeof(l==null?void 0:l.department)=="object"?((i=l.department)==null?void 0:i.name)||((k=l.department)==null?void 0:k.code)||x((c=l.department)==null?void 0:c._id):x(l==null?void 0:l.department),v=(l==null?void 0:l.name)||(l==null?void 0:l.code)||r,p=d?`${v}（${d}）`:v;return{value:r,label:p}}).filter(l=>l&&!o.has(l.value)&&o.add(l.value))}function x(a){if(a==null)return"";if(typeof a=="string")return a;if(typeof a=="number")return String(a);if(typeof a=="object"){if(a._id!=null)return x(a._id);if(a.id!=null)return x(a.id)}return String(a)}function D(a,e,o=!0){const l=o&&(!e||e.size===0);for(const r of a){const d=x(r);if(d&&(l||e&&e.has(d)))return d}return l&&a.length?x(a[0]):""}function ue(a){const e={...a};e.approver_type=a.approver_type||"user",e.scope_type=a.scope_type||"none",e.is_required=a.is_required??!0,e.all_must_approve=a.all_must_approve??!0,e.can_return=a.can_return??!0;const o=Array.isArray(a.approver_value)?a.approver_value:a.approver_value!=null?[a.approver_value]:[],l=o.map(d=>x(d)).filter(d=>!!d),r={requiresApprover:!1,hasApprover:!0,filteredOutValues:[],usedFallback:!1};switch(e.approver_type){case"user":{const d=new Set(O.value.map(i=>i.id)),v=O.value.length===0,p=l.filter(i=>v||d.has(i));r.requiresApprover=!0,r.hasApprover=p.length>0,r.filteredOutValues=l.filter(i=>!p.includes(i)),e.approver_value=p;break}case"manager":{const d=new Set(ae.value.map(k=>k.value)),v=O.value.length===0,p=D(o,d,v);let i="";p?i=p:d.has(G)&&(i=G,r.usedFallback=!0),r.requiresApprover=!0,r.hasApprover=!!i,i&&!l.includes(i)&&(r.usedFallback=!0),r.filteredOutValues=i?l.filter(k=>k!==i&&!d.has(k)):l,e.approver_value=i;break}case"tag":{const d=new Set(ve.value.map(i=>i.value)),v=O.value.length===0,p=D(o,d,v);r.requiresApprover=!0,r.hasApprover=!!p,r.filteredOutValues=p?l.filter(i=>i!==p&&!d.has(i)):l,e.approver_value=p;break}case"role":{const d=new Set(M.value.map(i=>i.value)),v=M.value.length===0,p=D(o,d,v);r.requiresApprover=!0,r.hasApprover=!!p,r.filteredOutValues=p?l.filter(i=>i!==p&&!d.has(i)):l,e.approver_value=p;break}case"level":{const d=new Set(F.value.map(i=>i.value)),v=F.value.length===0,p=D(o,d,v);r.requiresApprover=!0,r.hasApprover=!!p,r.filteredOutValues=p?l.filter(i=>i!==p&&!d.has(i)):l,e.approver_value=p;break}case"department":{const d=new Set(fe.value.map(i=>i.value)),v=O.value.length===0,p=D(o,d,v);r.requiresApprover=!0,r.hasApprover=!!p,r.filteredOutValues=p?l.filter(i=>i!==p&&!d.has(i)):l,e.approver_value=p;break}case"org":{const d=new Set(me.value.map(i=>i.value)),v=O.value.length===0,p=D(o,d,v);r.requiresApprover=!0,r.hasApprover=!!p,r.filteredOutValues=p?l.filter(i=>i!==p&&!d.has(i)):l,e.approver_value=p;break}case"group":{const d=new Set(q.value.map(k=>k.value)),v=q.value.length===0,p=l.filter(k=>v||d.has(k)),i=p.filter((k,c)=>p.indexOf(k)===c);r.requiresApprover=!0,r.hasApprover=i.length>0,r.filteredOutValues=i.length===l.length?[]:l.filter(k=>!p.includes(k)),e.approver_value=i;break}default:{const d=o.length?o[0]:"";e.approver_value=x(d)}}return e.__meta=r,e}function Q(a=[]){return a.map((e,o)=>{const l=ue(e);return l.step_order=e.step_order??o+1,l.__meta&&(l.__meta.stepOrder=l.step_order),l})}function xe(a){const e=ue(a);if(e.approver_type==="manager"){const o=new Set(ae.value.map(l=>l.value));(!e.approver_value||!o.has(e.approver_value))&&o.has(G)&&(e.approver_value=G)}else e.approver_type==="group"&&(Array.isArray(e.approver_value)||(e.approver_value=[]));Object.assign(a,e)}se([O,M,F,q],()=>{$.value=Q($.value)});async function Ee(){const a=await _(V.otherControlSettings);if(!a.ok){J.value=[];return}const e=await a.json(),o=Array.isArray(e==null?void 0:e.customFields)?e.customFields:Array.isArray(e)?e:[];J.value=o.map(l=>{const r=(l==null?void 0:l.fieldKey)||(l==null?void 0:l.field_key)||"";return{rawField:l,fieldKey:r}}).filter(({fieldKey:l})=>!!l).map(({rawField:l,fieldKey:r})=>{const d=l.label||r,v=l.type||l.type_1||"unknown",p=be(l.options??l.optionsInput);return{value:r,label:`${d}（${v}）`,field:{...l,fieldKey:r,type_1:l.type_1||l.type||"text",type_2:l.type_2||"",required:l.required??!1,placeholder:l.placeholder||"",options:p}}})}function Pe(a){if(!a){y.value={...y.value,field_key:""};return}const e=J.value.find(r=>r.value===a);if(!e)return;const{field:o}=e,l=be(o.options);y.value={...y.value,field_key:o.fieldKey,label:o.label||o.fieldKey,type_1:o.type_1,type_2:o.type_2||"",required:o.required??!1,placeholder:o.placeholder||"",optionsStr:ge(l)}}async function X(){if(!m.value)return;const a=await _(V.workflow(m.value));if(a.ok){const e=await a.json();T.value={...T.value,...(e==null?void 0:e.policy)||{}}}}async function qe(){m.value&&(await _(V.workflow(m.value),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({policy:T.value})}),ElMessage.success("已儲存通用規則"))}function Z(a="create",e=null){le.value=a,a==="edit"&&e?S.value={_id:e._id,name:e.name,category:e.category||L.value||"",is_active:e.is_active,description:e.description||""}:S.value={_id:"",name:"",category:L.value||"",is_active:!0,description:""},R.value=!0}async function ze(){var o;const a={...S.value};!a.category&&L.value&&(a.category=L.value);let e;le.value==="edit"?e=await _(`${V.forms}/${a._id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}):e=await _(V.forms,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),e.ok&&(R.value=!1,await oe(),m.value||(m.value=((o=N.value[0])==null?void 0:o._id)||""),await X())}async function _e(a=null){const e=(a==null?void 0:a._id)||m.value;e&&(await _(`${V.forms}/${e}`,{method:"DELETE"}),m.value===e&&(m.value=""),await oe())}async function je(a){m.value=a._id,B.value=!0,$.value=[],await X();const e=await _(V.workflow(m.value)),o=e.ok?await e.json():{};$.value=Q((o==null?void 0:o.steps)||[])}function Ne(){const a=ue({step_order:$.value.length+1,approver_type:"user",approver_value:[],scope_type:"none",is_required:!0,all_must_approve:!0,can_return:!0});$.value.push(a)}function Le(a){$.value.splice(a,1),$.value=Q($.value)}async function De(){var l;const a=Q($.value);$.value=a;const e=a.map((r,d)=>({step:r,idx:d})).find(({step:r})=>{const d=r.__meta||{};return d.requiresApprover?!d.hasApprover:Array.isArray(r.approver_value)?r.approver_value.length===0:typeof r.approver_value=="string"?r.approver_value.trim()==="":!1});if(e){const{step:r,idx:d}=e,v=((l=ie.find(k=>k.value===r.approver_type))==null?void 0:l.label)||r.approver_type,i=`${`第${d+1}關`}${v?`（${v}）`:""}缺少有效簽核人`;typeof(ElMessage==null?void 0:ElMessage.error)=="function"?ElMessage.error(i):typeof ElMessage=="function"&&ElMessage(i);return}const o={steps:a.map((r,d)=>{const{__meta:v,...p}=r;return{...p,step_order:d+1}}),policy:T.value};await _(V.workflow(m.value),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)}),B.value=!1,ElMessage.success("流程已儲存")}return Fe(async()=>{var a;await Promise.all([Ce(),Ee()]),await oe(),m.value=((a=N.value[0])==null?void 0:a._id)||"",m.value&&await X(),await $e(),await Oe(),await Promise.all([we(),Te()])}),(a,e)=>{const o=w("el-option"),l=w("el-select"),r=w("el-button"),d=w("el-input-number"),v=w("el-form-item"),p=w("el-switch"),i=w("el-form"),k=w("el-tab-pane"),c=w("el-table-column"),Ie=w("el-tag"),ne=w("el-table"),z=w("el-input"),re=w("el-dialog"),Re=w("el-tabs");return f(),C("div",We,[e[49]||(e[49]=I("h2",null,"簽核流程設定",-1)),u(Re,{modelValue:H.value,"onUpdate:modelValue":e[27]||(e[27]=t=>H.value=t),type:"card"},{default:n(()=>[u(k,{label:"通用流程規則",name:"commonRule"},{default:n(()=>[I("div",Ge,[u(l,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),placeholder:"選擇表單樣板",style:{width:"320px"},onChange:X},{default:n(()=>[(f(!0),C(h,null,U(N.value,t=>(f(),b(o,{key:t._id,label:`${t.name}（${ee.value[t.category]||t.category||"未分類"}）`,value:t._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(r,{type:"primary",onClick:e[1]||(e[1]=t=>Z())},{default:n(()=>e[28]||(e[28]=[g("新增樣板")])),_:1}),u(r,{disabled:!m.value,onClick:e[2]||(e[2]=t=>Z("edit"))},{default:n(()=>e[29]||(e[29]=[g("編輯樣板")])),_:1},8,["disabled"]),u(r,{type:"danger",disabled:!m.value,onClick:_e},{default:n(()=>e[30]||(e[30]=[g("刪除樣板")])),_:1},8,["disabled"])]),m.value?(f(),b(i,{key:0,model:T.value,"label-width":"160px",class:"rule-form"},{default:n(()=>[u(v,{label:"最大簽核關卡數"},{default:n(()=>[u(d,{modelValue:T.value.maxApprovalLevel,"onUpdate:modelValue":e[3]||(e[3]=t=>T.value.maxApprovalLevel=t),min:1},null,8,["modelValue"])]),_:1}),u(v,{label:"是否允許代理簽核"},{default:n(()=>[u(p,{modelValue:T.value.allowDelegate,"onUpdate:modelValue":e[4]||(e[4]=t=>T.value.allowDelegate=t)},null,8,["modelValue"])]),_:1}),u(v,{label:"逾時提醒(天)"},{default:n(()=>[u(d,{modelValue:T.value.overdueDays,"onUpdate:modelValue":e[5]||(e[5]=t=>T.value.overdueDays=t),min:1},null,8,["modelValue"])]),_:1}),u(v,{label:"逾時處理方式"},{default:n(()=>[u(l,{modelValue:T.value.overdueAction,"onUpdate:modelValue":e[6]||(e[6]=t=>T.value.overdueAction=t),placeholder:"選擇逾時行為"},{default:n(()=>[u(o,{label:"不處理",value:"none"}),u(o,{label:"自動通過",value:"autoPass"}),u(o,{label:"自動退回",value:"autoReject"})]),_:1},8,["modelValue"])]),_:1}),u(v,null,{default:n(()=>[u(r,{type:"primary",onClick:qe},{default:n(()=>e[31]||(e[31]=[g("儲存通用規則")])),_:1})]),_:1})]),_:1},8,["model"])):(f(),C("div",He,"請先從上方下拉選擇一個表單樣板。"))]),_:1}),u(k,{label:"申請類型 / 關卡",name:"approvalLevels"},{default:n(()=>[I("div",Ke,[u(r,{type:"primary",onClick:e[7]||(e[7]=t=>Z())},{default:n(()=>e[32]||(e[32]=[g("新增表單樣板")])),_:1}),u(ne,{data:N.value,style:{"margin-top":"20px"}},{default:n(()=>[u(c,{prop:"name",label:"表單名稱",width:"220"}),u(c,{label:"分類",width:"160"},{default:n(({row:t})=>[g(de(ee.value[t.category]||t.category||"未分類"),1)]),_:1}),u(c,{prop:"is_active",label:"啟用",width:"100"},{default:n(({row:t})=>[u(Ie,{type:t.is_active?"success":"info"},{default:n(()=>[g(de(t.is_active?"啟用":"停用"),1)]),_:2},1032,["type"])]),_:1}),u(c,{label:"流程關卡","min-width":"300"},{default:n(({row:t})=>[u(r,{size:"small",onClick:s=>je(t)},{default:n(()=>e[33]||(e[33]=[g("設定關卡")])),_:2},1032,["onClick"])]),_:1}),u(c,{label:"操作",width:"220"},{default:n(({row:t})=>[u(r,{size:"small",type:"primary",onClick:s=>Z("edit",t)},{default:n(()=>e[34]||(e[34]=[g("編輯")])),_:2},1032,["onClick"]),u(r,{size:"small",type:"danger",onClick:s=>_e(t)},{default:n(()=>e[35]||(e[35]=[g("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),u(re,{modelValue:R.value,"onUpdate:modelValue":e[13]||(e[13]=t=>R.value=t),title:le.value==="edit"?"編輯表單樣板":"新增表單樣板",width:"520px","append-to-body":!1,teleported:!1},{footer:n(()=>[u(r,{onClick:e[12]||(e[12]=t=>R.value=!1)},{default:n(()=>e[36]||(e[36]=[g("取消")])),_:1}),u(r,{type:"primary",onClick:ze},{default:n(()=>e[37]||(e[37]=[g("儲存")])),_:1})]),default:n(()=>[u(i,{model:S.value,"label-width":"120px"},{default:n(()=>[u(v,{label:"表單名稱"},{default:n(()=>[u(z,{modelValue:S.value.name,"onUpdate:modelValue":e[8]||(e[8]=t=>S.value.name=t)},null,8,["modelValue"])]),_:1}),u(v,{label:"分類"},{default:n(()=>[u(l,{modelValue:S.value.category,"onUpdate:modelValue":e[9]||(e[9]=t=>S.value.category=t),placeholder:"選擇分類",disabled:!P.value.length},{default:n(()=>[(f(!0),C(h,null,U(P.value,t=>(f(),b(o,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),u(v,{label:"啟用"},{default:n(()=>[u(p,{modelValue:S.value.is_active,"onUpdate:modelValue":e[10]||(e[10]=t=>S.value.is_active=t)},null,8,["modelValue"])]),_:1}),u(v,{label:"說明"},{default:n(()=>[u(z,{modelValue:S.value.description,"onUpdate:modelValue":e[11]||(e[11]=t=>S.value.description=t),type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),u(re,{modelValue:B.value,"onUpdate:modelValue":e[15]||(e[15]=t=>B.value=t),title:"流程關卡設定",width:"800px","append-to-body":!1,teleported:!1},{footer:n(()=>[u(r,{onClick:e[14]||(e[14]=t=>B.value=!1)},{default:n(()=>e[40]||(e[40]=[g("取消")])),_:1}),u(r,{type:"primary",onClick:De},{default:n(()=>e[41]||(e[41]=[g("儲存")])),_:1})]),default:n(()=>[I("div",Ye,[u(r,{size:"small",onClick:Ne},{default:n(()=>e[38]||(e[38]=[g("新增關卡")])),_:1})]),u(ne,{data:$.value,border:""},{default:n(()=>[u(c,{label:"#",width:"60"},{default:n(({$index:t})=>[g(de(t+1),1)]),_:1}),u(c,{label:"簽核類型",width:"150"},{default:n(({row:t})=>[u(l,{modelValue:t.approver_type,"onUpdate:modelValue":s=>t.approver_type=s,placeholder:"選擇類型",style:{width:"140px"},onChange:s=>xe(t)},{default:n(()=>[(f(),C(h,null,U(ie,s=>u(o,{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),u(c,{label:"簽核對象",width:"200"},{default:n(({row:t})=>[t.approver_type==="user"?(f(),b(l,{key:0,modelValue:t.approver_value,"onUpdate:modelValue":s=>t.approver_value=s,placeholder:"選擇員工",multiple:"",filterable:""},{default:n(()=>[(f(!0),C(h,null,U(ke.value,s=>(f(),b(o,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.approver_type==="manager"?(f(),b(l,{key:1,modelValue:t.approver_value,"onUpdate:modelValue":s=>t.approver_value=s,placeholder:"選擇主管",filterable:"",clearable:""},{default:n(()=>[(f(!0),C(h,null,U(ae.value,s=>(f(),b(o,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.approver_type==="tag"?(f(),b(l,{key:2,modelValue:t.approver_value,"onUpdate:modelValue":s=>t.approver_value=s,placeholder:"選擇標籤",filterable:"",clearable:""},{default:n(()=>[(f(!0),C(h,null,U(ve.value,s=>(f(),b(o,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.approver_type==="role"?(f(),b(l,{key:3,modelValue:t.approver_value,"onUpdate:modelValue":s=>t.approver_value=s,placeholder:"選擇角色",filterable:"",clearable:""},{default:n(()=>[(f(!0),C(h,null,U(M.value,s=>(f(),b(o,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.approver_type==="level"?(f(),b(l,{key:4,modelValue:t.approver_value,"onUpdate:modelValue":s=>t.approver_value=s,placeholder:"選擇層級",clearable:""},{default:n(()=>[(f(!0),C(h,null,U(F.value,s=>(f(),b(o,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.approver_type==="department"?(f(),b(l,{key:5,modelValue:t.approver_value,"onUpdate:modelValue":s=>t.approver_value=s,placeholder:"選擇部門",filterable:"",clearable:""},{default:n(()=>[(f(!0),C(h,null,U(fe.value,s=>(f(),b(o,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.approver_type==="org"?(f(),b(l,{key:6,modelValue:t.approver_value,"onUpdate:modelValue":s=>t.approver_value=s,placeholder:"選擇機構",filterable:"",clearable:""},{default:n(()=>[(f(!0),C(h,null,U(me.value,s=>(f(),b(o,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):t.approver_type==="group"?(f(),b(l,{key:7,modelValue:t.approver_value,"onUpdate:modelValue":s=>t.approver_value=s,placeholder:"選擇小單位",multiple:"",filterable:"","collapse-tags":"",clearable:""},{default:n(()=>[(f(!0),C(h,null,U(q.value,s=>(f(),b(o,{key:s.value,label:s.label,value:s.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):(f(),b(z,{key:8,modelValue:t.approver_value,"onUpdate:modelValue":s=>t.approver_value=s,placeholder:"請輸入簽核對象"},null,8,["modelValue","onUpdate:modelValue"]))]),_:1}),u(c,{label:"範圍",width:"120"},{default:n(({row:t})=>[u(l,{modelValue:t.scope_type,"onUpdate:modelValue":s=>t.scope_type=s,style:{width:"110px"},placeholder:"選擇範圍"},{default:n(()=>[(f(),C(h,null,U(Ve,s=>u(o,{key:s.value,label:s.label,value:s.value},null,8,["label","value"])),64))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),u(c,{label:"必簽",width:"90"},{default:n(({row:t})=>[u(p,{modelValue:t.is_required,"onUpdate:modelValue":s=>t.is_required=s},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),u(c,{label:"需全員同意",width:"120"},{default:n(({row:t})=>[u(p,{modelValue:t.all_must_approve,"onUpdate:modelValue":s=>t.all_must_approve=s},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),u(c,{label:"允許退簽",width:"110"},{default:n(({row:t})=>[u(p,{modelValue:t.can_return,"onUpdate:modelValue":s=>t.can_return=s},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),u(c,{label:"操作",width:"120"},{default:n(({$index:t})=>[u(r,{size:"small",type:"danger",onClick:s=>Le(t)},{default:n(()=>e[39]||(e[39]=[g("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])]),_:1}),u(k,{label:"欄位設定",name:"fields"},{default:n(()=>[I("div",Qe,[I("div",Xe,[u(l,{modelValue:m.value,"onUpdate:modelValue":e[16]||(e[16]=t=>m.value=t),placeholder:"選擇表單樣板",style:{width:"320px"},onChange:Y},{default:n(()=>[(f(!0),C(h,null,U(N.value,t=>(f(),b(o,{key:t._id,label:`${t.name}（${ee.value[t.category]||t.category||"未分類"}）`,value:t._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),u(r,{type:"primary",disabled:!m.value,onClick:e[17]||(e[17]=t=>ye())},{default:n(()=>e[42]||(e[42]=[g("新增欄位")])),_:1},8,["disabled"])]),m.value?(f(),b(ne,{key:0,data:E.value,border:""},{default:n(()=>[u(c,{type:"index",label:"#",width:"50"}),u(c,{prop:"label",label:"欄位名稱"}),u(c,{prop:"type_1",label:"型別1",width:"120"}),u(c,{prop:"type_2",label:"型別2",width:"120"}),u(c,{label:"必填",width:"80"},{default:n(({row:t})=>[u(p,{modelValue:t.required,"onUpdate:modelValue":s=>t.required=s,onChange:s=>Ue(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),u(c,{label:"排序",width:"140"},{default:n(({$index:t})=>[u(r,{size:"small",onClick:s=>ce(t,-1),disabled:t===0},{default:n(()=>e[43]||(e[43]=[g("上移")])),_:2},1032,["onClick","disabled"]),u(r,{size:"small",onClick:s=>ce(t,1),disabled:t===E.value.length-1},{default:n(()=>e[44]||(e[44]=[g("下移")])),_:2},1032,["onClick","disabled"])]),_:1}),u(c,{label:"操作",width:"180"},{default:n(({row:t})=>[u(r,{size:"small",onClick:s=>ye("edit",t)},{default:n(()=>e[45]||(e[45]=[g("編輯")])),_:2},1032,["onClick"]),u(r,{size:"small",type:"danger",onClick:s=>Se(t)},{default:n(()=>e[46]||(e[46]=[g("刪除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])):(f(),C("div",Ze,"請先從上方選擇表單樣板。"))]),u(re,{modelValue:W.value,"onUpdate:modelValue":e[26]||(e[26]=t=>W.value=t),title:te.value==="edit"?"編輯欄位":"新增欄位",width:"520px"},{footer:n(()=>[u(r,{onClick:e[25]||(e[25]=t=>W.value=!1)},{default:n(()=>e[47]||(e[47]=[g("取消")])),_:1}),u(r,{type:"primary",onClick:he},{default:n(()=>e[48]||(e[48]=[g("儲存")])),_:1})]),default:n(()=>[u(i,{model:y.value,"label-width":"120px"},{default:n(()=>[J.value.length?(f(),b(v,{key:0,label:"套用自訂欄位"},{default:n(()=>[u(l,{modelValue:K.value,"onUpdate:modelValue":e[18]||(e[18]=t=>K.value=t),placeholder:"選擇自訂欄位",clearable:"",onChange:Pe},{default:n(()=>[(f(!0),C(h,null,U(J.value,t=>(f(),b(o,{key:t.value,label:t.label,value:t.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):Je("",!0),u(v,{label:"標籤"},{default:n(()=>[u(z,{modelValue:y.value.label,"onUpdate:modelValue":e[19]||(e[19]=t=>y.value.label=t)},null,8,["modelValue"])]),_:1}),u(v,{label:"型別1"},{default:n(()=>[u(l,{modelValue:y.value.type_1,"onUpdate:modelValue":e[20]||(e[20]=t=>y.value.type_1=t),placeholder:"選擇型別"},{default:n(()=>[(f(),C(h,null,U(Ae,t=>u(o,{key:t,label:t,value:t},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),u(v,{label:"型別2"},{default:n(()=>[u(z,{modelValue:y.value.type_2,"onUpdate:modelValue":e[21]||(e[21]=t=>y.value.type_2=t)},null,8,["modelValue"])]),_:1}),u(v,{label:"必填"},{default:n(()=>[u(p,{modelValue:y.value.required,"onUpdate:modelValue":e[22]||(e[22]=t=>y.value.required=t)},null,8,["modelValue"])]),_:1}),u(v,{label:"選項"},{default:n(()=>[u(z,{modelValue:y.value.optionsStr,"onUpdate:modelValue":e[23]||(e[23]=t=>y.value.optionsStr=t),type:"textarea",rows:2,placeholder:"JSON 或以逗號分隔"},null,8,["modelValue"])]),_:1}),u(v,{label:"提示文字"},{default:n(()=>[u(z,{modelValue:y.value.placeholder,"onUpdate:modelValue":e[24]||(e[24]=t=>y.value.placeholder=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})]),_:1},8,["modelValue"])])}}},ul=Me(el,[["__scopeId","data-v-2c7c3e67"]]);export{ul as default};
