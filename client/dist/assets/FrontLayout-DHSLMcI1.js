import{D as A,r as g,_ as J,i as F,x as _,G as K,j as Q,H as X,c as v,b as t,m as x,d as o,w as n,e as c,t as m,n as L,u as Y,o as p,F as Z,p as ee,h as T,l as te,q as oe}from"./index-BsavUnBu.js";import{u as ne}from"./menu-gi1CngEP.js";import{a as ae}from"./api-6fBn2dnK.js";import{i as le,r as se}from"./menuIcons-CeyEi02D.js";function re(){var l,r;return typeof window>"u"?null:((l=window.sessionStorage)==null?void 0:l.getItem("employeeId"))||((r=window.localStorage)==null?void 0:r.getItem("employeeId"))||null}const ce=A("profile",()=>{const l=g(null),r=g(!1),i=g(null);async function h({force:u=!1}={}){if(l.value&&!u)return l.value;const w=re();if(!w)throw l.value=null,i.value=new Error("缺少員工識別碼"),i.value;r.value=!0,i.value=null;try{const d=await ae(`/api/profile?employeeId=${encodeURIComponent(w)}`);if(!d.ok)throw new Error("讀取個人資料失敗");const a=await d.json();return l.value=a,a}catch(d){throw i.value=d,l.value=null,d}finally{r.value=!1}}function S(u){l.value=u}function y(){l.value=null,i.value=null}return{profile:l,loading:r,error:i,fetchProfile:h,setProfile:S,clearProfile:y}}),ie={class:"front-layout"},ue={class:"logo-area"},de={class:"logo-brand"},fe={key:0,class:"brand-title"},me={key:0,class:"toggle-text"},pe={key:0,class:"sidebar-header"},_e={class:"user-info"},ve={class:"user-name"},ge={class:"info-text"},he={class:"info-text"},ye={class:"info-text"},we={class:"info-text"},be=["src","data-icon-key"],Ie={class:"menu-label"},Se={class:"logout-section"},ke={key:0,class:"logout-text"},xe={class:"main-view"},Ce={class:"content-wrapper"},Me="/HR.png",Pe="未提供",ze={__name:"FrontLayout",setup(l){const r=Y(),i=K(),h=ne(),{items:S}=F(h),y=ce(),{profile:u}=F(y),w=g(""),d=_(()=>i.name||""),a=g(!1),N=g(!1),C=_(()=>a.value?"展開側欄":"收合側欄");function M(e,s=Pe){if(typeof e=="string"){const b=e.trim();return b.length?b:s}return e?`${e}`:s}const P=_(()=>{var s;const e=(s=u.value)==null?void 0:s.name;return typeof e=="string"&&e.trim().length?e.trim():w.value||"員工"}),E=_(()=>{var e;return M((e=u.value)==null?void 0:e.organizationName)}),R=_(()=>{var e;return M((e=u.value)==null?void 0:e.departmentName)}),B=_(()=>{var e;return M((e=u.value)==null?void 0:e.subDepartmentName)});function z({ignoreManualOverride:e=!1}={}){typeof window>"u"||!e&&N.value||(a.value=window.innerWidth<=1024)}Q(()=>{const e=localStorage.getItem("username");e&&(w.value=e),S.value.length===0&&h.fetchMenu(),y.fetchProfile().catch(()=>{}),z({ignoreManualOverride:!0}),typeof window<"u"&&window.addEventListener("resize",z)}),X(()=>{typeof window<"u"&&window.removeEventListener("resize",z)});function H(e){return se(e)}function O(e){r.push({name:e})}function U(){N.value=!0,a.value=!a.value}function V(){localStorage.removeItem("role"),localStorage.removeItem("username"),localStorage.removeItem("employeeId"),sessionStorage.removeItem("role"),sessionStorage.removeItem("employeeId"),oe(),h.setMenu([]),y.clearProfile(),r.push("/")}return(e,s)=>{const b=c("el-icon"),D=c("el-button"),I=c("el-tooltip"),$=c("el-avatar"),k=c("el-descriptions-item"),j=c("el-descriptions"),q=c("el-menu-item"),G=c("el-menu"),W=c("router-view");return p(),v("div",ie,[t("aside",{class:L(["sidebar",{collapsed:a.value}])},[t("div",ue,[t("div",de,[t("img",{src:Me,alt:"HR 品牌",class:"logo-image"}),a.value?x("",!0):(p(),v("span",fe,"員工系統"))]),o(I,{content:C.value,placement:"right"},{default:n(()=>[o(D,{type:"primary",plain:"",class:L(["toggle-btn",{"is-collapsed":a.value}]),onClick:U,"aria-label":C.value,"data-test":"sidebar-toggle"},{default:n(()=>[o(b,null,{default:n(()=>[t("i",{class:L(a.value?"el-icon-menu":"el-icon-close")},null,2)]),_:1}),a.value?x("",!0):(p(),v("span",me,m(C.value),1))]),_:1},8,["class","aria-label"])]),_:1},8,["content"])]),a.value?x("",!0):(p(),v("div",pe,[t("div",_e,[o($,{size:40,class:"user-avatar"},{default:n(()=>s[0]||(s[0]=[t("i",{class:"el-icon-user"},null,-1)])),_:1}),t("span",ve,m(P.value),1),o(j,{class:"profile-descriptions",size:"small",column:1,border:"","label-style":{width:"72px"}},{default:n(()=>[o(k,{label:"姓名"},{default:n(()=>[o(I,{content:P.value,placement:"top"},{default:n(()=>[t("span",ge,m(P.value),1)]),_:1},8,["content"])]),_:1}),o(k,{label:"機構"},{default:n(()=>[o(I,{content:E.value,placement:"top"},{default:n(()=>[t("span",he,m(E.value),1)]),_:1},8,["content"])]),_:1}),o(k,{label:"部門"},{default:n(()=>[o(I,{content:R.value,placement:"top"},{default:n(()=>[t("span",ye,m(R.value),1)]),_:1},8,["content"])]),_:1}),o(k,{label:"小單位"},{default:n(()=>[o(I,{content:B.value,placement:"top"},{default:n(()=>[t("span",we,m(B.value),1)]),_:1},8,["content"])]),_:1})]),_:1})])])),o(G,{"default-active":d.value,class:"sidebar-menu","background-color":"#0f172a","text-color":"#cbd5e1","active-text-color":"#ffffff",collapse:a.value},{default:n(()=>[(p(!0),v(Z,null,ee(T(S),f=>(p(),te(q,{key:f.name,index:f.name,onClick:Le=>O(f.name),class:"menu-item"},{default:n(()=>[t("img",{src:H(f),class:"menu-icon","data-icon-key":T(le)[f.icon]?f.icon:"default",alt:""},null,8,be),t("span",Ie,m(f.label),1)]),_:2},1032,["index","onClick"]))),128))]),_:1},8,["default-active","collapse"]),t("div",Se,[o(D,{type:"danger",onClick:V,class:"logout-btn",block:""},{default:n(()=>[o(b,null,{default:n(()=>s[1]||(s[1]=[t("i",{class:"el-icon-switch-button"},null,-1)])),_:1}),a.value?x("",!0):(p(),v("span",ke,"登出系統"))]),_:1})])],2),t("main",xe,[t("div",Ce,[o(W)])])])}}},De=J(ze,[["__scopeId","data-v-303c7a3e"]]);export{De as default};
