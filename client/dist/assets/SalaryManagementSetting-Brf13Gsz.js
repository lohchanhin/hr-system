import{a as I}from"./api-BYlMASy1.js";import{_ as Ae,r as i,j as q,k as Ie,c as H,b as r,d as e,w as a,e as m,o as S,g as d,v as p,F as Z,t as ee,n as le}from"./index-BRi7JFWd.js";const Me={class:"salary-management-setting"},je={class:"tab-content"},Fe={slot:"footer",class:"dialog-footer"},Be={class:"tab-content"},$e={slot:"footer",class:"dialog-footer"},Oe={class:"tab-content"},Pe={class:"tab-content"},Re={slot:"footer",class:"dialog-footer"},Te={class:"tab-content"},ze={class:"tab-content"},Le={class:"stat-item"},Ye={class:"stat-value"},Ge={class:"stat-item"},Ee={class:"stat-value"},Je={class:"stat-item"},We={class:"stat-value"},qe={class:"stat-item"},He={class:"stat-value"},Ke={__name:"SalaryManagementSetting",setup(Qe){const ae=i("salaryItem"),M=i(null),V=i([{itemName:"交通津貼",type:"加項",taxable:!0,insuranceAffect:!1,desc:"員工交通補助"},{itemName:"伙食補助",type:"加項",taxable:!1,insuranceAffect:!1,desc:""},{itemName:"罰款",type:"扣項",taxable:!1,insuranceAffect:!1,desc:"遲到/早退罰款"}]),j=i(!1);let P=null;const f=i({itemName:"",type:"加項",taxable:!0,insuranceAffect:!1,desc:""});function te(o=null){o!==null?(P=o,f.value={...V.value[o]}):(P=null,f.value={itemName:"",type:"加項",taxable:!0,insuranceAffect:!1,desc:""}),j.value=!0}function re(){P===null?V.value.push({...f.value}):V.value[P]={...f.value},j.value=!1,h()}function ie(o){V.value.splice(o,1),h()}const w=i([{gradeName:"初階A",baseSalary:28e3,description:"新進職等"},{gradeName:"中階B",baseSalary:35e3,description:"需具2年以上經驗"},{gradeName:"高階C",baseSalary:5e4,description:"需具5年以上經驗"}]),F=i(!1);let R=null;const y=i({gradeName:"",baseSalary:0,description:""});function oe(o=null){o!==null?(R=o,y.value={...w.value[o]}):(R=null,y.value={gradeName:"",baseSalary:0,description:""}),F.value=!0}function me(){R===null?w.value.push({...y.value}):w.value[R]={...y.value},F.value=!1,h()}function pe(o){w.value.splice(o,1),h()}const b=i({historyMonths:24,effectiveRule:"nextMonth1",needMultiApproval:!0,needRetroactive:!0});function fe(){console.log("儲存調薪與異動規則:",b.value),h()}const _=i({defaultBank:"004",batchFormat:"formatA"}),T=i(!1),ne=i([{employeeName:"王小明",bankCode:"004",accountNumber:"1234567890123"},{employeeName:"李主管",bankCode:"822",accountNumber:"0987654321"}]);function ve(){T.value=!0}function be(o){alert(`編輯帳戶：${ne.value[o].employeeName}`)}function ce(){console.log("儲存發放設定:",_.value),h()}const g=i({includeDependents:!1,courtGarnishment:!1,diffAdjustmentMonths:3});function ye(){console.log("儲存其他薪資設定:",g.value),h()}const K=i(new Date().toISOString().substring(0,7)+"-01"),B=i([]),z=i(""),L=i(""),Y=i(""),G=i(""),ue=i([]),de=i([]),se=i([]),$=q(()=>{if(!G.value)return B.value;const o=G.value.toLowerCase();return B.value.filter(l=>{var u;return l.name.toLowerCase().includes(o)||((u=l.employeeId)==null?void 0:u.toLowerCase().includes(o))})}),ge=q(()=>$.value.reduce((o,l)=>o+(l.baseSalary||0),0)),_e=q(()=>$.value.reduce((o,l)=>o+(l.netPay||0),0)),Ve=q(()=>$.value.reduce((o,l)=>{const u=(l.laborInsuranceFee||0)+(l.healthInsuranceFee||0)+(l.laborPensionSelf||0)+(l.otherDeductions||0);return o+u},0));function c(o){return o==null||isNaN(o)?"NT$ 0":"NT$ "+Math.round(o).toLocaleString("zh-TW")}async function x(){try{const o=new URLSearchParams({month:K.value});z.value&&o.append("organization",z.value),L.value&&o.append("department",L.value),Y.value&&o.append("subDepartment",Y.value);const l=await I(`/api/payroll/overview/monthly?${o}`);l.ok?B.value=await l.json():(console.error("Failed to fetch monthly overview"),B.value=[])}catch(o){console.error("Error fetching monthly overview:",o),B.value=[]}}async function we(){try{const o=await I("/api/organizations");o.ok&&(ue.value=await o.json())}catch(o){console.error("Error fetching organizations:",o)}}async function he(){try{const o=await I("/api/departments");o.ok&&(de.value=await o.json())}catch(o){console.error("Error fetching departments:",o)}}async function ke(){try{const o=await I("/api/subdepartments");o.ok&&(se.value=await o.json())}catch(o){console.error("Error fetching sub-departments:",o)}}function Ce(){}async function Se(){const o=await I("/api/salary-settings");if(o.ok){const l=await o.json();if(l.length){const u=l[0];M.value=u._id,V.value=u.salaryItems||[],w.value=u.grades||[],Object.assign(b.value,u.adjust||{}),Object.assign(_.value,u.payment||{}),Object.assign(g.value,u.other||{})}}}async function h(){const o={salaryItems:V.value,grades:w.value,adjust:b.value,payment:_.value,other:g.value},l=M.value?`/api/salary-settings/${M.value}`:"/api/salary-settings",u=M.value?"PUT":"POST",n=await I(l,{method:u,headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(n.ok){const N=await n.json();M.value=N._id}}return Ie(()=>{Se(),we(),he(),ke(),x()}),(o,l)=>{const u=m("el-button"),n=m("el-table-column"),N=m("el-table"),O=m("el-input"),s=m("el-form-item"),v=m("el-option"),k=m("el-select"),U=m("el-switch"),D=m("el-form"),Q=m("el-dialog"),A=m("el-tab-pane"),X=m("el-input-number"),xe=m("el-date-picker"),E=m("el-card"),J=m("el-col"),Ne=m("el-row"),Ue=m("el-tag"),De=m("el-tabs");return S(),H("div",Me,[l[56]||(l[56]=r("h2",null,"薪資管理設定",-1)),e(De,{modelValue:ae.value,"onUpdate:modelValue":l[31]||(l[31]=t=>ae.value=t),type:"card"},{default:a(()=>[e(A,{label:"薪資項目設定",name:"salaryItem"},{default:a(()=>[r("div",je,[e(u,{type:"primary",onClick:l[0]||(l[0]=t=>te())},{default:a(()=>[...l[32]||(l[32]=[d("新增薪資項目",-1)])]),_:1}),e(N,{data:V.value,style:{"margin-top":"20px"}},{default:a(()=>[e(n,{prop:"itemName",label:"項目名稱",width:"180"}),e(n,{prop:"type",label:"加項/扣項",width:"120"}),e(n,{prop:"taxable",label:"是否計稅",width:"100"},{default:a(({row:t})=>[d(p(t.taxable?"是":"否"),1)]),_:1}),e(n,{prop:"insuranceAffect",label:"是否影響投保",width:"130"},{default:a(({row:t})=>[d(p(t.insuranceAffect?"是":"否"),1)]),_:1}),e(n,{prop:"desc",label:"說明"}),e(n,{label:"操作",width:"180"},{default:a(({row:t,$index:C})=>[e(u,{type:"primary",onClick:W=>te(C)},{default:a(()=>[...l[33]||(l[33]=[d("編輯",-1)])]),_:1},8,["onClick"]),e(u,{type:"danger",onClick:W=>ie(C)},{default:a(()=>[...l[34]||(l[34]=[d("刪除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),e(Q,{modelValue:j.value,"onUpdate:modelValue":l[7]||(l[7]=t=>j.value=t),title:"薪資項目設定",width:"500px"},{default:a(()=>[e(D,{model:f.value,"label-width":"100px"},{default:a(()=>[e(s,{label:"項目名稱"},{default:a(()=>[e(O,{modelValue:f.value.itemName,"onUpdate:modelValue":l[1]||(l[1]=t=>f.value.itemName=t),placeholder:"如：交通津貼、伙食補助、全勤獎金…"},null,8,["modelValue"])]),_:1}),e(s,{label:"類型"},{default:a(()=>[e(k,{modelValue:f.value.type,"onUpdate:modelValue":l[2]||(l[2]=t=>f.value.type=t),placeholder:"加項 / 扣項"},{default:a(()=>[e(v,{label:"加項",value:"加項"}),e(v,{label:"扣項",value:"扣項"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"計稅"},{default:a(()=>[e(U,{modelValue:f.value.taxable,"onUpdate:modelValue":l[3]||(l[3]=t=>f.value.taxable=t),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),e(s,{label:"影響投保"},{default:a(()=>[e(U,{modelValue:f.value.insuranceAffect,"onUpdate:modelValue":l[4]||(l[4]=t=>f.value.insuranceAffect=t),"active-text":"是","inactive-text":"否"},null,8,["modelValue"])]),_:1}),e(s,{label:"說明"},{default:a(()=>[e(O,{modelValue:f.value.desc,"onUpdate:modelValue":l[5]||(l[5]=t=>f.value.desc=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),r("span",Fe,[e(u,{onClick:l[6]||(l[6]=t=>j.value=!1)},{default:a(()=>[...l[35]||(l[35]=[d("取消",-1)])]),_:1}),e(u,{type:"primary",onClick:re},{default:a(()=>[...l[36]||(l[36]=[d("儲存",-1)])]),_:1})])]),_:1},8,["modelValue"])])]),_:1}),e(A,{label:"職等與底薪",name:"grade"},{default:a(()=>[r("div",Be,[e(u,{type:"primary",onClick:l[8]||(l[8]=t=>oe())},{default:a(()=>[...l[37]||(l[37]=[d("新增職等",-1)])]),_:1}),e(N,{data:w.value,style:{"margin-top":"20px"}},{default:a(()=>[e(n,{prop:"gradeName",label:"職等名稱",width:"180"}),e(n,{prop:"baseSalary",label:"基本薪資",width:"120"}),e(n,{prop:"description",label:"說明"}),e(n,{label:"操作",width:"180"},{default:a(({row:t,$index:C})=>[e(u,{type:"primary",onClick:W=>oe(C)},{default:a(()=>[...l[38]||(l[38]=[d("編輯",-1)])]),_:1},8,["onClick"]),e(u,{type:"danger",onClick:W=>pe(C)},{default:a(()=>[...l[39]||(l[39]=[d("刪除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),e(Q,{modelValue:F.value,"onUpdate:modelValue":l[13]||(l[13]=t=>F.value=t),title:"職等設定",width:"400px"},{default:a(()=>[e(D,{model:y.value,"label-width":"100px"},{default:a(()=>[e(s,{label:"名稱"},{default:a(()=>[e(O,{modelValue:y.value.gradeName,"onUpdate:modelValue":l[9]||(l[9]=t=>y.value.gradeName=t),placeholder:"如：職等A / 初階 / 資深…"},null,8,["modelValue"])]),_:1}),e(s,{label:"基本薪資"},{default:a(()=>[e(X,{modelValue:y.value.baseSalary,"onUpdate:modelValue":l[10]||(l[10]=t=>y.value.baseSalary=t),min:0},null,8,["modelValue"])]),_:1}),e(s,{label:"說明"},{default:a(()=>[e(O,{modelValue:y.value.description,"onUpdate:modelValue":l[11]||(l[11]=t=>y.value.description=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),r("span",$e,[e(u,{onClick:l[12]||(l[12]=t=>F.value=!1)},{default:a(()=>[...l[40]||(l[40]=[d("取消",-1)])]),_:1}),e(u,{type:"primary",onClick:me},{default:a(()=>[...l[41]||(l[41]=[d("儲存",-1)])]),_:1})])]),_:1},8,["modelValue"])])]),_:1}),e(A,{label:"調薪與異動",name:"adjust"},{default:a(()=>[r("div",Oe,[e(D,{model:b.value,"label-width":"180px"},{default:a(()=>[e(s,{label:"歷史薪資保留(個月)"},{default:a(()=>[e(X,{modelValue:b.value.historyMonths,"onUpdate:modelValue":l[14]||(l[14]=t=>b.value.historyMonths=t),min:0},null,8,["modelValue"]),l[42]||(l[42]=r("small",null,"保留多久前的薪資紀錄",-1))]),_:1}),e(s,{label:"調薪生效日規則"},{default:a(()=>[e(k,{modelValue:b.value.effectiveRule,"onUpdate:modelValue":l[15]||(l[15]=t=>b.value.effectiveRule=t)},{default:a(()=>[e(v,{label:"次月一號",value:"nextMonth1"}),e(v,{label:"當月同日",value:"sameDay"}),e(v,{label:"依簽核通過日",value:"approvalDate"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"是否需多層簽核"},{default:a(()=>[e(U,{modelValue:b.value.needMultiApproval,"onUpdate:modelValue":l[16]||(l[16]=t=>b.value.needMultiApproval=t)},null,8,["modelValue"])]),_:1}),e(s,{label:"薪資差異補發 / 補扣"},{default:a(()=>[e(U,{modelValue:b.value.needRetroactive,"onUpdate:modelValue":l[17]||(l[17]=t=>b.value.needRetroactive=t)},null,8,["modelValue"])]),_:1}),e(s,null,{default:a(()=>[e(u,{type:"primary",onClick:fe},{default:a(()=>[...l[43]||(l[43]=[d("儲存調薪規則",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1}),e(A,{label:"發放與帳戶",name:"payment"},{default:a(()=>[r("div",Pe,[e(D,{model:_.value,"label-width":"160px"},{default:a(()=>[e(s,{label:"預設銀行代碼"},{default:a(()=>[e(k,{modelValue:_.value.defaultBank,"onUpdate:modelValue":l[18]||(l[18]=t=>_.value.defaultBank=t),placeholder:"選擇銀行"},{default:a(()=>[e(v,{label:"台灣銀行 (004)",value:"004"}),e(v,{label:"台新銀行 (812)",value:"812"}),e(v,{label:"中國信託 (822)",value:"822"}),e(v,{label:"國泰世華 (013)",value:"013"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"發薪帳戶維護"},{default:a(()=>[e(u,{type:"primary",onClick:l[19]||(l[19]=t=>ve())},{default:a(()=>[...l[44]||(l[44]=[d("管理帳戶",-1)])]),_:1})]),_:1}),e(s,{label:"薪資轉帳批次格式"},{default:a(()=>[e(k,{modelValue:_.value.batchFormat,"onUpdate:modelValue":l[20]||(l[20]=t=>_.value.batchFormat=t)},{default:a(()=>[e(v,{label:"自訂格式 A",value:"formatA"}),e(v,{label:"自訂格式 B",value:"formatB"})]),_:1},8,["modelValue"])]),_:1}),e(s,null,{default:a(()=>[e(u,{type:"primary",onClick:ce},{default:a(()=>[...l[45]||(l[45]=[d("儲存發放設定",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),e(Q,{modelValue:T.value,"onUpdate:modelValue":l[22]||(l[22]=t=>T.value=t),title:"銀行帳戶維護",width:"600px"},{default:a(()=>[e(N,{data:ne.value},{default:a(()=>[e(n,{prop:"employeeName",label:"員工姓名",width:"120"}),e(n,{prop:"bankCode",label:"銀行代碼",width:"100"}),e(n,{prop:"accountNumber",label:"帳號"}),e(n,{label:"操作",width:"120"},{default:a(({row:t,$index:C})=>[e(u,{type:"primary",onClick:W=>be(C)},{default:a(()=>[...l[46]||(l[46]=[d("編輯",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),r("span",Re,[e(u,{onClick:l[21]||(l[21]=t=>T.value=!1)},{default:a(()=>[...l[47]||(l[47]=[d("關閉",-1)])]),_:1})])]),_:1},8,["modelValue"])]),_:1}),e(A,{label:"其他設定",name:"others"},{default:a(()=>[r("div",Te,[e(D,{model:g.value,"label-width":"180px"},{default:a(()=>[e(s,{label:"扶養親屬資料 (是否納入撫養額)"},{default:a(()=>[e(U,{modelValue:g.value.includeDependents,"onUpdate:modelValue":l[23]||(l[23]=t=>g.value.includeDependents=t)},null,8,["modelValue"])]),_:1}),e(s,{label:"法院扣押處理"},{default:a(()=>[e(U,{modelValue:g.value.courtGarnishment,"onUpdate:modelValue":l[24]||(l[24]=t=>g.value.courtGarnishment=t)},null,8,["modelValue"]),l[48]||(l[48]=r("small",null,"若啟用，需在員工資料內填寫扣押比例或金額",-1))]),_:1}),e(s,{label:"薪資差異調整 (歷史月份)"},{default:a(()=>[e(X,{modelValue:g.value.diffAdjustmentMonths,"onUpdate:modelValue":l[25]||(l[25]=t=>g.value.diffAdjustmentMonths=t),min:0},null,8,["modelValue"]),l[49]||(l[49]=r("small",null,"允許調整多少個月前的薪資紀錄",-1))]),_:1}),e(s,null,{default:a(()=>[e(u,{type:"primary",onClick:ye},{default:a(()=>[...l[50]||(l[50]=[d("儲存其他設定",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])]),_:1}),e(A,{label:"月薪資總覽",name:"monthlyOverview"},{default:a(()=>[r("div",ze,[e(D,{inline:!0,class:"filter-form"},{default:a(()=>[e(s,{label:"月份"},{default:a(()=>[e(xe,{modelValue:K.value,"onUpdate:modelValue":l[26]||(l[26]=t=>K.value=t),type:"month",placeholder:"選擇月份",format:"YYYY-MM","value-format":"YYYY-MM-01",onChange:x},null,8,["modelValue"])]),_:1}),e(s,{label:"機構"},{default:a(()=>[e(k,{modelValue:z.value,"onUpdate:modelValue":l[27]||(l[27]=t=>z.value=t),placeholder:"全部機構",clearable:"",onChange:x},{default:a(()=>[(S(!0),H(Z,null,ee(ue.value,t=>(S(),le(v,{key:t._id,label:t.name,value:t._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"部門"},{default:a(()=>[e(k,{modelValue:L.value,"onUpdate:modelValue":l[28]||(l[28]=t=>L.value=t),placeholder:"全部部門",clearable:"",onChange:x},{default:a(()=>[(S(!0),H(Z,null,ee(de.value,t=>(S(),le(v,{key:t._id,label:t.name,value:t._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"單位"},{default:a(()=>[e(k,{modelValue:Y.value,"onUpdate:modelValue":l[29]||(l[29]=t=>Y.value=t),placeholder:"全部單位",clearable:"",onChange:x},{default:a(()=>[(S(!0),H(Z,null,ee(se.value,t=>(S(),le(v,{key:t._id,label:t.name,value:t._id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"員工"},{default:a(()=>[e(O,{modelValue:G.value,"onUpdate:modelValue":l[30]||(l[30]=t=>G.value=t),placeholder:"搜尋員工姓名",clearable:"",onInput:Ce,style:{width:"200px"}},null,8,["modelValue"])]),_:1}),e(s,null,{default:a(()=>[e(u,{type:"primary",onClick:x},{default:a(()=>[...l[51]||(l[51]=[d("查詢",-1)])]),_:1})]),_:1})]),_:1}),e(Ne,{gutter:20,style:{"margin-bottom":"20px"}},{default:a(()=>[e(J,{span:6},{default:a(()=>[e(E,null,{default:a(()=>[r("div",Le,[l[52]||(l[52]=r("div",{class:"stat-label"},"總人數",-1)),r("div",Ye,p($.value.length),1)])]),_:1})]),_:1}),e(J,{span:6},{default:a(()=>[e(E,null,{default:a(()=>[r("div",Ge,[l[53]||(l[53]=r("div",{class:"stat-label"},"薪資總額",-1)),r("div",Ee,p(c(ge.value)),1)])]),_:1})]),_:1}),e(J,{span:6},{default:a(()=>[e(E,null,{default:a(()=>[r("div",Je,[l[54]||(l[54]=r("div",{class:"stat-label"},"實發總額",-1)),r("div",We,p(c(_e.value)),1)])]),_:1})]),_:1}),e(J,{span:6},{default:a(()=>[e(E,null,{default:a(()=>[r("div",qe,[l[55]||(l[55]=r("div",{class:"stat-label"},"扣款總額",-1)),r("div",He,p(c(Ve.value)),1)])]),_:1})]),_:1})]),_:1}),e(N,{data:$.value,border:"",stripe:"",style:{width:"100%"},"max-height":"600"},{default:a(()=>[e(n,{prop:"employeeId",label:"員工編號",width:"120",fixed:""}),e(n,{prop:"name",label:"姓名",width:"100",fixed:""}),e(n,{prop:"department",label:"部門",width:"120"}),e(n,{prop:"subDepartment",label:"單位",width:"120"}),e(n,{prop:"salaryType",label:"薪資類型",width:"100"}),e(n,{prop:"baseSalary",label:"基本薪資",width:"120",align:"right"},{default:a(({row:t})=>[d(p(c(t.baseSalary)),1)]),_:1}),e(n,{label:"扣款項目",align:"center"},{default:a(()=>[e(n,{prop:"laborInsuranceFee",label:"勞保費",width:"100",align:"right"},{default:a(({row:t})=>[d(p(c(t.laborInsuranceFee)),1)]),_:1}),e(n,{prop:"healthInsuranceFee",label:"健保費",width:"100",align:"right"},{default:a(({row:t})=>[d(p(c(t.healthInsuranceFee)),1)]),_:1}),e(n,{prop:"laborPensionSelf",label:"勞退",width:"100",align:"right"},{default:a(({row:t})=>[d(p(c(t.laborPensionSelf)),1)]),_:1}),e(n,{prop:"otherDeductions",label:"其他扣款",width:"100",align:"right"},{default:a(({row:t})=>[d(p(c(t.otherDeductions)),1)]),_:1})]),_:1}),e(n,{label:"加項",align:"center"},{default:a(()=>[e(n,{prop:"nightShiftAllowance",label:"夜班津貼",width:"100",align:"right"},{default:a(({row:t})=>[d(p(c(t.nightShiftAllowance)),1)]),_:1}),e(n,{prop:"performanceBonus",label:"績效獎金",width:"100",align:"right"},{default:a(({row:t})=>[d(p(c(t.performanceBonus)),1)]),_:1}),e(n,{prop:"otherBonuses",label:"其他獎金",width:"100",align:"right"},{default:a(({row:t})=>[d(p(c(t.otherBonuses)),1)]),_:1})]),_:1}),e(n,{prop:"netPay",label:"實發金額",width:"120",align:"right",fixed:"right"},{default:a(({row:t})=>[r("strong",null,p(c(t.netPay)),1)]),_:1}),e(n,{label:"狀態",width:"100",fixed:"right"},{default:a(({row:t})=>[e(Ue,{type:t.hasPayrollRecord?"success":"info",size:"small"},{default:a(()=>[d(p(t.hasPayrollRecord?"已計算":"未計算"),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])])]),_:1})]),_:1},8,["modelValue"])])}}},el=Ae(Ke,[["__scopeId","data-v-1e464cbe"]]);export{el as default};
