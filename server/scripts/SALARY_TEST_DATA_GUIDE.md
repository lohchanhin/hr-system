# 薪資測試資料使用說明

## 概述

本文件說明如何使用新增的薪資測試資料來測試 HR 系統的薪資功能。

## 執行種子腳本

### 1. 準備環境

確保已設定 MongoDB 連線字串：

```bash
# server/.env 檔案
MONGODB_URI=mongodb://localhost:27017/hr-system
```

### 2. 執行種子腳本

```bash
cd server
node scripts/seed.js
```

### 3. 查看輸出

執行成功後會看到：

```
Created 2 organizations, 4 departments, 12 sub-departments

=== 薪資資料摘要 ===

主管薪資 (3 人):
  人資主管: 月薪 76470元, 勞退自提: 2294元, 預支: 7647元
  支援服務主管: 月薪 71562元
  營運部主管: 月薪 77007元, 勞退自提: 1540元

員工薪資 (6 人):
  王小明: 月薪 39976元
  李美玲: 月薪 47782元, 勞退自提: 955元, 預支: 4778元
  陳俊宏: 日薪 1908元, 勞退自提: 38元
  黃淑芬: 時薪 230元, 勞退自提: 4元
  吳建國: 月薪 37078元, 勞退自提: 741元
  張雅惠: 日薪 1606元, 勞退自提: 32元

種子帳號資訊已輸出至 /path/to/server/scripts/seed-accounts.json
```

### 4. 查看帳號資訊

種子腳本會生成 `seed-accounts.json` 檔案，包含所有測試帳號的完整資訊（包含薪資資料）。

## 測試資料結構

### 主管薪資資料（3人）

| 姓名 | 薪資類型 | 薪資範圍 | 薪資項目數 |
|-----|---------|---------|-----------|
| 人資主管 | 月薪 | 65K-85K | 4-6項 |
| 支援服務主管 | 月薪 | 70K-95K | 5-7項 |
| 營運部主管 | 月薪 | 75K-100K | 4-6項 |

### 員工薪資資料（6人）

| 編號 | 姓名 | 薪資類型 | 薪資範圍 | 薪資項目數 |
|-----|------|---------|---------|-----------|
| 1 | 王小明 | 月薪 | 32K-45K | 3-5項 |
| 2 | 李美玲 | 月薪 | 35K-50K | 3-4項 |
| 3 | 陳俊宏 | 日薪 | 1.5K-2.2K | 2-3項 |
| 4 | 黃淑芬 | 時薪 | 200-350元 | 1-3項 |
| 5 | 吳建國 | 月薪 | 28K-38K | 2-4項 |
| 6 | 張雅惠 | 日薪 | 1.3K-1.8K | 2-3項 |

### 薪資欄位說明

每位員工包含以下薪資欄位：

- **salaryType**: 薪資類型（月薪、日薪、時薪）
- **salaryAmount**: 薪資金額
- **laborPensionSelf**: 勞退自提金額（60%員工有自提，1%-6%）
- **employeeAdvance**: 預支薪資（40%員工有預支，5%-20%）
- **salaryAccountA**: 主要薪資帳戶（必有）
  - bank: 銀行名稱
  - acct: 帳號（12位數字）
- **salaryAccountB**: 次要薪資帳戶（30%員工有雙帳戶）
  - bank: 銀行名稱
  - acct: 帳號（12位數字）
- **salaryItems**: 薪資項目陣列（從以下選擇）
  - 本薪、職務加給、績效獎金
  - 交通津貼、伙食津貼、全勤獎金
  - 加班費、專業加給、主管加給、年資加給

## 測試場景

### 1. 薪資計算測試

**測試目標**：驗證不同薪資類型的計算

- 月薪員工：固定月薪
- 日薪員工：日薪 × 出勤天數
- 時薪員工：時薪 × 工時

**測試資料**：
- 月薪：王小明、李美玲、吳建國
- 日薪：陳俊宏、張雅惠
- 時薪：黃淑芬

### 2. 勞退自提測試

**測試目標**：驗證勞退自提計算

- 無自提：支援服務主管、王小明
- 有自提：人資主管、營運部主管、李美玲、陳俊宏、黃淑芬、吳建國、張雅惠

**計算公式**：`laborPensionSelf = salaryAmount × selfRate / 100`

### 3. 預支薪資測試

**測試目標**：驗證預支薪資扣除

- 無預支：支援服務主管、王小明、陳俊宏、黃淑芬、吳建國、張雅惠
- 有預支：人資主管、李美玲

**計算公式**：`employeeAdvance = salaryAmount × advanceRate`

### 4. 薪資帳戶測試

**測試目標**：驗證薪資匯款帳戶管理

- 單帳戶：大部分員工（70%）
- 雙帳戶：部分員工（30%）

**測試內容**：
- 查詢員工薪資帳戶
- 新增/修改薪資帳戶
- 驗證帳號格式（12位數字）

### 5. 薪資項目測試

**測試目標**：驗證薪資項目配置和顯示

- 主管：4-7項薪資項目
- 員工：1-5項薪資項目

**測試內容**：
- 查詢員工薪資項目
- 新增/刪除薪資項目
- 薪資項目報表

### 6. 薪資報表測試

**測試目標**：驗證薪資報表生成

**測試資料包含**：
- 不同薪資類型（月薪、日薪、時薪）
- 不同薪資範圍（200元-100,000元）
- 有/無自提、預支
- 不同薪資項目組合

### 7. 薪資匯出測試

**測試目標**：驗證薪資資料匯出功能

**測試內容**：
- 匯出全部員工薪資
- 匯出特定部門薪資
- 匯出特定薪資類型
- 驗證匯出資料完整性

## 資料查詢範例

### MongoDB 查詢範例

```javascript
// 查詢所有月薪員工
db.employees.find({ salaryType: '月薪' })

// 查詢有勞退自提的員工
db.employees.find({ laborPensionSelf: { $gt: 0 } })

// 查詢有預支薪資的員工
db.employees.find({ employeeAdvance: { $gt: 0 } })

// 查詢有雙帳戶的員工
db.employees.find({ 'salaryAccountB.bank': { $ne: '' } })

// 查詢薪資超過50K的員工
db.employees.find({ 
  salaryType: '月薪',
  salaryAmount: { $gte: 50000 }
})

// 統計不同薪資類型的員工數量
db.employees.aggregate([
  {
    $group: {
      _id: '$salaryType',
      count: { $sum: 1 },
      avgSalary: { $avg: '$salaryAmount' }
    }
  }
])
```

### API 查詢範例

```bash
# 查詢所有員工（包含薪資資訊）
curl -X GET http://localhost:3000/api/employees

# 查詢特定員工的薪資資訊
curl -X GET http://localhost:3000/api/employees/:id/salary

# 查詢薪資報表
curl -X GET http://localhost:3000/api/payroll/report
```

## 測試檢查清單

### 基本功能測試
- [ ] 種子腳本成功執行
- [ ] 所有員工都有薪資資料
- [ ] 薪資金額在合理範圍內
- [ ] 薪資帳戶格式正確

### 計算測試
- [ ] 月薪計算正確
- [ ] 日薪計算正確
- [ ] 時薪計算正確
- [ ] 勞退自提計算正確
- [ ] 預支薪資扣除正確

### 資料完整性測試
- [ ] 所有員工有主要薪資帳戶
- [ ] 薪資項目正確設定
- [ ] 薪資類型與金額對應
- [ ] 關聯資料正確（部門、組織）

### 報表測試
- [ ] 薪資明細報表
- [ ] 薪資統計報表
- [ ] 部門薪資報表
- [ ] 薪資匯出功能

### 異常處理測試
- [ ] 處理無薪資資料的員工
- [ ] 處理無效的薪資金額
- [ ] 處理缺少薪資帳戶
- [ ] 處理預支薪資超過限額

## 進階測試場景

### 1. 薪資計算邊界測試

```javascript
// 最低薪資（時薪）
找到薪資最低的員工：黃淑芬（時薪 200-350元）

// 最高薪資（月薪）
找到薪資最高的員工：營運部主管（月薪 75K-100K）
```

### 2. 勞退自提極值測試

```javascript
// 最高自提率（6%）
找到自提率最高的員工

// 零自提
找到沒有自提的員工
```

### 3. 預支薪資極值測試

```javascript
// 最高預支率（20%）
找到預支最多的員工（日薪員工，20%）

// 零預支
找到沒有預支的員工
```

### 4. 薪資項目組合測試

```javascript
// 最多薪資項目（7項）
找到薪資項目最多的主管

// 最少薪資項目（1項）
找到薪資項目最少的員工
```

## 故障排除

### 問題1: 種子腳本執行失敗

**可能原因**：
- MongoDB 連線失敗
- 資料庫已有資料衝突

**解決方法**：
```bash
# 檢查 MongoDB 連線
mongo --eval "db.version()"

# 清空測試資料庫
mongo hr-system --eval "db.dropDatabase()"

# 重新執行種子腳本
node scripts/seed.js
```

### 問題2: 薪資資料不完整

**可能原因**：
- Employee 模型未包含薪資欄位
- 資料庫版本不一致

**解決方法**：
```bash
# 檢查 Employee 模型
cat src/models/Employee.js | grep salary

# 確認資料庫欄位
mongo hr-system --eval "db.employees.findOne()"
```

### 問題3: 測試帳號密碼錯誤

**預設測試密碼**：`password`

**帳號格式**：
- 主管：`hr-supervisor-xxxxx`, `support-supervisor-xxxxx`, `operations-supervisor-xxxxx`
- 員工：`employee-xxxxx`
- 管理員：環境變數設定或預設 `admin`

## 參考資料

- [測試資料評估報告](./SEED_DATA_EVALUATION.md)
- [Employee 模型定義](../src/models/Employee.js)
- [種子腳本原始碼](./seed.js)
- [種子工具函數](../src/seedUtils.js)

## 聯絡資訊

如有問題或建議，請聯絡開發團隊。
