# 夜班津貼表格欄位重組說明

## 變更日期
2025-12-30

## 問題描述

在原本的月薪資總覽表格中，「夜班津貼」欄位顯示在「工作時數」區塊內，與「夜班天數」、「夜班時數」並列。這造成了以下混淆：

1. **概念混淆**：使用者可能誤以為夜班津貼是基本薪資的一部分
2. **帳戶分配不清**：夜班工作本身計入銀行A（薪資帳戶），但津貼實際匯入銀行B（獎金帳戶）
3. **表格結構不直觀**：津貼金額顯示位置與其實際支付方式不一致

## 原本的問題

```
薪資總覽表格（舊版）：

| 工作時數 ──────────────────── | 請假 ── | 加班 ── | 夜班 ──────────────────── | 基本薪資 | ... |
| 上班天數 | 實際工時 | 時薪 |  ...  |  ...  | 夜班天數 | 夜班時數 | 夜班津貼 |          |     |
|    22    |   154    | 167  |  ...  |  ...  |    9     |   63.00  |   0 ⚠️  |  40,000  |     |
                                                                        ↑
                                        這裡顯示津貼但實際不屬於基本薪資（銀行A）
                                        津貼應該匯入銀行B（獎金帳戶）
```

## 解決方案

### 1. 表格結構調整

**移除**：從「工作時數」區塊的「夜班」子群組中移除「夜班津貼」欄位

**保留**：
- 夜班天數（資訊性質，顯示員工有多少天上夜班）
- 夜班時數（資訊性質，顯示總共工作了多少小時）

**新增**：在「加項」區塊增加「夜班津貼」欄位，作為第一個獎金項目

```
薪資總覽表格（新版）：

| 工作時數 ──────────────────── | 請假 ── | 加班 ── | 夜班 ──────────── | 基本薪資 | ... | 加項 ─────────────────────── |
| 上班天數 | 實際工時 | 時薪 |  ...  |  ...  | 夜班天數 | 夜班時數 |          |     | 夜班津貼 | 績效獎金 | 其他獎金 |
|    22    |   154    | 167  |  ...  |  ...  |    9     |   63.00  |  40,000  |     |  4,500   |  2,000   |    800   |
                                                                                          ↑
                                                                   津貼現在正確顯示在獎金區塊（銀行B）
```

### 2. 概念釐清

#### 夜班工作時數 vs 夜班津貼

**夜班工作時數**：
- 計入基本薪資（銀行A）
- 與日班相同按時薪/日薪/月薪計算
- 例：時薪制員工夜班工作7小時 = 7時 × 167元 = 1,169元 → 銀行A

**夜班津貼**：
- 額外的夜班獎勵（銀行B）
- 不屬於基本薪資
- 依班別設定計算（固定金額或浮動計算）
- 例：固定津貼500元/班，或浮動津貼（時薪 × 工時 × 倍率） → 銀行B

#### 完整計算範例

假設員工：
- 薪資類型：時薪制
- 時薪：167元
- 本月工作：22天（其中9天為夜班）
- 夜班班別：每班7小時，固定津貼500元

**基本薪資計算（銀行A）**：
```
總工時 = 154小時（包含夜班的63小時）
基本薪資 = 154 × 167 = 25,718元
扣款（勞健保等）= -5,718元
實發薪資（銀行A）= 20,000元
```

**獎金計算（銀行B）**：
```
夜班津貼 = 9天 × 500元 = 4,500元
績效獎金 = 2,000元
其他獎金 = 800元
獎金總額（銀行B）= 7,300元
```

**總收入**：
```
銀行A：20,000元
銀行B：7,300元
合計：27,300元
```

## 變更清單

### 檔案：`client/src/components/backComponents/SalaryManagementSetting.vue`

#### 1. 表格欄位調整（約第371-430行）

**移除**：
```vue
<!-- 從夜班區塊移除 -->
<el-table-column prop="nightShiftAllowance" label="夜班津貼" width="100" align="right">
  <template #default="{ row }">
    {{ formatCurrency(row.nightShiftAllowance) }}
  </template>
</el-table-column>
```

**新增**：
```vue
<!-- 加入加項區塊的第一個欄位 -->
<el-table-column label="加項" align="center">
  <el-table-column prop="nightShiftAllowance" label="夜班津貼" width="100" align="right">
    <template #default="{ row }">
      {{ formatCurrency(row.nightShiftAllowance) }}
    </template>
  </el-table-column>
  <!-- 績效獎金和其他獎金接續 -->
</el-table-column>
```

#### 2. 薪資計算說明更新（約第818-856行）

**更新**：獎金總額公式說明
```vue
<p class="formula-item">+ 夜班津貼（額外獎勵，非基本工資）</p>
```

**新增**：重要說明區塊
```vue
<el-alert type="info">
  <template #title>
    <strong>重要說明：夜班工作時數 vs 夜班津貼</strong>
  </template>
  <ul>
    <li><strong>夜班工作時數</strong>：計入基本薪資（銀行A）</li>
    <li><strong>夜班津貼</strong>：額外的夜班獎勵（銀行B）</li>
    <li>例：員工夜班工作7小時，時薪167元
      <ul>
        <li>基本薪資（銀行A）= 7時 × 167元 = 1,169元</li>
        <li>夜班津貼（銀行B）= 依班別設定計算</li>
      </ul>
    </li>
  </ul>
</el-alert>
```

#### 3. 銀行帳戶說明更新（約第984-1024行）

**銀行A說明**：
```vue
<li>基本薪資（月薪/日薪/時薪，<strong>包含夜班工作時數</strong>）</li>
```

**銀行B說明**：
```vue
<li><strong>夜班津貼</strong>（夜班額外獎勵）</li>

<!-- 新增註解 -->
<p><strong>註：</strong></p>
<ul>
  <li>夜班<strong>工作本身</strong>已計入基本薪資（銀行A）</li>
  <li>夜班<strong>津貼</strong>為額外獎勵（銀行B）</li>
</ul>
```

## 向後相容性

### ✅ 完全相容
- **後端服務**：無需修改，已正確計算夜班津貼並分配至獎金項目
- **資料模型**：`PayrollRecord` 模型無需變更
- **匯出功能**：`payrollExportService.js` 已正確處理夜班津貼為獎金項目
- **API 回應**：回傳資料格式完全一致

### 影響範圍
- **僅前端顯示**：只調整表格欄位位置，不影響資料計算或業務邏輯

## 測試結果

### 建置測試
```bash
cd client && npm run build
✓ built in 8.66s
```
✅ 建置成功，無錯誤

### 程式碼審查
```
Code review completed.
No review comments found.
```
✅ 無問題

### 安全掃描
```
No code changes detected for languages that CodeQL can analyze
```
✅ 無漏洞（僅為Vue模板變更）

## 使用者影響

### 正面影響
1. **概念更清晰**：表格結構直接反映薪資分配邏輯
2. **減少混淆**：工作時數區塊只顯示與基本薪資相關的資訊
3. **邏輯一致**：津貼顯示位置與實際匯入帳戶一致（銀行B）
4. **文檔完善**：薪資計算說明更加詳細

### 需要注意
1. 使用者可能需要適應新的表格欄位位置
2. 建議在系統更新後通知使用者此變更

## 相關文件

- `/docs/SALARY_CALCULATION_GUIDE.md` - 薪資計算指南
- `/docs/NIGHT_SHIFT_ALLOWANCE_BREAKDOWN.md` - 夜班津貼計算明細
- `/NIGHT_SHIFT_ALLOWANCE_FIX_SUMMARY.md` - 夜班津貼修復摘要

## 總結

此次變更是純UI改進，將夜班津貼欄位從「工作時數」區塊移至「加項」區塊，使表格結構更符合實際的薪資分配邏輯：
- 工作時數 → 基本薪資 → 銀行A
- 獎金項目（含夜班津貼）→ 銀行B

這個調整讓使用者更容易理解薪資組成，減少對於夜班工作與夜班津貼的混淆。
