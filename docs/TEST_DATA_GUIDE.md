# 測試資料說明文件

本文件說明測試資料的結構，協助測試人員驗證系統功能，特別是薪資計算功能。

## 生成測試資料

執行以下指令生成完整的測試資料：

```bash
cd server
node scripts/seed.js
```

## 測試資料內容

### 1. 組織架構

測試資料會建立以下組織架構：

- **2 個機構**（組織）
- **4 個部門**（每個機構 2 個部門）
- **12 個小組**（每個部門 3 個小組）

### 2. 人員資料

系統會建立以下人員：

#### 主管（3 人）
- 人資主管
- 支援服務主管
- 營運部主管

**薪資特性**：
- 薪資類型：月薪
- 薪資範圍：65,000 - 100,000 元
- 勞退自提：60% 的主管有自提（0-6%）
- 預支薪資：部分主管有預支
- 銀行帳戶：所有主管都有雙薪資帳戶（A 帳戶匯本薪，B 帳戶匯獎金）

#### 員工（6 人）
- 王小明、李美玲、陳俊宏、黃淑芬、吳建國、張雅惠

**薪資特性**：
- 薪資類型：多樣化（月薪、日薪、時薪）
  - 月薪：28,000 - 50,000 元
  - 日薪：1,300 - 2,200 元
  - 時薪：200 - 350 元
- 勞退自提：60% 的員工有自提（0-6%）
- 預支薪資：40% 的員工有預支
- 銀行帳戶：所有員工都有雙薪資帳戶（A 帳戶匯本薪，B 帳戶匯獎金）

### 3. 考勤資料

#### 考勤記錄
- **時間範圍**：最近 60 個工作日（約 2 個月）
- **記錄類型**：上班打卡、下班打卡、外出、休息返回
- **班別**：早班、中班、晚班（隨機分配）

#### 班別設定
- **早班**：08:30 - 17:30（午休 12:30-13:30）
- **中班**：12:00 - 21:00（晚餐 17:00-18:00）
- **晚班**：14:00 - 23:00（晚餐 19:00-20:00）

### 4. 審批記錄

#### 🔍 重點：每人都有的必要申請記錄

**為了驗證薪資計算功能**，系統確保**每個人（包括主管和員工）**在**2 個月內**都有以下申請記錄：

##### 上月記錄（每人）
1. **請假申請** × 1 筆（已核准）
   - 假別：特休、事假、病假（輪流）
   - 請假日期：上月 5-12 日
   - 時長：1 天

2. **加班申請** × 1 筆（已核准）
   - 加班時間：上月 10-24 日，18:00-21:00
   - 時長：3 小時
   - 加班事由：專案緊急趕工、客戶臨時需求、系統維護（輪流）

3. **獎金申請** × 1 筆（已核准）
   - 獎金類型：績效獎金、專案獎金、推薦獎金（輪流）
   - 金額：5,000 - 30,000 元（隨機）
   - 申請日期：上月 20-27 日

##### 當月記錄（每人）
1. **請假申請** × 1 筆（已核准）
2. **加班申請** × 1 筆（已核准）
3. **獎金申請** × 1 筆（已核准）

##### 其他多樣化記錄
除了上述必要記錄外，系統還會生成各種狀態的申請記錄：
- 支援申請（approved, pending, rejected, returned）
- 特休保留（approved, pending, rejected, returned）
- 在職證明（approved, pending, rejected, returned）
- 離職證明（approved, pending, rejected, returned）
- 補簽申請（approved, pending, rejected, returned）

#### 總計審批記錄數量

- 人員總數：9 人（3 主管 + 6 員工）
- 必要記錄：9 人 × 2 月 × 3 類（請假+加班+獎金）= **54 筆**
- 多樣化記錄：約 32 筆（各種狀態的其他申請）
- **總計：約 86 筆審批記錄**

### 5. 薪資記錄

系統會為**最近 2 個月**（當月和上月）生成薪資記錄，包含以下資訊：

#### 基本薪資項目
- 本薪（依員工薪資類型和金額）
- 勞保費（約薪資的 2%）
- 健保費（約薪資的 1.5%）
- 勞退個人提繳（若有設定）
- 員工借支（若有設定）
- 其他扣款（每月 100-500 元）

#### 薪資調整項目（來自審批記錄）
- **請假扣款**：依請假時數 × 時薪計算
- **加班費**：依加班時數 × 時薪 × 1.33 倍計算
- **補簽調整**：依補簽時數 × 時薪計算
- **獎金**：依核准的獎金金額計算

#### 固定獎金項目
- 夜班津貼（1,000-3,000 元）
- 績效獎金（2,000-8,000 元）
- 其他獎金（1,000-5,000 元）

#### 實領金額計算
```
實領金額 = 本薪 
         - 勞保費 
         - 健保費 
         - 勞退個人提繳 
         - 員工借支 
         - 其他扣款 
         - 請假扣款 
         + 加班費 
         + 補簽調整 
         + 獎金 
         + 固定獎金
```

## 驗證測試資料

### 方法 1：使用驗證腳本

執行以下指令驗證每個人是否都有必要的申請記錄：

```bash
cd server
node scripts/verifyTestData.js
```

這個腳本會：
- 統計每個人在 2 個月內的請假、加班、獎金申請數量
- 檢查是否每個人都有必要的記錄
- 輸出詳細的統計結果

### 方法 2：透過 API 查詢

1. **查詢所有員工**
   ```bash
   curl http://localhost:3000/api/employees \
     -H "Authorization: Bearer <token>"
   ```

2. **查詢特定員工的審批記錄**
   ```bash
   curl http://localhost:3000/api/approvals?applicant=<employee_id> \
     -H "Authorization: Bearer <token>"
   ```

3. **查詢特定員工的薪資記錄**
   ```bash
   curl http://localhost:3000/api/payroll?employee=<employee_id> \
     -H "Authorization: Bearer <token>"
   ```

### 方法 3：透過前端介面

1. 登入系統（使用測試帳號）
2. 進入「審批管理」查看所有審批記錄
3. 篩選特定員工、表單類型、日期範圍
4. 確認每個員工都有請假和加班記錄
5. 進入「薪資管理」查看薪資記錄
6. 確認薪資計算有正確捕捉請假扣款和加班費

## 測試重點

### 薪資計算驗證

測試薪資計算功能時，請特別注意：

1. **請假扣款**
   - 檢查有請假記錄的員工，薪資是否有對應的請假扣款
   - 扣款金額 = 請假時數 × 時薪
   - 時薪計算方式：
     - 月薪：月薪 ÷ 22 ÷ 8
     - 日薪：日薪 ÷ 8
     - 時薪：時薪

2. **加班費計算**
   - 檢查有加班記錄的員工，薪資是否有對應的加班費
   - 加班費 = 加班時數 × 時薪 × 1.33
   - 確認加班費有正確的加成（1.33 倍）

3. **獎金計算**
   - 檢查有獎金申請的員工，薪資是否有對應的獎金
   - 獎金金額應該與申請的金額一致

4. **綜合驗證**
   - 選擇幾個員工，手動計算其應得薪資
   - 與系統計算的結果比對
   - 確認所有項目都有被正確捕捉和計算

### 測試案例建議

#### 案例 1：月薪員工的薪資計算
- 選擇一個月薪員工（例如：王小明）
- 查看其上月的薪資記錄
- 驗證：本薪、請假扣款、加班費、獎金是否正確

#### 案例 2：日薪員工的薪資計算
- 選擇一個日薪員工
- 查看其上月的薪資記錄
- 驗證：日薪計算、請假扣款（以日為單位）是否正確

#### 案例 3：時薪員工的薪資計算
- 選擇一個時薪員工
- 查看其上月的薪資記錄
- 驗證：時薪計算、加班費（直接以時薪計算）是否正確

#### 案例 4：主管的薪資計算
- 選擇一個主管（例如：人資主管）
- 查看其上月的薪資記錄
- 驗證：主管也有請假、加班記錄，並正確反映在薪資中

## 測試帳號

執行 seed 腳本後，可使用以下帳號登入：

### 預設帳號
| 帳號 | 密碼 | 角色 |
|------|------|------|
| admin | password | 系統管理員 |

### 主管帳號（3 人）
所有主管帳號的密碼都是：`password`
- 人資主管：`hr-supervisor-<UUID前8碼>`
- 支援服務主管：`support-supervisor-<UUID前8碼>`
- 營運部主管：`operations-supervisor-<UUID前8碼>`

### 員工帳號（6 人）
所有員工帳號的密碼都是：`password`
- 格式：`employee-<UUID前8碼>`

> **提示**：執行 seed 腳本後，會在 `server/scripts/seed-accounts.json` 檔案中輸出所有帳號的詳細資訊，包括完整的帳號名稱。

## 常見問題

### Q1：為什麼需要每個人都有請假和加班記錄？
**A**：為了充分測試薪資計算功能，需要確保系統能正確處理各種薪資調整項目。如果沒有實際的請假和加班記錄，就無法驗證系統是否正確計算扣款和加班費。

### Q2：測試資料中的金額是真實的嗎？
**A**：金額是模擬的，但符合台灣的勞基法和實務慣例。例如：
- 加班費是 1.33 倍（平日加班）
- 勞保費約 2%
- 健保費約 1.5%
- 月薪除以 22 天再除以 8 小時得到時薪

### Q3：如何重新生成測試資料？
**A**：再次執行 `node scripts/seed.js` 即可。腳本會先清除舊資料，再生成新資料。

### Q4：測試資料會影響正式環境嗎？
**A**：不會。請確保 `.env` 檔案中的 `MONGODB_URI` 指向測試資料庫，而非正式資料庫。

## 相關文件

- [薪資計算系統](PAYROLL_README.md)
- [每月薪資調整項目設定](monthly-salary-adjustments.md)
- [薪資計算設計文件](salary-calculation-design.md)
- [Server README](../server/README.md)
