# 考勤資料匯入新格式使用範例

本文件說明如何使用新的考勤機匯出格式進行資料匯入。

## 新格式範例

以下是考勤機匯出的檔案格式範例：

```
部門	姓名	差勤號碼	日期時間	簽到/退	機器號	編號	比對方式
迦美	楊世任	23	2025/11/1 上午 07:54:21	上班簽到	104	D0021	指紋
迦美	楊世任	23	2025/11/1 下午 12:00:03	下班簽退	104	D0021	指紋
迦美	楊世任	23	2025/11/3 上午 07:57:34	上班簽到	104	D0021	指紋
迦美	楊世任	23	2025/11/3 下午 05:01:47	下班簽退	104	D0021	指紋
```

## 匯入步驟

### 1. 準備檔案

將考勤機匯出的 Excel 或 CSV 檔案準備好。檔案應包含以下欄位：
- **編號**：員工證件編號或員工編號（必填）
- **姓名**：員工姓名（建議填寫以提高匹配準確度）
- **日期時間**：打卡日期時間（必填）
- **簽到/退**：打卡類型，如「上班簽到」或「下班簽退」（必填）
- 其他欄位為選填

### 2. 開啟匯入對話框

在後台管理頁面，點擊「考勤資料匯入」按鈕。

### 3. 設定欄位對應

在匯入對話框中，設定以下欄位對應：

| 系統欄位 | 對應到檔案欄位 |
|---------|---------------|
| USERID 欄位 | `編號` |
| NAME 欄位 | `姓名` |
| CHECKTIME 欄位 | `日期時間` |
| CHECKTYPE 欄位 | `簽到/退` |

### 4. 選擇時區

選擇適當的時區，預設為 `Asia/Taipei`（台北時區）。

### 5. 上傳並預覽

1. 點擊「選擇檔案」按鈕，選擇準備好的檔案
2. 點擊「預覽資料」按鈕
3. 系統會顯示匯入預覽，包括：
   - 總筆數
   - 已匹配員工的筆數
   - 未匹配員工的筆數
   - 錯誤筆數

### 6. 處理未匹配的員工

如果有未匹配的員工，系統會顯示「員工對應」區塊：

1. 對於每個未匹配的識別值，從下拉選單中選擇對應的員工
2. 或勾選「忽略此次匯入」來跳過該員工的資料

### 7. 開始匯入

確認所有未匹配的員工都已處理後，點擊「開始匯入」按鈕。

## 員工匹配邏輯

系統會依照以下順序嘗試匹配員工：

1. **精確匹配**：使用「編號 + 姓名」組合進行精確匹配
   - 例如：編號 `D0021` + 姓名 `楊世任` = 找到唯一員工

2. **編號匹配**：如果組合匹配失敗，僅使用編號匹配
   - 編號可以是員工編號 (employeeId)、Email 或資料庫 ID

3. **姓名匹配**：如果編號匹配失敗但有提供姓名，且系統中僅有一位員工姓名符合
   - 例如：編號不存在，但姓名 `楊世任` 在系統中只有一人 = 自動匹配

4. **手動對應**：如果以上都匹配失敗，需要手動選擇對應的員工

## 支援的打卡類型

系統支援以下打卡類型：

| 檔案中的值 | 系統識別為 |
|-----------|-----------|
| 上班簽到 | 上班 (clockIn) |
| 下班簽退 | 下班 (clockOut) |
| 上班 | 上班 (clockIn) |
| 下班 | 下班 (clockOut) |
| I | 上班 (clockIn) |
| O | 下班 (clockOut) |
| 1 | 上班 (clockIn) |
| 0 | 下班 (clockOut) |

## 時間格式支援

系統支援多種時間格式：

- `yyyy/MM/dd 上午 HH:mm:ss`（例如：2025/11/1 上午 07:54:21）
- `yyyy/MM/dd 下午 HH:mm:ss`（例如：2025/11/1 下午 05:01:47）
- `yyyy-MM-dd HH:mm:ss`（例如：2025-11-01 07:54:21）
- `yyyy/MM/dd HH:mm:ss`（例如：2025/11/01 07:54:21）
- Excel 日期時間格式

## 常見問題

### Q: 如果員工編號在系統中不存在怎麼辦？

A: 系統會嘗試使用姓名匹配。如果姓名也無法唯一匹配，會要求您手動選擇對應的員工。

### Q: 如果有多個員工同名怎麼辦？

A: 系統會優先使用「編號 + 姓名」組合匹配。如果編號正確，即使有同名員工也能正確匹配。

### Q: 可以只使用編號，不填寫姓名嗎？

A: 可以。姓名欄位是選填的。但建議填寫姓名以提高匹配準確度。

### Q: 匯入後可以刪除或修改嗎？

A: 匯入的資料會直接寫入資料庫。建議先使用「預覽資料」功能確認無誤後再正式匯入。

### Q: 系統會自動去除重複的打卡記錄嗎？

A: 不會。系統會依照檔案內容逐筆新增，不會自動去除重複記錄。

## 簡化範例檔案

如果您的考勤機只能匯出部分欄位，也可以使用簡化格式：

```csv
編號,姓名,日期時間,簽到/退
D0021,楊世任,2025/11/1 上午 07:54:21,上班簽到
D0021,楊世任,2025/11/1 下午 12:00:03,下班簽退
```

匯入時設定對應的欄位對應即可。
